!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexrestorabledataplugin=t()}(void 0,function(){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(r.key),r)}}function e(e,t,i){t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1})}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=l(i),t=(e=r?(e=l(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:i):r.value}).apply(this,arguments)}function f(e){if("object"===i(e)&&null!==e)if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}var t=Phaser.Data.DataManager,v=Phaser.Utils.Objects.GetValue,y=Phaser.Events.EventEmitter,s=function(){a(s,t);var n=h(s);function s(e,t,i){o(this,s);var r=void 0===t;return r&&(t=new y),t=n.call(this,e,t),r&&(r=e.events||e)&&r.once("destroy",t.destroy,u(t)),t._recordEnable=!0,t.resetFromJSON(i),t.events.on("changedata",t.onValueChange,u(t)).on("setdata",function(e,t,i){this.onValueChange(e,t,i,null)},u(t)).on("removedata",function(e,t,i){this.onValueChange(e,t,null,i)},u(t)),t}return e(s,[{key:"resetFromJSON",value:function(e){this._version=v(e,"version",0),this._versionAlias=v(e,"versionAlias",""),this._repository=v(e,"repository",[]),this._versionAliases=v(e,"versionAliases",{});var t=v(e,"changeList",{}),e=v(e,"data",void 0);if(e)this._recordEnable=!1,this.set(e);else{var i,e=""!==this._versionAlias?this._versionAlias:this._version;for(i in this._version=0,this.restore(e),this._recordEnable=!1,t)this.setValue(i,t[i][0])}this._recordEnable=!0,this._changeList=t}},{key:"toJSON",value:function(e){var t={version:this._version,versionAlias:this._versionAlias,changeList:this._changeList,repository:this._repository,versionAliases:this._versionAliases};return(e=void 0===e?!1:e)&&(t.data=this.list),t}},{key:"version",get:function(){return this._version},set:function(e){var t;if("string"==typeof e&&(t=e,e=this._versionAliases[e]),"number"!=typeof e)this._versionAlias="";else{if(this._versionAlias=t||"",0===e)this._recordEnable=!1,c(l(s.prototype),"reset",this).call(this),this._version=0,f(this._changeList);else{e=Math.min(e,this._repository.length);var i,r={};for(o in this._changeList)r[o]=this._changeList[o][1],delete this._changeList[o];if(this._version!==e)if(this._version<e)for(var n=this._version;n<e;n++)for(var o in i=this._repository[n])r[o]=i[o][0];else for(n=this._version-1;e<=n;n--)for(var o in i=this._repository[n])r[o]=i[o][1];for(o in this._version=e,this._recordEnable=!1,r)null===(e=r[o])?this.removeValue(o):this.setValue(o,e)}this._recordEnable=!0}}},{key:"versionAlias",get:function(){return this._versionAlias}},{key:"lastVersion",get:function(){return this._repository.length}},{key:"versionAliases",get:function(){var e,t=[];for(e in this._versionAliases)t.push(e);return t}},{key:"commit",value:function(e){for(var t in this._repository.length=this._version,this._versionAliases)this._versionAliases[t]>this._version&&delete this._versionAliases[t];return this._repository.push(this._changeList),this._changeList={},this._version++,"string"==typeof e&&(this._versionAlias=e,this._versionAliases[e]=this._version),this}},{key:"restore",value:function(e,t){return void 0===e&&(e=""!==this._versionAlias?this._versionAlias:this._version),(t=void 0===t?!1:t)&&(this.version=0),this.version=e,this}},{key:"reset",value:function(){return this.restore(0),this._repository.length=0,f(this._versionAliases),this}},{key:"onValueChange",value:function(e,t,i,r){this._recordEnable&&(this._changeList.hasOwnProperty(t)?this._changeList[t][0]=i:this._changeList[t]=[i,r])}}]),s}();return function(){a(i,Phaser.Plugins.BasePlugin);var t=h(i);function i(e){return o(this,i),t.call(this,e)}return e(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(e,t,i){return new s(e,t,i)}}]),i}()});

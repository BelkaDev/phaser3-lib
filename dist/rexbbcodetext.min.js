!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexbbcodetext=e()}(void 0,function(){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(i.key),i)}}function r(t,e,n){e&&L(t.prototype,e),n&&L(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t,e){return(N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(n),e=(t=i?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}}function z(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?o(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function u(t,e,n){if(null==t)return t;switch(a(t)){case"string":return t;case"number":return"#".concat(et(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function B(t){var e=it.create(this),n=e.getContext("2d",{willReadFrequently:!0});if(t.syncFont(e,n),"actualBoundingBoxAscent"in(r=n.measureText(t.testString)))a={ascent:a=r.actualBoundingBoxAscent,descent:i=r.actualBoundingBoxDescent,fontSize:a+i};else{var i=Math.ceil(r.width*t.baselineX),r=2*i,s=i*t.baselineY|0,a=(e.width=i,e.height=r,n.fillStyle="#f00",n.fillRect(0,0,i,r),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,s),{ascent:0,descent:0,fontSize:0});if(n.getImageData(0,0,i,r)){for(var o,l=n.getImageData(0,0,i,r).data,t=l.length,h=4*i,u=0,c=!1,d=0;d<s;d++){for(o=0;o<h;o+=4)if(255!==l[u+o]){c=!0;break}if(c)break;u+=h}for(a.ascent=s-d,u=t-h,c=!1,d=r;s<d;d--){for(o=0;o<h;o+=4)if(255!==l[u+o]){c=!0;break}if(c)break;u-=h}a.descent=d-s}else a.ascent=s,a.descent=6+s;a.fontSize=a.ascent+a.descent}return it.remove(e),a}function c(t){return!t.hasOwnProperty("convex")||t.convex}function g(t){return 0<t.x&&0<t.y}function p(t,e,n,i,r,s,a,o,l){if(o&&s<a?a-=360:!o&&a<s&&(a+=360),s=dt(s),a=dt(a),null==l)t.ellipse(e,n,i,r,0,s,a,o);else for(var h,u,c=(a-s)/(l+=1),d=0;d<=l;d++)u=s+c*d,h=e+i*Math.cos(u),u=n+r*Math.sin(u),t.lineTo(h,u)}function H(t,e,n,i,r,s,a,o){var l,h,u,c;null==e&&null==n||(u=t.canvas.width,c=t.canvas.height,h=(i=null==n?0:i)/2,u=Math.max(1,u-i),c=Math.max(1,c-i),t.canvas,t=t.context,e=e,n=n,i=i,s=s,a=a,ft(t,l=h,h,h=u,u=c,r,o),null!=e&&(null!=s&&((l=a?t.createLinearGradient(0,0,h,0):t.createLinearGradient(0,0,0,u)).addColorStop(0,e),l.addColorStop(1,s),e=l),t.fillStyle=e,t.fill()),null!=n&&0<i&&(t.strokeStyle=n,t.lineWidth=i,t.stroke()))}function j(t){if("object"===a(t)&&null!==t)if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}function b(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:j(e),n){e.length=t.length;for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}else for(var s in t)e[s]=t[s];return e}function D(){}function G(t,e,n,i){var r,s=this.hitAreaManager.getFirst(e,n);null!==s&&(r=s.data.key,R.call(this,"areadown",r,t,e,n,i),s.data.isDown=!0)}function X(t,e,n,i){var r,s=this.hitAreaManager.getFirst(e,n);null!==s&&(r=(s=s.data).key,R.call(this,"areaup",r,t,e,n,i),s.isDown&&(R.call(this,"areaclick",r,t,e,n,i),r=s.url)&&window.open(r,"_blank"),s.isDown=!1)}function l(t,e,n,i){var r,s,a;null===e?null!==this.lastHitAreaKey&&(R.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),this.hitAreaManager.getByKey(this.lastHitAreaKey).isDown=!1,this.lastHitAreaKey=null):(s=(r=this.hitAreaManager.getFirst(e,n))?r.data.key:null,this.lastHitAreaKey!==s&&(null!==this.lastHitAreaKey&&(R.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),a=this.hitAreaManager.getByKey(this.lastHitAreaKey),this.urlTagCursorStyle&&a.data.url&&(this.scene.input.manager.canvas.style.cursor=""),a.isDown=!1),null!==s&&(R.call(this,"areaover",s,t,e,n,i),this.urlTagCursorStyle)&&r.data.url&&(this.scene.input.manager.canvas.style.cursor=this.urlTagCursorStyle),this.lastHitAreaKey=s))}function U(t,e,n,i,r,s){i<=0&&(n=_t);var a=[];if(t&&t.length)for(var o,l,h=n===_t,u=n===Pt,c=t.split(Mt),d=0,f=c.length;d<f;d++)if(o=c[d],l=d===f-1?Ot:Rt,h){var g=e(o);a.push(s.getLine(o,g,l))}else{var p,y,v,k=0===d?i-r:i;if(o.length<=100)if((g=e(o))<=k){a.push(s.getLine(o,g,l));continue}u?(y=""===(p=o.split(" "))[p.length-1])&&--p.length:p=o;for(var x="",w=0,S=u?e(" "):void 0,m=0,E=p.length;m<E;m++){var T,O=e(v=p[m]),R=m===E-1;!u||R&&!y||(v+=" ",O+=S),u&&i<O?(""!==x?a.push(s.getLine(x,w,bt)):0===m&&0<r&&a.push(s.getLine("",0,bt)),a.push.apply(a,z(U(v,e,Ct,i,0,s))),x=(T=a.pop()).text,w=T.width,s.freeLine(T)," "===x&&(x="",w=0)):(k<(T=w+O)?(a.push(s.getLine(x,w,bt)),x=v,w=O,k=i):(x+=v,w=T),R&&a.push(s.getLine(x,w,l)))}}return a}function h(t,e){Nt(t)?t=(e=t).key:void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n,i,r=e.key,s=e.frame,a=e.width,o=e.height;void 0!==a&&void 0!==o||(n=(i=this.textureManager.getFrame(r,s))?i.cutWidth:0,i=i?i.cutHeight:0,void 0===a&&void 0===o?(a=n,o=i):void 0===a?a=n*(o/i):void 0===o&&(o=i*(a/n))),this.images[t]={key:r,frame:s,width:a,height:o,y:_(e,"y",0),left:_(e,"left",0),right:_(e,"right",0),originX:_(e,"originX",0),originY:_(e,"originY",0)}}function y(t,e,n,i){e===M?t[n]=i:t.hasOwnProperty(n)&&delete t[n]}function Y(t){var e=t.b,n=t.weight,t=t.i;return e||n||t?t?e?"bold italic":n?"".concat(n," italic"):"italic":e?"bold":n.toString():""}function K(t){return t.replace(Zt,"\\$&").replace($t,"\\x2d")}function A(t,e,n,i){return(void 0===i?"".concat(t).concat(n):"".concat(t).concat(n,"=(").concat(i,")")).concat(e)}function F(t,e,n){return"".concat(t,"/").concat(n).concat(e)}function V(t,e){return void 0!==t&&ee(t,e),Object.assign({},W)}var J,q,Z=Phaser.Renderer.WebGL.Utils,t={renderWebGL:function(t,e,n,i){var r,s,a,o,l,h;0!==e.width&&0!==e.height&&(n.addToRenderList(e),s=(r=e.frame).width,a=r.height,o=Z.getTintAppendFloatAlpha,h=(l=t.pipelines.set(e.pipeline,e)).setTexture2D(r.glTexture,e),t.pipelines.preBatch(e),l.batchTexture(e,r.glTexture,s,a,e.x,e.y,s/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,s,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e))},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},$=Phaser.Display.Canvas.CanvasPool,Q=Phaser.GameObjects.GameObject,tt=function(){n(e,Q);var t=i(e);function e(){return d(this,e),t.apply(this,arguments)}return r(e,[{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,r,s){return this.style.setShadow(t,e,n,i,r,s)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setWordWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=$.create(this),r=i.getContext("2d",{willReadFrequently:!0}),e=(t.syncFont(i,r),r.measureText(e)),s=Math.ceil(e.width*t.baselineX),a=2*s,e=s*t.baselineY|0;if(i.width=s,i.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,e),(n.left=0)!==s&&0!=a&&r.getImageData(0,0,s,a))for(var o=r.getImageData(0,0,s,a).data,l=!1,h=0;h<s;h++){for(var u=0;u<a;u++)if(255!==o[4*(u*s+h)]){n.left=h,l=!0;break}if(l)break}return $.remove(i),n}(this.style,t,e)}}]),e}(),e=Phaser.GameObjects.Components,et=(Phaser.Class.mixin(tt,[e.Alpha,e.BlendMode,e.ComputedSize,e.Crop,e.Depth,e.Flip,e.GetBounds,e.Mask,e.Origin,e.Pipeline,e.PostPipeline,e.ScrollFactor,e.Tint,e.Transform,e.Visible,t]),Phaser.Utils.String.Pad),nt={backgroundColor:["backgroundColor",null,u],backgroundColor2:["backgroundColor2",null,u],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,u],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",u],stroke:["stroke","#fff",u],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",u],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",u],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},it=Phaser.Display.Canvas.CanvasPool,e=0,t=1,rt=2,v=0,st=1,k=2,at=/(?:\r\n|\r|\n)/,ot=Phaser.Utils.Objects.GetAdvancedValue,x=Phaser.Utils.Objects.GetValue,lt=function(){function i(t,e,n){d(this,i),this.parent=t,this.propertyMap=n=void 0===n?nt:n,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}return r(i,[{key:"isWrapFitMode",get:function(){return 0<this.fixedWidth&&this.wrapMode!==v&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")&&((h=t.wrap).hasOwnProperty("mode")?"string"==typeof(l=h.mode)&&(h.mode=ht[l]):h.hasOwnProperty("width")&&(h.mode=1)),t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px");var i,r=this.propertyMap;for(i in r){var s=r[i],a=s[0],o=n?s[1]:this[i],s=s[2];"wrapCallback"===i||"wrapCallbackScope"===i?this[i]=x(t,a,o):(a=ot(t,a,o),s&&(a=s(a)),this[i]=a)}var l=x(t,"font",null),h=(this._font=null===l?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:l,x(t,"fill",null)),l=(null!==h&&(this.color=u(h)),x(t,"metrics",!1));return l?this.metrics={ascent:x(l,"ascent",0),descent:x(l,"descent",0),fontSize:x(l,"fontSize",0)}:!e&&this.metrics||(this.metrics=B(this)),e?this.parent.updateText():this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=B(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=x(t,"fontFamily","Courier"),this.fontSize=x(t,"fontSize","16px"),this.fontStyle=x(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=u(t,this.parent.canvas,this.parent.context),this.backgroundColor2=u(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=u(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=u(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=u(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=u(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,r,s){return void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===s&&(s=!0),this.shadowOffsetX=t=void 0===t?0:t,this.shadowOffsetY=e,this.shadowColor=u(n,this.parent.canvas,this.parent.context),this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=s,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return this.shadowColor=u(t=void 0===t?"#000":t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return this.shadowBlur=t=void 0===t?0:t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=u(t=void 0===t?"#000":t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return this.underlineColor=u(t=void 0===t?"#000":t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return this.underlineThickness=t=void 0===t?0:t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return this.underlineOffset=t=void 0===t?0:t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=ht[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===e&&(e="top"),this.halign=t=void 0===t?"left":t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return this.halign=t=void 0===t?"left":t,this.update(!1)}},{key:"setVAlign",value:function(t){return this.valign=t=void 0===t?"top":t,this.update(!1)}},{key:"setMaxLines",value:function(t){return this.maxLines=t=void 0===t?0:t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=x(e,"fontFamily",this.fontFamily),this.fontSize=x(e,"fontSize",this.fontSize),this.fontStyle=x(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t,e={};for(t in this.propertyMap)e[t]=this[t];return e.metrics=this.getTextMetrics(),e}},{key:"destroy",value:function(){this.parent=void 0}}]),i}(),ht={none:v,word:st,char:k,character:k},w=Phaser.Utils.Objects.GetValue,ut=function(){function s(t,e,n,i,r){d(this,s),void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,n,i,r)}return r(s,[{key:"setTo",value:function(t,e,n,i,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){return this.radius=t=void 0===t?0:t,this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)},set:function(t){var e,n="number"==typeof t?e=t:(e=w(t,"x",0),w(t,"y",0)),i=this.cornerRadius;i.tl=S(w(t,"tl",void 0),e,n),i.tr=S(w(t,"tr",void 0),e,n),i.bl=S(w(t,"bl",void 0),e,n),i.br=S(w(t,"br",void 0),e,n)}},{key:"radiusTL",get:function(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.tl,t)}},{key:"radiusTR",get:function(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.tr,t)}},{key:"radiusBL",get:function(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.bl,t)}},{key:"radiusBR",get:function(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)},set:function(t){m(this.cornerRadius.br,t)}}]),s}(),S=function(t,e,n){return void 0===t?t={x:e,y:n}:"number"==typeof t&&(t={x:t,y:t}),ct(t),t},m=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=w(e,"x",0),t.y=w(e,"y",0)),ct(t)},ct=function(t){t.convex=0<=t.x||0<=t.y,t.x=Math.abs(t.x),t.y=Math.abs(t.y)},dt=Phaser.Math.DegToRad,ft=function(t,e,n,i,r,s,a){var o,l,s=new ut(e,n,i,r,s),h=s.minWidth,u=s.minHeight,h=h<=i?1:i/h,u=u<=r?1:r/u,s=s.cornerRadius;t.save(),t.beginPath(),t.translate(e,n),e=s.tl,g(e)?(o=e.x*h,l=e.y*u,c(e)?p(t,o,l,o,l,180,270,!1,a):p(t,0,0,o,l,90,0,!0,a)):t.lineTo(0,0),e=s.tr,g(e)?(o=e.x*h,l=e.y*u,c(e)?p(t,i-o,l,o,l,270,360,!1,a):p(t,i,0,o,l,180,90,!0,a)):t.lineTo(i,0),e=s.br,g(e)?(o=e.x*h,l=e.y*u,c(e)?p(t,i-o,r-l,o,l,0,90,!1,a):p(t,i,r,o,l,270,180,!0,a)):t.lineTo(i,r),e=s.bl,g(e)?(o=e.x*h,l=e.y*u,c(e)?p(t,o,r-l,o,l,90,180,!1,a):p(t,0,r,o,l,360,270,!0,a)):t.lineTo(0,r),t.closePath(),t.restore()},gt={draw:function(t,e,n,i){var r,s,a,o=this.penManager,l=(this.hitAreaManager.clear(),this.context),h=(l.save(),this.defaultStyle),u=(this.clear(),H(this,h.backgroundColor,h.backgroundStrokeColor,h.backgroundStrokeLineWidth,h.backgroundCornerRadius,h.backgroundColor2,h.backgroundHorizontalGradient,h.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset,h.halign),c=h.valign,d=h.lineHeight,f=o.lines,g=f.length,h=h.maxLines,h=0<h&&h<g?(s=h,"center"===c?Math.floor((g-s)/2):"bottom"===c?g-s:0):(s=g,0),p=h+s,y=this.rtl,v=y?this.parent.width:void 0,k="center"===c?Math.max((i-s*d)/2,0):"bottom"===c?Math.max(i-s*d-2,0):0;k+=e;for(var x=h;x<p;x++)if(0!==(r=o.getLineWidth(x))){for(var w=f[x],S=w.length,m=u,E=0;E<S;E++){var T=w[E].prop.align;if(void 0!==T){m=T;break}}a="center"===m?(n-r)/2:"right"===m?y?0:n-r:y?n-r:0,a+=t;for(E=0;E<S;E++)this.drawPen(w[E],a,k,v)}l.restore()},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var i=this.canvas,r=this.context,s=(r.save(),this.parser.propToContextStyle(this.defaultStyle,t.prop));s.buildFont(),s.syncFont(i,r),s.syncStyle(i,r),0<s.underlineThickness&&0<t.width&&this.drawUnderline(e,n,t.width,s),t.isTextPen&&this.drawText(e,n,t.text,s),t.isImagePen&&this.drawImage(e,n,t.prop.img,s),r.restore(),t.hasAreaMarker&&0<t.width&&(r=(i=t.prop.area)?{key:i}:(s=t.prop.url,{key:"url:".concat(s),url:s}),this.hitAreaManager.add(e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight,r))},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context,s=r.lineCap;r.lineCap="butt",r.strokeStyle=i.underlineColor,r.lineWidth=i.underlineThickness,r.beginPath(),r.moveTo(t,e),r.lineTo(t+n,e),r.stroke(),r.lineCap=s},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.stroke&&"none"!==i.stroke&&0<i.strokeThickness&&(i.syncShadow(r,i.shadowStroke),r.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(n,t,e))},drawImage:function(t,e,n,i){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},E=Phaser.Utils.Objects.GetValue,pt=e,yt=t,vt=function(){function e(t){d(this,e),this.prop={},this.resetFromJSON(t)}return r(e,[{key:"resetFromJSON",value:function(t){this.text=E(t,"text",""),this.x=E(t,"x",0),this.y=E(t,"y",0),this.width=E(t,"width",0);var e=E(t,"prop",null);this.prop=e=null===e?{}:e,this.newLineMode=E(t,"newLineMode",0),this.startIndex=E(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===yt&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==pt&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===yt&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area||!!this.prop.url}}]),e}(),kt=Phaser.Utils.Objects.GetFastValue,xt=e,wt=rt,St=function(){function o(t){d(this,o),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.tagToText=kt(t,"tagToText",D),this.tagToTextScope=kt(t,"tagToTextScope",void 0)}return r(o,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,r,s){var a=this.pensPool.pop();return null==a&&(a=new vt),T.text=t,T.x=e,T.y=n,T.width=i,T.prop=r,T.newLineMode=s,a.resetFromJSON(T),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,xt),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,t=t?b(t.prop):null;return this.addTextPen("",e,n,0,t,wt),this}},{key:"addPen",value:function(t){var e=this.lastPen,e=(t.startIndex=null==e?0:e.endIndex,this.pens.push(t),this.lastLine);null==e&&(e=this.linesPool.pop()||[],this.lines.push(e)),e.push(t),t.newLineMode!==xt&&(e=this.linesPool.pop()||[],this.lines.push(e)),this.maxLinesWidth=void 0}},{key:"clone",value:function(t){(t=null==t?new o:t).clear();for(var e=0,n=this.lines.length;e<n;e++)for(var i=this.lines[e],r=0,s=i.length;r<s;r++){var a=i[r];t.addPen(a.text,a.x,a.y,a.width,b(a.prop),a.newLineMode)}return t}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){return t>=this.lines.length?this.getLineEndIndex(t):(t=this.lines[t])&&t[0]?t[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){for(var e,n=!1,i=t=t>=this.lines.length?this.lines.length-1:t;0<=i&&!(n=null!=(e=this.lines[i])&&0<e.length);i--);return n?e[e.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var t=this.lines[t];return!t||null==(t=t[t.length-1])?0:t.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)e<(t=this.getLineWidth(n))&&(e=t);return this.maxLinesWidth=e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var r,s,a,o,l,h="",u=0,c=this.pens.length;u<c&&((a=this.pens[u].endIndex)<=t||(s=this.pens[u],r=n?s.wrapText:s.plainText,o=s.prop,t<=(s=s.startIndex)&&a<=e||(r=r.substring(t-s,e-s)),this.tagToTextScope?h+=this.tagToText.call(this.tagToTextScope,r,o,l):h+=this.tagToText(r,o,l),l=o,!(e<=a)));u++);return h}},{key:"length",get:function(){return this.lines.length},set:function(t){this.clear()}}]),o}(),T={},O=function(){function t(){d(this,t),this.items=[]}return r(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),mt=Phaser.Geom.Rectangle,Et=new O,Tt=function(){function t(){d(this,t),this.hitAreas=[]}return r(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){for(var t=0,e=this.hitAreas.length;t<e;t++)j(this.hitAreas[t].data);return Et.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,r){var s=Et.pop();return null===s?s=new mt(t,e,n,i):s.setTo(t,e,n,i),s.data=r,this.hitAreas.push(s),this}},{key:"getFirst",value:function(t,e){for(var n=0,i=this.hitAreas.length;n<i;n++){var r=this.hitAreas[n];if(r.contains(t,e))return r}return null}},{key:"getByKey",value:function(t){for(var e=0,n=this.hitAreas.length;e<n;e++){var i=this.hitAreas[e];if(i.data.key===t)return i}return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i=0,r=this.hitAreas.length;i<r;i++){var s=this.hitAreas[i];t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height)}return n&&t.restore(),this}}]),t}(),R=function(t,e,n,i,r,s){this.parent.emit("".concat(t,"-").concat(e),n,i,r,s),this.parent.emit(t,e,n,i,r,s)},Ot=e,Rt=t,bt=rt,_t=v,Pt=st,Ct=k,Mt=at,Lt=Phaser.Utils.Objects.GetValue,At=v,Ft=e,Wt=function(){function n(t){d(this,n),this.parent=t.parent,this.scene=this.parent.scene,this.context=Lt(t,"context",null),this.canvas=this.context.canvas,this.parser=Lt(t,"parser",null),this.defaultStyle=Lt(t,"style",null),this.autoRound=!0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.wrapTextLinesPool=t.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new Tt,this.lastHitAreaKey=null,this.urlTagCursorStyle=null;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}return r(n,[{key:"destroy",value:function(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}},{key:"updatePenManager",value:function(t,e,n,i,r){if((r=void 0===r?this.penManager:r).clear(),""!==t){function s(t){return c.measureText(t).width}for(var a,o,l,h=this.parent.style,u=(h.isWrapFitMode&&(a=this.parent.padding,n=h.fixedWidth-a.left-a.right),this.canvas),c=this.context,d=0,f=0,g=h.wrapCallback,p=h.wrapCallbackScope,y=!0,v=this.parser.splitText(t),k=this.wrapTextLinesPool,x=0,w=v.length;x<w;x++)if(o=(S=this.parser.tagTextToProp(v[x],l)).plainText,(l=S.prop).img){var S=this.imageManager.getOuterWidth(l.img);0<n&&e!==At&&n<d+S&&(r.addNewLinePen(),f+=i,d=0),r.addImagePen(d,f,S,b(l)),d+=S}else if(""!==o){if(c.save(),(S=this.parser.propToContextStyle(this.defaultStyle,l)).buildFont(),S.syncFont(u,c),S.syncStyle(u,c),g)for(var m,E=0,T=(m="string"==typeof(m=g.call(p,o,s,n,d))?m.split("\n"):m).length;E<T;E++)"string"==typeof(O=m[E])?m[E]=k.getLine(O,s(O),E<T-1?2:0):y=!1;else m=U(o,s,e,n,d,k);for(var O,E=0,T=m.length;E<T;E++)O=m[E],r.addTextPen(O.text,d,f,O.width,b(l),O.newLineMode),O.newLineMode!==Ft?(d=0,f+=i):d+=O.width;y&&k.freeLines(m),m=null,c.restore()}for(x=0,w=this.lines.length;x<w;x++){var R=this.lines[x],R=R[R.length-1];R&&(R.width+=this.parser.getStrokeThinkness(this.defaultStyle,R.prop))}}return r}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return t=0<e&&e<t?e:t}},{key:"linesWidth",get:function(){return Math.ceil(this.penManager.getMaxLineWidth())}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return 0<t&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new St({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){if(null==t)r=this.penManager.plainText;else for(var i=this.parser.splitText(t,1),r="",s=0,a=i.length;s<a;s++)r+=i[s];return null==e&&null==n||(null==n&&(n=r.length),r=r.substring(e=null==e?0:e,n)),r}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){var r,s;return(null==t?this.penManager:(r=this.tmpPenManager,s=this.defaultStyle,this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,r),r)).getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return(e=void 0===e?this.penManager:e).copy(t)}},{key:"getTextWidth",value:function(t){return(t=void 0===t?this.penManager:t).getMaxLineWidth()}},{key:"getLastPen",value:function(t){return(t=void 0===t?this.penManager:t).lastPen}}]),n}(),It=(Object.assign(Wt.prototype,gt,{setInteractive:function(){this.parent.on("pointerdown",G,this).on("pointerup",X,this).on("pointermove",l,this).on("pointerover",l,this).on("pointerout",function(t,e){l.call(this,t,null,null,e)},this)}}),function(){n(e,O);var t=i(e);function e(){return d(this,e),t.apply(this,arguments)}return r(e,[{key:"freeLine",value:function(t){if(t)return this.push(t),this}},{key:"freeLines",value:function(t){if(t)return this.pushMultiple(t),this}},{key:"getLine",value:function(t,e,n){var i=this.pop();return(i=null===i?{}:i).text=t,i.width=e,i.newLineMode=n,i}}]),e}()),Nt=Phaser.Utils.Objects.IsPlainObject,_=Phaser.Utils.Objects.GetValue,zt=function(){function e(t){d(this,e),this.textureManager=t.sys.textures,this.images={}}return r(e,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)h.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(r=t).length;n<i;n++)h.call(this,r[n]);else{var r;for(t in r=t)h.call(this,t,r[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){t=this.get(t);return t?t.width+t.left+t.right:0}},{key:"getFrame",value:function(t){t=this.get(t);return t?this.textureManager.getFrame(t.key,t.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),e}(),Bt=(Object.assign(zt.prototype,{draw:function(t,e,n,i,r){var t=this.get(t),s=this.textureManager.getFrame(t.key,t.frame),a=t.width,o=t.height;n+=t.left-t.originX*a,i+=t.y-t.originY*o,r&&(n=Math.round(n),i=Math.round(i)),e.drawImage(s.source.image,s.cutX,s.cutY,s.cutWidth,s.cutHeight,n,i,a,o)}}),Phaser.Utils.Objects.IsPlainObject),Ht=Phaser.DOM.AddToDOM,jt=Phaser.Display.Canvas.CanvasPool,Dt=Phaser.GameObjects.GameObject,P=Phaser.Utils.Objects.GetValue,Gt=Phaser.DOM.RemoveFromDOM,Xt=at,C=null,Ut=null,Yt=null,Kt=function(){n(c,tt);var u=i(c);function c(t,e,n,i,r,s,a){d(this,c),Bt(e)&&(e=P(o=e,"x",0),n=P(o,"y",0),i=P(o,"text",""),r=P(o,"style")),void 0===e&&(e=0),void 0===n&&(n=0),(o=u.call(this,t,s)).renderer=t.sys.game.renderer,o.setPosition(e,n),o.setOrigin(0,0),o.initPipeline(),o.canvas=jt.create(f(o)),o.context=o.canvas.getContext("2d",{willReadFrequently:!0}),o._imageManager=void 0,r&&(r.hasOwnProperty("align")&&(e=r.align,delete r.align,r.halign=e),r.hasOwnProperty("stroke"))&&!r.hasOwnProperty("strokeThickness")&&(r.strokeThickness=1),o.style=new lt(f(o),r);var o,n=P(r,"images",void 0);n&&o.addImage(n),o.autoRound=!0,o._text=void 0,o.padding={left:0,right:0,top:0,bottom:0},o.width=1,o.height=1,o.dirty=!1,0===o.style.resolution&&(o.style.resolution=1),o._crop=o.resetCropObject(),o.texture=t.sys.textures.addCanvas(null,o.canvas,!0),o.frame=o.texture.get(),o.frame.source.resolution=o.style.resolution,o.renderer&&o.renderer.gl&&(o.renderer.deleteTexture(o.frame.source.glTexture),o.frame.source.glTexture=null);var l,h,e=P(r,"sharedPool",!0)?(C||(C={},Ut=new O,Yt=new It,o.scene.game.events.once("destroy",function(){Yt=Ut=C=null})),C.hasOwnProperty(s)||(C[s]=new O),l=C[s],h=Ut,Yt):(l=new O,h=new O,new It);return o.canvasText=new Wt({parent:f(o),context:o.context,parser:a,style:o.style,pensPool:l,linesPool:h,wrapTextLinesPool:e}),o.parser=a,o.initRTL(),r&&r.padding&&o.setPadding(r.padding),o.setText(i),o.setUrlTagCursorStyle(P(r,"urlTagCursorStyle","pointer")),P(r,"interactive",!1)&&o.setInteractive(),o}return r(c,[{key:"preDestroy",value:function(){this.style.rtl&&Gt(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),jt.remove(this.canvas),this.texture.destroy()}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Ht(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return(t=null==t?"":Array.isArray(t)?t.join("\n"):t.toString())!==this._text&&(this._text=t,this.updateText()),this}},{key:"setPadding",value:function(t,e,n,i){var r,s;return"object"===a(t)?(n=null!==(s=P(r=t,"x",null))?t=s:(t=P(r,"left",0),P(r,"right",t)),i=null!==(s=P(r,"y",null))?e=s:(e=P(r,"top",0),P(r,"bottom",e))):(void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===i&&(i=e)),this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=i,this.updateText(!1)}},{key:"updateText",value:function(t){var e,n,i=this.canvasText,r=this.style,t=((t=void 0===t?!0:t)&&i.updatePenManager(this._text,r.wrapMode,r.wrapWidth,r.lineHeight),this.padding),s=Math.ceil(i.linesWidth),s=(0===r.fixedWidth?(this.width=s+t.left+t.right,e=s):(this.width=r.fixedWidth,(e=this.width-t.left-t.right)<s&&(e=s)),0===r.fixedHeight?(this.height=i.linesHeight+t.top+t.bottom,n=i.linesHeight):(this.height=r.fixedHeight,(n=this.height-t.top-t.bottom)<i.linesHeight&&(n=i.linesHeight)),this.width),a=this.height,r=(this.updateDisplayOrigin(),r.resolution),o=(s*=r,a*=r,s=Math.max(Math.ceil(s),1),a=Math.max(Math.ceil(a),1),this.canvas),l=this.context,s=(o.width!==s||o.height!==a?(o.width=s,o.height=a,this.frame.setSize(s,a)):l.clearRect(0,0,s,a),l.save(),l.scale(r,r),this.style.rtl?t.right:t.left),a=t.top,r=(i.draw(s,a,e,n),l.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(o,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0,this.input);return r&&!r.customHitArea&&(r.hitArea.width=this.width,r.hitArea.height=this.height),this}},{key:"toJSON",value:function(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){var i=!!this.input;return Dt.prototype.setInteractive.call(this,t,e,n),i||this.canvasText.setInteractive(),this}},{key:"setUrlTagCursorStyle",value:function(t){return this.urlTagCursorStyle=t,this}},{key:"urlTagCursorStyle",get:function(){return this.canvasText.urlTagCursorStyle},set:function(t){this.canvasText.urlTagCursorStyle=t}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(Xt)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return this.canvasText.getText(t,e,n,i=void 0===i?!1:i)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new zt(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"generateTexture",value:function(t,e,n,i,r){var s,a,o,l=this.canvas;return void 0===i?i=l.width:i*=this.resolution,void 0===r?r=l.height:r*=this.resolution,s=this.scene,l=l,t=t,e=e,n=n,i=i,r=r,a=s.sys.textures,s=s.renderer,void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=l.width),void 0===r&&(r=l.height),(t=(a=a.exists(t)?a.get(t):a.createCanvas(t,i,r)).getSourceImage()).width!==i&&(t.width=i),t.height!==r&&(t.height=r),(o=t.getContext("2d",{willReadFrequently:!0})).clearRect(0,0,i,r),o.drawImage(l,e,n,i,r),s.gl&&a&&s.canvasToTexture(t,a.source[0].glTexture,!0,0),this}}]),c}(),M=(Object.assign(Kt.prototype,{appendText:function(t,e){return t||0===t||(t=""),void 0===e&&(e=!0),Array.isArray(t)&&(t=t.join("\n")),(e=(e?"".concat(this.text,"\n"):"".concat(this.text)).concat(t))!=this.text&&this.setText(e),this}}),!0),Vt={plainText:null,prevProp:null},Jt=new lt,qt={},Zt=/[|\\{}()[\]^$+*?.]/g,$t=/-/g,W={},Qt="[-.0-9]+",te="[a-z]+|#[0-9abcdef]+",I="[^\\]]+",ee=function(t,e){if(void 0===e&&(t=(n=t)[0],e=n[1]),J===t&&q===e)return!1;q=e,t=K(J=t),e=K(e);var n=A(t,e,"esc"),i=F(t,e,"esc"),r=A(t,e,"raw"),s=F(t,e,"raw"),a=A(t,e,"b"),o=F(t,e,"b"),l=A(t,e,"i"),h=F(t,e,"i"),u=A(t,e,"weight",Qt),c=F(t,e,"weight"),d=A(t,e,"size",Qt),f=F(t,e,"size"),g=A(t,e,"color",te),p=F(t,e,"color"),y=A(t,e,"u"),v=A(t,e,"u",te),k=F(t,e,"u"),x=A(t,e,"shadow"),w=F(t,e,"shadow"),S="stroke",m=A(t,e,S),E=A(t,e,S,te),S=F(t,e,S),T=A(t,e,"y",Qt),O=F(t,e,"y"),R=A(t,e,"img",I),b=F(t,e,"img"),_=A(t,e,"area",I),P=F(t,e,"area"),C=A(t,e,"url",I),M=F(t,e,"url"),L=A(t,e,"align",I),t=F(t,e,"align");return W.RE_ESC_OPEN=new RegExp(n,"i"),W.RE_ESC_CLOSE=new RegExp(i,"i"),W.RE_RAW_OPEN=new RegExp(r,"i"),W.RE_RAW_CLOSE=new RegExp(s,"i"),W.RE_BLOD_OPEN=new RegExp(a,"i"),W.RE_BLOD_CLOSE=new RegExp(o,"i"),W.RE_ITALICS_OPEN=new RegExp(l,"i"),W.RE_ITALICS_CLOSE=new RegExp(h,"i"),W.RE_WEIGHT_OPEN=new RegExp(u,"i"),W.RE_WEIGHT_CLOSE=new RegExp(c,"i"),W.RE_SIZE_OPEN=new RegExp(d,"i"),W.RE_SIZE_CLOSE=new RegExp(f,"i"),W.RE_COLOR_OPEN=new RegExp(g,"i"),W.RE_COLOR_CLOSE=new RegExp(p,"i"),W.RE_UNDERLINE_OPEN=new RegExp(y,"i"),W.RE_UNDERLINE_OPENC=new RegExp(v,"i"),W.RE_UNDERLINE_CLOSE=new RegExp(k,"i"),W.RE_SHADOW_OPEN=new RegExp(x,"i"),W.RE_SHADOW_CLOSE=new RegExp(w,"i"),W.RE_STROKE_OPEN=new RegExp(m,"i"),W.RE_STROKE_OPENC=new RegExp(E,"i"),W.RE_STROKE_CLOSE=new RegExp(S,"i"),W.RE_OFFSETY_OPEN=new RegExp(T,"i"),W.RE_OFFSETY_CLOSE=new RegExp(O,"i"),W.RE_IMAGE_OPEN=new RegExp(R,"i"),W.RE_IMAGE_CLOSE=new RegExp(b,"i"),W.RE_AREA_OPEN=new RegExp(_,"i"),W.RE_AREA_CLOSE=new RegExp(P,"i"),W.RE_URL_OPEN=new RegExp(C,"i"),W.RE_URL_CLOSE=new RegExp(M,"i"),W.RE_ALIGN_OPEN=new RegExp(L,"i"),W.RE_ALIGN_CLOSE=new RegExp(t,"i"),W.RE_SPLITTEXT=new RegExp([r,s,n,i,a,o,l,h,u,c,d,f,g,p,y,v,k,x,w,m,E,S,T,O,R,b,_,P,C,M,L,t].join("|"),"ig"),!0},ne=Phaser.Utils.Objects.GetValue,ie=function(){function e(t){d(this,e);t=ne(t,"delimiters","[]");this.tagRegex=V(t),this.delimiters=t}return r(e,[{key:"getStrokeThinkness",value:function(t,e){e=e.hasOwnProperty("stroke")?t.strokeThickness:0;return e}},{key:"setDelimiters",value:function(t,e){return ee(t,e)&&(this.tagRegex=V()),this}}]),e}();return Object.assign(ie.prototype,{splitText:function(t,e){for(var n=this.tagRegex,i=[],r=0,s=!1,a=!1;;){var o=n.RE_SPLITTEXT.exec(t);if(!o)break;o=o[0];if(a){if(!n.RE_ESC_CLOSE.test(o))continue;a=!1}else if(s){if(!n.RE_RAW_CLOSE.test(o))continue;s=!1}else n.RE_ESC_OPEN.test(o)?a=!0:n.RE_RAW_OPEN.test(o)&&(s=!0);var l=n.RE_SPLITTEXT.lastIndex,h=l-o.length;r<h&&(h=t.substring(r,h),i.push(h)),void 0===e&&i.push(o),r=l}var u=t.length;return r<u&&i.push(t.substring(r,u)),i},tagTextToProp:function(t,e){var n=this.tagRegex,i="",r=((e=null==e?{}:e).img&&y(e,!1,"img"),e.esc?n.RE_ESC_CLOSE.test(t)?y(e,!1,"esc"):i=t:e.raw?n.RE_RAW_CLOSE.test(t)?y(e,!1,"raw"):i=t:n.RE_ESC_OPEN.test(t)?y(e,M,"esc",!0):n.RE_ESC_CLOSE.test(t)?y(e,!1,"esc"):n.RE_RAW_OPEN.test(t)?y(e,M,"raw",!0):n.RE_RAW_CLOSE.test(t)?y(e,!1,"raw"):n.RE_BLOD_OPEN.test(t)?y(e,M,"b",!0):n.RE_BLOD_CLOSE.test(t)?y(e,!1,"b"):n.RE_ITALICS_OPEN.test(t)?y(e,M,"i",!0):n.RE_ITALICS_CLOSE.test(t)?y(e,!1,"i"):n.RE_WEIGHT_OPEN.test(t)?(r=t.match(n.RE_WEIGHT_OPEN),y(e,M,"weight",r[1])):n.RE_WEIGHT_CLOSE.test(t)?y(e,!1,"weight"):n.RE_SIZE_OPEN.test(t)?(r=t.match(n.RE_SIZE_OPEN),y(e,M,"size","".concat(r[1],"px"))):n.RE_SIZE_CLOSE.test(t)?y(e,!1,"size"):n.RE_COLOR_OPEN.test(t)?(r=t.match(n.RE_COLOR_OPEN),y(e,M,"color",r[1])):n.RE_COLOR_CLOSE.test(t)?y(e,!1,"color"):n.RE_UNDERLINE_OPEN.test(t)?y(e,M,"u",!0):n.RE_UNDERLINE_OPENC.test(t)?(r=t.match(n.RE_UNDERLINE_OPENC),y(e,M,"u",r[1])):n.RE_UNDERLINE_CLOSE.test(t)?y(e,!1,"u"):n.RE_SHADOW_OPEN.test(t)?y(e,M,"shadow",!0):n.RE_SHADOW_CLOSE.test(t)?y(e,!1,"shadow"):n.RE_STROKE_OPEN.test(t)?y(e,M,"stroke",!0):n.RE_STROKE_OPENC.test(t)?(r=t.match(n.RE_STROKE_OPENC),y(e,M,"stroke",r[1])):n.RE_STROKE_CLOSE.test(t)?y(e,!1,"stroke"):n.RE_OFFSETY_OPEN.test(t)?(r=t.match(n.RE_OFFSETY_OPEN),y(e,M,"y",parseFloat(r[1]))):n.RE_OFFSETY_CLOSE.test(t)?y(e,!1,"y"):n.RE_IMAGE_OPEN.test(t)?(r=t.match(n.RE_IMAGE_OPEN),y(e,M,"img",r[1])):n.RE_IMAGE_CLOSE.test(t)?y(e,!1,"img"):n.RE_AREA_OPEN.test(t)?(r=t.match(n.RE_AREA_OPEN),y(e,M,"area",r[1])):n.RE_AREA_CLOSE.test(t)?y(e,!1,"area"):n.RE_URL_OPEN.test(t)?(r=t.match(n.RE_URL_OPEN),y(e,M,"url",r[1])):n.RE_URL_CLOSE.test(t)?y(e,!1,"url"):n.RE_ALIGN_OPEN.test(t)?(r=t.match(n.RE_ALIGN_OPEN),y(e,M,"align",r[1])):n.RE_ALIGN_CLOSE.test(t)?y(e,!1,"align"):i=t,Vt);return r.plainText=i,r.prop=e,r},propToContextStyle:function(t,e){var n,i=Jt;return e.hasOwnProperty("img")?i.image=e.img:(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")?("number"==typeof(n=e.size)&&(n="".concat(n,"px")),i.fontSize=n):i.fontSize=t.fontSize,i.fontStyle=Y(e),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?(!0===e.stroke?i.stroke=t.stroke:i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)),e.hasOwnProperty("shadow")?(!0===e.shadow?i.shadowColor=t.shadowColor:i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?(!0===e.u?i.underlineColor=t.underlineColor:i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,n){var i,r=this.delimiters[0],s=this.delimiters[1],a=[];for(i in n=null==n?qt:n)e.hasOwnProperty(i)||a.push("".concat(r,"/").concat(i).concat(s));for(i in e){var o=e[i];if(n[i]!==o)switch(i){case"size":a.push("".concat(r,"size=").concat(o.replace("px","")).concat(s));break;case"color":case"weight":case"stroke":case"y":case"img":case"area":case"url":case"align":a.push("".concat(r).concat(i,"=").concat(o).concat(s));break;case"u":a.push((!0===o?"".concat(r,"u"):"".concat(r,"u=").concat(o)).concat(s));break;default:a.push("".concat(r).concat(i).concat(s))}}return a.push(t),a.join("")}}),function(){n(o,Kt);var a=i(o);function o(t,e,n,i,r){d(this,o);var s=new ie(r);return a.call(this,t,e,n,i,r,"rexBBCodeText",s)}return r(o,[{key:"setDelimiters",value:function(t,e){return this.parse.setDelimiters(t,e),this}}]),o}()});

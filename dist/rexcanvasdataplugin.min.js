!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexcanvasdataplugin=e()}(void 0,function(){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(r.key),r)}}function o(t,e,i){e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1})}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=u(i);return a(this,r?(t=u(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r)return(r=Object.getOwnPropertyDescriptor(r,e)).get?r.get.call(arguments.length<3?t:i):r.value}).apply(this,arguments)}function h(t,e,i,r,n,o,u,s,a){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=t.width-e),void 0===n&&(n=t.height-i),(a=void 0===a?new p(o,r,n):a).fill(t,e,i,r,n,u,s),a}function l(t,e){return 0<t[e+3]}function t(t,e,i){e instanceof p&&(i=e,e=void 0);var r=g(e,"x",void 0),n=g(e,"y",void 0),o=g(e,"width",void 0),e=g(e,"height",void 0);return h(t.canvas,r,n,o,e,b,l,void 0,i)}function v(t,e){return t[e+3]<<24|t[e+0]<<16|t[e+1]<<8|t[e+2]}var d=Phaser.Math.Linear,y=Phaser.Display.Color,e={rgbaToColor32:function(t,e,i,r){return r<<24|t<<16|e<<8|i},color32ToColorInt:function(t){return 16777215&t},color32ToAlpha:function(t){return t>>>24},color32ToColorObject:function(t,e){var i=t>>16&255,r=t>>8&255,n=255&t,t=t>>24&255;return void 0===e?e=new y(i,n,r,t):e.setTo(i,n,r,t),e},interpolateColor32:function(t,e,i){var r=t>>8&255,n=255&t,o=t>>24&255,u=e>>8&255,s=255&e,a=e>>24&255,t=d(t>>16&255,e>>16&255,i),e=d(r,u,i),r=d(n,s,i);return d(o,a,i)<<24|t<<16|e<<8|r}},p=function(){function r(t,e,i){n(this,r),void 0===e&&(e=0),void 0===i&&(i=e),this.width=e,this.height=i,this.buffer=new t(e*i)}return o(r,[{key:"destroy",value:function(){this.buffer.destroy(),this.buffer=void 0}},{key:"getOffset",value:function(t,e){return e*this.width+t}},{key:"get",value:function(t,e){var i=2===arguments.length?this.getOffset(t,e):t;return this.buffer.get(i)}},{key:"set",value:function(t,e,i){var r;return 3===arguments.length?r=this.getOffset(t,e):(r=t,i=e),this.buffer.set(r,i),this}},{key:"fill",value:function(t,e,i,r,n,o,u){if("number"==typeof t){var s=t;this.buffer.fill(s)}else{void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=t.width-e),void 0===n&&(n=t.height-i),this.resize(r,n);for(var a,f=t.getContext("2d",{willReadFrequently:!0}).getImageData(e,i,r,n).data,c=0,h=f.length/4;c<h;c++)a=4*c,s=u?o.call(u,f,a):o(f,a),this.set(c,s)}return this}},{key:"clear",value:function(){return this.fill(0),this}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||(this.width=t,this.height=e,this.buffer.resize(t*e)),this}},{key:"forEach",value:function(t,e,i){var r;void 0===i&&(i=!1);for(var n=0,o=this.height;n<o;n++)for(var u=0,s=this.width;u<s;u++)r=this.get(u,n),i&&(0===r||!1===r)||(e?t.call(e,r,u,n,this):t(r,u,n,this));return this}},{key:"forEachNonZero",value:function(t,e){return this.forEach(t,e,!0),this}}]),r}(),b=(Object.assign(p.prototype,e),function(){function e(t){n(this,e),this.resize(t)}return o(e,[{key:"destroy",value:function(){this._rows=void 0,this._buf=void 0,this._bin=void 0}},{key:"get",value:function(t){return 0<(this._bin[t>>3]&1<<t%8)}},{key:"set",value:function(t,e){var i=t>>3,t=1<<t%8;return e?this._bin[i]|=t:this._bin[i]&=t^=255,this}},{key:"fill",value:function(t){t=t?255:0;for(var e=0,i=this._rows;e<i;e++)this._bin[e]=t;return this}},{key:"resize",value:function(t){t=1+(t>>3);return t!==this._rows&&(this._rows=t,this._buf=new ArrayBuffer(this._rows),this._bin=new Uint8Array(this._buf)),this}}]),e}()),g=Phaser.Utils.Objects.GetValue,w=function(){function e(t){n(this,e),this.resize(t)}return o(e,[{key:"destroy",value:function(){this._rows=void 0,this._buf=void 0,this._colors=void 0}},{key:"get",value:function(t){return this._colors[t]}},{key:"set",value:function(t,e){return this._colors[t]=e,this}},{key:"fill",value:function(t){for(var e=0,i=this._rows;e<i;e++)this._colors[e]=t;return this}},{key:"resize",value:function(t){return t!==this._rows&&(this._rows=t,this._buf=new ArrayBuffer(4*this._rows),this._colors=new Uint32Array(this._buf)),this}}]),e}(),_=Phaser.GameObjects.GameObject,m=Phaser.Utils.Objects.GetValue,O=Phaser.Display.Canvas.CanvasPool,e={textObjectToBitmap:t,canvasObjectToBitmap:t,textureTColorMap:function(t,e,i,r){"string"==typeof t?("string"!=typeof e&&(r=i,i=e,e=void 0),n=this.textureManager.getFrame(t,e)):(n=t instanceof _?t.frame:t,r=i,i=e),i instanceof p&&(r=i,i=void 0);var n,o,t=void 0!==this._tmpCanvas,e=t?this._tmpCanvas:O.create2D(this,void 0,void 0,void 0,!0),u=m(i,"x",void 0),s=m(i,"y",void 0),a=m(i,"width",void 0),i=m(i,"height",void 0);return r=h((n=n,(o=e).width=n.cutWidth,o.height=n.cutHeight,o.getContext("2d",{willReadFrequently:!0}).drawImage(n.source.image,n.cutX,n.cutY,n.cutWidth,n.cutHeight),o),u,s,a,i,w,v,void 0,r),t?(e.width=1,e.height=1):O.remove(e),r}},j=Phaser.Display.Canvas.CanvasPool,i=function(t){var e=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t);var i=f(r);function r(t){return n(this,r),i.call(this,t)}return o(r,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this),this._tmpCanvas=j.create2D(this)}},{key:"destroy",value:function(){j.remove(this._tmpCanvas),this._tmpCanvas=void 0,c(u(r.prototype),"destroy",this).call(this)}},{key:"textureManager",get:function(){return this.game.textures}}]),r}(Phaser.Plugins.BasePlugin);return Object.assign(i.prototype,e),i});

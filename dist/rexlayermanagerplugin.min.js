!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexlayermanagerplugin=e()}(void 0,function(){function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(i.key),i)}}function t(t,e,n){e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);return s(this,i?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(i)return(i=Object.getOwnPropertyDescriptor(i,e)).get?i.get.call(arguments.length<3?t:n):i.value}).apply(this,arguments)}function a(t){return t>>16&255}function f(t){return t>>8&255}function l(t){return 255&t}function d(e,n){var i,r,o;e.hasOwnProperty("tintR")||(i=a(n=void 0===n?16777215:n),r=f(n),o=l(n),Object.defineProperty(e,"tint",{get:function(){return n},set:function(t){t=16777215&Math.floor(t),e.setTint&&e.setTint(t),n!==t&&(i=a(n=t),r=f(n),o=l(n))}}),Object.defineProperty(e,"tintR",{get:function(){return i},set:function(t){t=255&Math.floor(t),i!==t&&(i=t,e.tint=(255&t)<<16|n&j)}}),Object.defineProperty(e,"tintG",{get:function(){return r},set:function(t){t=255&Math.floor(t),r!==t&&(r=t,e.tint=(255&t)<<8|n&G)}}),Object.defineProperty(e,"tintB",{get:function(){return o},set:function(t){t=255&Math.floor(t),o!==t&&(o=t,e.tint=255&t|n&_)}}),Object.defineProperty(e,"tintGray",{get:function(){return Math.floor((i+r+o)/3)},set:function(t){t=255&Math.floor(t),i===t&&r===t&&o===t||(o=r=i=t,e.tint=(255&t)<<16|(255&t)<<8|255&t)}}),e.tint=n)}function v(t,e,n,i,r,o){return void 0===o?o={}:!0===o&&(o=A),"number"!=typeof n&&(i=n=0),o.x=r.x+r.width*t+n,o.y=r.y+r.height*e+i,o}function y(t,e,n,i,r,o,s){var a,u,h,c,f,l,d;function y(){s(n,i,r,o,e,t)}t.hasOwnProperty("vp")||("function"==typeof n&&(s=n,n=void 0),"function"==typeof r&&(s=r,r=void 0),void 0===n&&(n=.5),void 0===i&&(i=.5),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=v),(a=e).events||(u=new T,h=a.x,Object.defineProperty(a,"x",{get:function(){return h},set:function(t){h!==t&&(h=t,u.emit("update",a))}}),c=a.y,Object.defineProperty(a,"y",{get:function(){return c},set:function(t){c!==t&&(c=t,u.emit("update",a))}}),f=a.width,Object.defineProperty(a,"width",{get:function(){return f},set:function(t){f!==t&&(f=t,u.emit("update",a))}}),l=a.height,Object.defineProperty(a,"height",{get:function(){return l},set:function(t){l!==t&&(l=t,u.emit("update",a))}}),a.events=u),d=e.events,t.vp=e,d.on("update",y),t.once("destroy",function(){d.off("update",y),t.vp=void 0}),Object.defineProperty(t,"vpx",{get:function(){return n},set:function(t){n!==t&&(n=t,y())}}),Object.defineProperty(t,"vpy",{get:function(){return i},set:function(t){i!==t&&(i=t,y())}}),Object.defineProperty(t,"vpxOffset",{get:function(){return r},set:function(t){r!==t&&(r=t,y())}}),Object.defineProperty(t,"vpyOffset",{get:function(){return o},set:function(t){o!==t&&(o=t,y())}}),y())}function p(t){return void 0!==t.displayWidth?t.displayWidth:t.width}function m(t){return void 0!==t.displayHeight?t.displayHeight:t.height}function b(t,e,n){return void 0===n&&(n=!1),0!==t.rotation&&F(e,t.x,t.y,t.rotation),n&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e),e}function e(t,e,n){return e instanceof V||(n=e,e=void 0),void 0===n?n=new B:!0===n&&(n=N),e?t.scale.getViewPort(e,n):t.scale.getViewPort(n)}var g={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},O={hasProperty:function(t){var e=this.gameObject;return!!e.hasOwnProperty(t)||void 0!==e[t]},getProperty:function(t){return this.gameObject[t]},setProperty:function(t,e){return this.gameObject[t]=e,this},easeProperty:function(t,e,n,i,r,o,s){var a=this.tweens,u=a[t],h=(u&&u.remove(),this.gameObject),n={targets:h,duration:n,ease:i,repeat:r,yoyo:o,onComplete:function(){a[t].remove(),a[t]=null,s&&s(h,t)},onCompleteScope:this};return n[t]=e,(u=this.scene.tweens.add(n)).timeScale=this.timeScale,a[t]=u,this}},w={hasMethod:function(t){return"function"==typeof this.gameObject[t]},call:function(t){if(this.hasMethod(t)){for(var e=this.gameObject,n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e[t].apply(e,i)}return this}},E=function(){function i(t,e,n){u(this,i),this.GOManager=t,this.tweens={},this.setGO(e,n)}return t(i,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0}},{key:"freeTweens",value:function(){var t,e,n=this.tweens;for(e in n)(t=n[e])&&t.remove(),n[e]=null;return this}},{key:"freeGO",value:function(){return this.freeTweens(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return t.setName(e),this.gameObject=t,this.name=e,this.freeTweens(),this}},{key:"setTimeScale",value:function(t){var e,n=this.tweens;for(e in n){var i=n[e];i&&(i.timeScale=t)}return this}}]),i}(),P=(Object.assign(E.prototype,O,w,{hasData:function(t){var e=this.gameObject;return!!e.data&&e.data.has(t)},getData:function(t){return this.gameObject.getData(t)},setData:function(t,e){return this.gameObject.setData(t,e),this}}),{tint:0,alpha:1}),j=65535,G=16711935,_=16776960,T=Phaser.Events.EventEmitter,A={},D=Phaser.Utils.Array.Remove,x=(Phaser.Geom.Rectangle,Phaser.Math.Vector2),F=Phaser.Math.RotateAround,C=void 0,k=Phaser.Utils.Objects.GetValue,S=function(t,e,n,i,r,o,s){var a,u,h,c,f,l;(t.getBounds||void 0!==t.width&&void 0!==t.height)&&(void 0===n&&(n=16777215),void 0===i&&(i=1),void 0===r&&(r=null),void 0===o&&(o=1),void 0===s&&(s=0),c=t,void 0===(f=M[0])?f=new x:!0===f&&(f=C=void 0===C?new x:C),(c=c.getTopLeft?c.getTopLeft(f):(f.x=c.x-p(c)*c.originX,f.y=c.y-m(c)*c.originY,b(c,f,h))).x-=s,c.y-=s,f=t,void 0===(h=M[1])?h=new x:!0===h&&(h=C=void 0===C?new x:C),(c=f.getTopRight?f.getTopRight(h):(h.x=f.x-p(f)*f.originX+p(f),h.y=f.y-m(f)*f.originY,b(f,h,a))).x+=s,c.y-=s,f=t,void 0===(h=M[2])?h=new x:!0===h&&(h=C=void 0===C?new x:C),(a=f.getBottomRight?f.getBottomRight(h):(h.x=f.x-p(f)*f.originX+p(f),h.y=f.y-m(f)*f.originY+m(f),b(f,h,u))).x+=s,a.y+=s,c=t,void 0===(f=M[3])?f=new x:!0===f&&(f=C=void 0===C?new x:C),(h=c.getBottomLeft?c.getBottomLeft(f):(f.x=c.x-p(c)*c.originX,f.y=c.y-m(c)*c.originY+m(c),b(c,f,l))).x-=s,h.y+=s,null!==r&&e.fillStyle(r,o).fillPoints(M,!0,!0),null!==n)&&e.lineStyle(i,n).strokePoints(M,!0,!0)},M=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],O={drawGameObjectsBounds:function(c,f){return this.forEachGO(function(t){if(t.drawBounds)t.drawBounds(c,f);else{var e,n,i,r,o,s=t,a=c,t=f;if("number"==typeof t?e=t:(e=k(t,"color"),n=k(t,"lineWidth"),i=k(t,"fillColor"),r=k(t,"fillAlpha",1),o=k(t,"padding",0)),Array.isArray(s))for(var u=0,h=s.length;u<h;u++)S(s[u],a,e,n,i,r,o);else S(s,a,e,n,i,r,o)}}),this}},V=(Object.assign(O,{setGOFadeMode:function(t){return this.fadeMode=t="string"==typeof t?P[t]:t,this},setGOFadeTime:function(t){return this.fadeTime=t,this},hasTintFadeEffect:function(t){return(void 0===this.fadeMode||0===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setTint},hasAlphaFadeEffect:function(t){return(void 0===this.fadeMode||1===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setAlpha},fadeBob:function(t,e,n,i){var r=t.gameObject;return this.hasTintFadeEffect(r)?(void 0!==e&&t.setProperty("tintGray",255*e),t.easeProperty("tintGray",Math.floor(255*n),this.fadeTime,"Linear",0,!1,i)):this.hasAlphaFadeEffect(r)?(void 0!==e&&t.setProperty("alpha",e),t.easeProperty("alpha",n,this.fadeTime,"Linear",0,!1,i)):i&&i(r),this}},{has:function(t){return this.bobs.hasOwnProperty(t)},exists:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){t=this.get(t);return t?t.gameObject:null},addGO:function(t,e){this.remove(t,!0),this.hasTintFadeEffect(e)&&d(e),this.viewportCoordinateEnable&&y(e,this.viewport),e.once("destroy",function(){D(this.removedGOs,e),this.isEmpty&&this.emit("empty")},this);var n=new this.BobClass(this,e,t);return this.bobs[t]=n,this},add:function(t){for(var e=this.createGameObjectCallback,n=this.createGameObjectScope,i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];e=e.call.apply(e,[n,this.scene].concat(r)),this.addGO(t,e),n=this.get(t);return this.fadeBob(n,0,1),this},forEachGO:function(t,e){for(var n in this.bobs){var i=this.bobs[n].gameObject,i=e?t.call(e,i,n,this):t(i,n,this);if(i)break}return this}},{remove:function(t,e){var n;return this.has(t)&&(n=this.get(t),delete this.bobs[t],this.removedGOs.push(n.gameObject),e?n.destroy():this.fadeBob(n,void 0,0,function(){n.destroy()})),this},removeAll:function(){for(var t in this.bobs)this.remove(t);return this},clear:function(t){void 0===t&&(t=!0);var e,n=this.bobs;for(e in n)t&&n[e].destroy(),delete n[e];return this.removedGOs.length=0,this}},{hasProperty:function(t,e){return!!this.has(t)&&this.get(t).hasProperty(e)},getProperty:function(t,e){if(this.has(t))return this.get(t).getProperty(e)},isNumberProperty:function(t,e){return"number"==typeof this.getProperty(t,e)},setProperty:function(t,e,n){return this.has(t)&&(this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).setProperty(e,n)),this},easeProperty:function(t,e,n,i,r,o,s,a){return this.has(t)&&(void 0===i&&(i=1e3),void 0===r&&(r="Linear"),void 0===o&&(o=0),void 0===s&&(s=!1),this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).easeProperty(e,n,i,r,o,s,a)),this},hasTweenTask:function(t,e){return!!this.has(t)&&this.get(t).tweens.hasOwnProperty(e)},getTweenTask:function(t,e){return this.has(t)&&this.get(t).tweens[e]||null}},{hasMethod:function(t,e){return!!this.has(t)&&this.get(t).hasMethod(e)},call:function(t,e){var n;if(this.has(t)){for(var i=arguments.length,r=new Array(2<i?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];(n=this.get(t)).call.apply(n,[e].concat(r))}return this}},{hasData:function(t,e){return!!this.has(t)&&this.get(t).hasData(e)},getData:function(t,e){if(this.has(t))return this.get(t).getData(e)},setData:function(t,e,n){return this.has(t)&&this.get(t).setData(e,n),this}}),Phaser.Cameras.Scene2D.BaseCamera),B=Phaser.Geom.Rectangle,N=new B,R=Phaser.Utils.Objects.GetValue,L=function(){function n(t,e){u(this,n),this.scene=t,this.BobClass=R(e,"BobClass",E),this.setCreateGameObjectCallback(R(e,"createGameObject"),R(e,"createGameObjectScope")),this.setEventEmitter(R(e,"eventEmitter",void 0));t=R(e,"fade",500),"number"==typeof t?(this.setGOFadeMode(),this.setGOFadeTime(t)):(this.setGOFadeMode(R(t,"mode")),this.setGOFadeTime(R(t,"time",500))),t=R(e,"viewportCoordinate",!1);!1!==t?(this.setViewportCoordinateEnable(R(e,"enable",!0)),this.setViewport(R(t,"viewport"))):this.setViewportCoordinateEnable(!1),this.setSymbols(R(e,"symbols")),this.bobs={},this.removedGOs=[],this._timeScale=1}return t(n,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.viewport=void 0,this.scene=void 0}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e,n=this.bobs;for(e in n)n[e].setTimeScale(t)}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t,e){return this.createGameObjectCallback=t,this.createGameObjectScope=e,this}},{key:"setViewportCoordinateEnable",value:function(t){return this.viewportCoordinateEnable=t=void 0===t?!0:t,this}},{key:"setViewport",value:function(t){return void 0===t&&(t=e(this.scene,this.scene.cameras.main)),this.viewport=t,this}},{key:"setSymbols",value:function(t){return this.symbols=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return!1;return!0}(this.bobs)&&0===this.removedGOs.length}}]),n}(),I=(Object.assign(L.prototype,g,O),Phaser.Utils.Objects.GetValue),U=function(){r(a,L);var s=h(a);function a(t,e){u(this,a),void 0===e?e={}:Array.isArray(e)&&(e={layers:e}),e.hasOwnProperty("fade")||(e.fade=0),e.viewportCoordinate=!1,n=s.call(this,t,e);var n,i=I(e,"layers");if(i)for(var r=0,o=i.length;r<o;r++)n.add(i[r]);return n}return t(a,[{key:"setCreateGameObjectCallback",value:function(t,e){return t=t||X,c(o(a.prototype),"setCreateGameObjectCallback",this).call(this,t,e),this}},{key:"addGO",value:function(t,e){return c(o(a.prototype),"addGO",this).call(this,t,e),e.name=t,this}},{key:"getLayer",value:function(t){return this.getGO(t)}},{key:"getLayers",value:function(e){var t,n,i;return void 0===e&&(e=[]),this.forEachGO(function(t){e.push(t)}),n=!1,(t=e).length<=1||(void 0===n&&(n=!1),(i=t[0].scene.sys.displayList).depthSort(),n?t.sort(function(t,e){return i.getIndex(e)-i.getIndex(t)}):t.sort(function(t,e){return i.getIndex(t)-i.getIndex(e)})),e}},{key:"addToLayer",value:function(t,e){var n=this.getGO(t);if(n)return e.isRexContainerLite?e.addToLayer(n):n.add(e),this;console.warn("Can't get layer \"".concat(t,'"'))}}]),a}(),X=function(t,e){t=t.add.layer();return void 0!==e&&t.setDepth(e),t};return function(){r(n,Phaser.Plugins.BasePlugin);var e=h(n);function n(t){return u(this,n),e.call(this,t)}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new U(t,e)}}]),n}()});

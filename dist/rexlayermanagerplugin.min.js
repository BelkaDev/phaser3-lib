!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexlayermanagerplugin=e();}(undefined,(function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(r,"string"))?o:String(o)),n);}var r,o;}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e);}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return !1;if(Reflect.construct.sham)return !1;if("function"==typeof Proxy)return !0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return !1}}();return function(){var i,n=r(t);if(e){var o=r(this).constructor;i=Reflect.construct(n,arguments,o);}else i=n.apply(this,arguments);return s(this,i)}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},u.apply(this,arguments)}var f={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},h={hasProperty:function(t){var e=this.gameObject;return !!e.hasOwnProperty(t)||void 0!==e[t]},getProperty:function(t){return this.gameObject[t]},setProperty:function(t,e){return this.gameObject[t]=e,this},easeProperty:function(t,e,i,n,r,o,s,a){void 0===a&&(a=this.gameObject);var u=this.tweens,f=u[t];f&&f.remove();var h={targets:a,duration:i,ease:n,repeat:r,yoyo:o,onComplete:function(){u[t].remove(),u[t]=null,s&&s(a,t);},onCompleteScope:this};return h[t]=e,(f=this.scene.tweens.add(h)).timeScale=this.timeScale,u[t]=f,this},freeTweens:function(){var t,e=this.tweens;for(var i in e)(t=e[i])&&t.remove(),e[i]=null;return this}},c={hasMethod:function(t){return "function"==typeof this.gameObject[t]},call:function(t){if(!this.hasMethod(t))return this;for(var e=this.gameObject,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return e[t].apply(e,n),this}},l=Phaser.Utils.String.UppercaseFirst,v={hasEffect:function(t){return this.effects.hasOwnProperty(t)},getEffect:function(t){return this.effects[t]},setEffect:function(t,e){var i,n=this.gameObject.preFX;if(!n)return this;if(this.hasEffect(t))return this;for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];return this.effects[t]=(i=n["add".concat(l(e))]).call.apply(i,[n].concat(o)),this},removeEffect:function(t){var e=this.getEffect(t);return e?(this.gameObject.preFX.remove(e),this.effects[t]=null,this):this},freeEffects:function(){var t=this.gameObject.preFX,e=this.effects;for(var i in e){var n=e[i];t.remove(n),e[i]=null;}return this}},d=function(){function e(i,n,r){t(this,e),this.GOManager=i,this.tweens={},this.effects={},this.setGO(n,r);}return i(e,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0;}},{key:"freeGO",value:function(){return this.freeTweens(),this.freeEffects(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return t.setName(e),this.gameObject=t,this.name=e,this.freeTweens(),this}},{key:"setTimeScale",value:function(t){var e=this.tweens;for(var i in e){var n=e[i];n&&(n.timeScale=t);}return this}}]),e}();Object.assign(d.prototype,h,c,{hasData:function(t){var e=this.gameObject;return !!e.data&&e.data.has(t)},getData:function(t){return this.gameObject.getData(t)},setData:function(t,e){return this.gameObject.setData(t,e),this}},v);var y={tint:0,alpha:1,revealUp:2,revealDown:3,revealLeft:4,revealRight:5},p={setGOFadeMode:function(t){return "string"==typeof t&&(t=y[t]),this.fadeMode=t,this},setGOFadeTime:function(t){return this.fadeTime=t,this},useTintFadeEffect:function(t){return (void 0===this.fadeMode||0===this.fadeMode)&&this.fadeTime>0&&void 0!==t.setTint},useAlphaFadeEffect:function(t){return (void 0===this.fadeMode||1===this.fadeMode)&&this.fadeTime>0&&void 0!==t.setAlpha},useRevealEffect:function(t){return this.fadeMode>=2&&this.fadeMode<=5&&this.fadeTime>0&&void 0!==t.preFX},fadeBob:function(t,e,i,n){var r=t.gameObject;if(this.useTintFadeEffect(r))void 0!==e&&t.setProperty("tintGray",255*e),t.easeProperty("tintGray",Math.floor(255*i),this.fadeTime,"Linear",0,!1,n);else if(this.useAlphaFadeEffect(r))void 0!==e&&t.setProperty("alpha",e),t.easeProperty("alpha",i,this.fadeTime,"Linear",0,!1,n);else if(this.useRevealEffect(r)){t.removeEffect("reveal");var o=2===this.fadeMode||4===this.fadeMode?1:0,s=2===this.fadeMode||3===this.fadeMode?1:0;t.setEffect("fade_reveal","reveal",.1,o,s);var a=t.getEffect("fade_reveal");void 0!==e&&(a.progress=e),t.easeProperty("progress",i,this.fadeTime,"Linear",0,!1,n,a);}else n&&n(r);return this}},m=function(t){return t>>16&255},g=function(t){return t>>8&255},b=function(t){return 255&t},O=Phaser.Events.EventEmitter,E=function(t,e,i,n,r,o){return void 0===o?o={}:!0===o&&(o=w),"number"!=typeof i&&(i=0,n=0),o.x=r.x+r.width*t+i,o.y=r.y+r.height*e+n,o},w={},P=function(t,e,i,n,r,o,s){if(t.hasOwnProperty("vp"))return t;"function"==typeof i&&(s=i,i=void 0),"function"==typeof r&&(s=r,r=void 0),void 0===i&&(i=.5),void 0===n&&(n=.5),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=E),function(t){if(t.events)return t;var e=new O,i=t.x;Object.defineProperty(t,"x",{get:function(){return i},set:function(n){i!==n&&(i=n,e.emit("update",t));}});var n=t.y;Object.defineProperty(t,"y",{get:function(){return n},set:function(i){n!==i&&(n=i,e.emit("update",t));}});var r=t.width;Object.defineProperty(t,"width",{get:function(){return r},set:function(i){r!==i&&(r=i,e.emit("update",t));}});var o=t.height;Object.defineProperty(t,"height",{get:function(){return o},set:function(i){o!==i&&(o=i,e.emit("update",t));}}),t.events=e;}(e);var a=e.events;t.vp=e;var u=function(){s(i,n,r,o,e,t);};a.on("update",u),t.once("destroy",(function(){a.off("update",u),t.vp=void 0;})),Object.defineProperty(t,"vpx",{get:function(){return i},set:function(t){i!==t&&(i=t,u());}}),Object.defineProperty(t,"vpy",{get:function(){return n},set:function(t){n!==t&&(n=t,u());}}),Object.defineProperty(t,"vpxOffset",{get:function(){return r},set:function(t){r!==t&&(r=t,u());}}),Object.defineProperty(t,"vpyOffset",{get:function(){return o},set:function(t){o!==t&&(o=t,u());}}),u();},j=Phaser.Utils.Array.Remove,_={has:function(t){return this.bobs.hasOwnProperty(t)},exists:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){var e=this.get(t);return e?e.gameObject:null},addGO:function(t,e){this.remove(t,!0),this.useTintFadeEffect(e)&&function(t,e){if(t.hasOwnProperty("tintR"))return t;void 0===e&&(e=16777215);var i=m(e),n=g(e),r=b(e);Object.defineProperty(t,"tint",{get:function(){return e},set:function(o){o=16777215&Math.floor(o),t.setTint&&t.setTint(o),e!==o&&(i=m(e=o),n=g(e),r=b(e));}}),Object.defineProperty(t,"tintR",{get:function(){return i},set:function(n){n=255&Math.floor(n),i!==n&&(i=n,t.tint=(255&n)<<16|65535&e);}}),Object.defineProperty(t,"tintG",{get:function(){return n},set:function(i){i=255&Math.floor(i),n!==i&&(n=i,t.tint=(255&i)<<8|16711935&e);}}),Object.defineProperty(t,"tintB",{get:function(){return r},set:function(i){i=255&Math.floor(i),r!==i&&(r=i,t.tint=255&i|16776960&e);}}),Object.defineProperty(t,"tintGray",{get:function(){return Math.floor((i+n+r)/3)},set:function(e){e=255&Math.floor(e),i===e&&n===e&&r===e||(i=e,n=e,r=e,t.tint=(255&e)<<16|(255&e)<<8|255&e);}}),t.tint=e;}(e),this.viewportCoordinateEnable&&P(e,this.viewport),e.once("destroy",(function(){j(this.removedGOs,e),this.isEmpty&&this.emit("empty");}),this);var i=new this.BobClass(this,e,t);return this.bobs[t]=i,this},add:function(t){for(var e=this.createGameObjectCallback,i=this.createGameObjectScope,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var s=e.call.apply(e,[i,this.scene].concat(r));this.addGO(t,s);var a=this.get(t);return this.fadeBob(a,0,1),this},forEachGO:function(t,e){for(var i in this.bobs){var n=this.bobs[i].gameObject;if(e?t.call(e,n,i,this):t(n,i,this))break}return this}},G={remove:function(t,e){if(!this.has(t))return this;var i=this.get(t);return delete this.bobs[t],this.removedGOs.push(i.gameObject),e?i.destroy():this.fadeBob(i,void 0,0,(function(){i.destroy();})),this},removeAll:function(){var t=this.bobs;for(var e in t)this.remove(e);return this},clear:function(t){void 0===t&&(t=!0);var e=this.bobs;for(var i in e)t&&e[i].destroy(),delete e[i];return this.removedGOs.length=0,this}},T={hasProperty:function(t,e){return !!this.has(t)&&this.get(t).hasProperty(e)},getProperty:function(t,e){if(this.has(t))return this.get(t).getProperty(e)},isNumberProperty:function(t,e){return "number"==typeof this.getProperty(t,e)},setProperty:function(t,e,i){return this.has(t)?(this.symbols&&"string"==typeof i&&this.isNumberProperty(t,e)&&(i in this.symbols?i=this.symbols[i]:console.warn("Can't find symbol ".concat(i))),this.get(t).setProperty(e,i),this):this},easeProperty:function(t,e,i,n,r,o,s,a){return this.has(t)?(void 0===n&&(n=1e3),void 0===r&&(r="Linear"),void 0===o&&(o=0),void 0===s&&(s=!1),this.symbols&&"string"==typeof i&&this.isNumberProperty(t,e)&&(i in this.symbols?i=this.symbols[i]:console.warn("Can't find symbol ".concat(i))),this.get(t).easeProperty(e,i,n,r,o,s,a),this):this},hasTweenTask:function(t,e){return !!this.has(t)&&this.get(t).tweens.hasOwnProperty(e)},getTweenTask:function(t,e){if(!this.has(t))return null;var i=this.get(t).tweens[e];return i||null}},x={hasMethod:function(t,e){return !!this.has(t)&&this.get(t).hasMethod(e)},call:function(t,e){var i;if(!this.has(t))return this;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return (i=this.get(t)).call.apply(i,[e].concat(r)),this}},C={hasData:function(t,e){return !!this.has(t)&&this.get(t).hasData(e)},getData:function(t,e){if(this.has(t))return this.get(t).getData(e)},setData:function(t,e,i){return this.has(t)?(this.get(t).setData(e,i),this):this}},k=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},M=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height};Phaser.Geom.Rectangle;var S=Phaser.Math.Vector2,R=Phaser.Math.RotateAround,L=void 0,B=function(t,e,i){(void 0===i&&(i=!1),0!==t.rotation&&R(e,t.x,t.y,t.rotation),i&&t.parentContainer)&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},A=Phaser.Utils.Objects.GetValue,D=function(t,e,i,n,r,o,s){if(t.getBounds||void 0!==t.width&&void 0!==t.height){void 0===i&&(i=16777215),void 0===n&&(n=1),void 0===r&&(r=null),void 0===o&&(o=1),void 0===s&&(s=0);var a=function(t,e,i){return void 0===e?e=new S:!0===e&&(void 0===L&&(L=new S),e=L),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-k(t)*t.originX,e.y=t.y-M(t)*t.originY,B(t,e,i))}(t,F[0]);a.x-=s,a.y-=s;var u=function(t,e,i){return void 0===e?e=new S:!0===e&&(void 0===L&&(L=new S),e=L),t.getTopRight?t.getTopRight(e):(e.x=t.x-k(t)*t.originX+k(t),e.y=t.y-M(t)*t.originY,B(t,e,i))}(t,F[1]);u.x+=s,u.y-=s;var f=function(t,e,i){return void 0===e?e=new S:!0===e&&(void 0===L&&(L=new S),e=L),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-k(t)*t.originX+k(t),e.y=t.y-M(t)*t.originY+M(t),B(t,e,i))}(t,F[2]);f.x+=s,f.y+=s;var h=function(t,e,i){return void 0===e?e=new S:!0===e&&(void 0===L&&(L=new S),e=L),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-k(t)*t.originX,e.y=t.y-M(t)*t.originY+M(t),B(t,e,i))}(t,F[3]);h.x-=s,h.y+=s,null!==r&&e.fillStyle(r,o).fillPoints(F,!0,!0),null!==i&&e.lineStyle(n,i).strokePoints(F,!0,!0);}},F=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],V={drawGameObjectsBounds:function(t,e){return this.forEachGO((function(i){i.drawBounds?i.drawBounds(t,e):function(t,e,i){var n,r,o,s,a;if("number"==typeof i?n=i:(n=A(i,"color"),r=A(i,"lineWidth"),o=A(i,"fillColor"),s=A(i,"fillAlpha",1),a=A(i,"padding",0)),Array.isArray(t))for(var u=0,f=t.length;u<f;u++)D(t[u],e,n,r,o,s,a);else D(t,e,n,r,o,s,a);}(i,t,e);})),this}};Object.assign(V,p,_,G,T,x,C);var X=Phaser.Cameras.Scene2D.BaseCamera,N=Phaser.Geom.Rectangle,U=function(t,e,i){return e instanceof X||(i=e,e=void 0),void 0===i?i=new N:!0===i&&(i=I),e?t.scale.getViewPort(e,i):t.scale.getViewPort(i)},I=new N,Y=Phaser.Utils.Objects.GetValue,W=function(){function e(i,n){t(this,e),this.scene=i,this.BobClass=Y(n,"BobClass",d),this.setCreateGameObjectCallback(Y(n,"createGameObject"),Y(n,"createGameObjectScope")),this.setEventEmitter(Y(n,"eventEmitter",void 0));var r=Y(n,"fade",500);"number"==typeof r?(this.setGOFadeMode(),this.setGOFadeTime(r)):(this.setGOFadeMode(Y(r,"mode")),this.setGOFadeTime(Y(r,"time",500)));var o=Y(n,"viewportCoordinate",!1);!1!==o?(this.setViewportCoordinateEnable(Y(n,"enable",!0)),this.setViewport(Y(o,"viewport"))):this.setViewportCoordinateEnable(!1),this.setSymbols(Y(n,"symbols")),this.bobs={},this.removedGOs=[],this._timeScale=1;}return i(e,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.viewport=void 0,this.scene=void 0;}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e=this.bobs;for(var i in e)e[i].setTimeScale(t);}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t,e){return this.createGameObjectCallback=t,this.createGameObjectScope=e,this}},{key:"setViewportCoordinateEnable",value:function(t){return void 0===t&&(t=!0),this.viewportCoordinateEnable=t,this}},{key:"setViewport",value:function(t){return void 0===t&&(t=U(this.scene,this.scene.cameras.main)),this.viewport=t,this}},{key:"setSymbols",value:function(t){return this.symbols=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return !1;return !0}(this.bobs)&&0===this.removedGOs.length}}]),e}();Object.assign(W.prototype,f,V);var H=Phaser.Utils.Objects.GetValue,q=function(e){n(s,e);var o=a(s);function s(e,i){var n;t(this,s),void 0===i?i={}:Array.isArray(i)&&(i={layers:i}),i.hasOwnProperty("fade")||(i.fade=0),i.viewportCoordinate=!1,n=o.call(this,e,i);var r=H(i,"layers");if(r)for(var a=0,u=r.length;a<u;a++)n.add(r[a]);return n}return i(s,[{key:"setCreateGameObjectCallback",value:function(t,e){return t||(t=z),u(r(s.prototype),"setCreateGameObjectCallback",this).call(this,t,e),this}},{key:"addGO",value:function(t,e){return u(r(s.prototype),"addGO",this).call(this,t,e),e.name=t,this}},{key:"getLayer",value:function(t){return this.getGO(t)}},{key:"getLayers",value:function(t){return void 0===t&&(t=[]),this.forEachGO((function(e){t.push(e);})),function(t,e){if(t.length<=1)return t;void 0===e&&(e=!1);var i=t[0].scene.sys.displayList;i.depthSort(),e?t.sort((function(t,e){return i.getIndex(e)-i.getIndex(t)})):t.sort((function(t,e){return i.getIndex(t)-i.getIndex(e)}));}(t,!1),t}},{key:"addToLayer",value:function(t,e){var i=this.getGO(t);if(i)return e.isRexContainerLite?e.addToLayer(i):i.add(e),this;console.warn("Can't get layer \"".concat(t,'"'));}}]),s}(W),z=function(t,e){var i=t.add.layer();return void 0!==e&&i.setDepth(e),i};return function(e){n(o,Phaser.Plugins.BasePlugin);var r=a(o);function o(e){return t(this,o),r.call(this,e)}return i(o,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}},{key:"add",value:function(t,e){return new q(t,e)}}]),o}()}));

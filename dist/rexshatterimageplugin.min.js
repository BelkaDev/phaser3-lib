!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexshatterimageplugin=e()}(void 0,function(){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(n.key),n)}}function t(t,e,r){e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1})}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=i(r);return s(this,n?(t=i(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}(t,e);if(n)return(n=Object.getOwnPropertyDescriptor(n,e)).get?n.get.call(arguments.length<3?t:r):n.value}).apply(this,arguments)}function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var w;function x(t,e,r,n){var i,s,o,a,u,h,c,l=t[e][0],f=t[e][1],y=t[r][0],p=t[r][1],g=t[n][0],t=t[n][1],d=Math.abs(f-p),v=Math.abs(p-t);if(d<w&&v<w)throw new Error("Eek! Coincident points!");return l=d<w?(o=-(g-y)/(t-p))*((i=(y+l)/2)-(u=(y+g)/2))+(c=(p+t)/2):v<w?(s=-(y-l)/(p-f))*((i=(g+y)/2)-(a=(l+y)/2))+(h=(f+p)/2):(i=((s=-(y-l)/(p-f))*(a=(l+y)/2)-(o=-(g-y)/(t-p))*(u=(y+g)/2)+(c=(p+t)/2)-(h=(f+p)/2))/(s-o),v<d?s*(i-a)+h:o*(i-u)+c),{i:e,j:r,k:n,x:i,y:l,r:(g=y-i)*g+(t=p-l)*t}}w=1/1048576;function T(t){for(var e,r,n,i,s=((l=t.rectangle)?(e=l.x,r=l.y,n=l.width,l):(r=e=0,n=t.width,t)).height,o=e+n,a=r+s,u=void 0===(l=t.center)?(i=(e+o)/2,(r+a)/2):(i=S(l.x,e,o),S(l.y,r,a)),h=G(t,"ringRadiusList",M),c=G(t,"samplesPerRing",12),l=G(t,"variation",.25),f=G(t,"triangleOutput",!0),y=((t=h)&&"function"==typeof t&&(h=h(n,s)),1-l),p=1+l,g=0;g<10;g++)try{var d=R(i,u,n,s,h,c,y,p,e,o,r,a),v=f,m=(void 0===v&&(v=!0),k.triangulate(d));if(v){for(var b=[],P=0,w=m.length;P<w;P+=3){var x=d[m[P+0]],O=d[m[P+1]],j=d[m[P+2]],x=new I(x[0],x[1],O[0],O[1],j[0],j[1]);b.push(x)}return b}return{vertices:d,indices:m}}catch(t){}throw new Error("Generate triangles fail")}function R(t,e,r,n,i,s,o,a,u,h,c,l){for(var f=[],y=(f.push([t,e]),Math.min(r,n)),p=0,g=i.length;p<g;p++)d(f,t,e,y*i[p],s,o,a,u,h,c,l);return y=2*Math.max(r,n),d(f,t,e,y,s,o,a,u,h,c,l),f}function p(t,e){return t===e?t:t+(e-t)*Math.random()}var k=o({triangulate:function(r,t){var e,n,i,s,o,a,u,h,c,l,f,y=r.length;if(y<3)return[];if(r=r.slice(0),t)for(e=y;e--;)r[e]=r[e][t];for(i=new Array(y),e=y;e--;)i[e]=e;for(i.sort(function(t,e){return r[e][0]-r[t][0]}),s=function(t){for(var e,r,n,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,u=t.length;u--;)t[u][0]<i&&(i=t[u][0]),t[u][0]>o&&(o=t[u][0]),t[u][1]<s&&(s=t[u][1]),t[u][1]>a&&(a=t[u][1]);return n=a-s,[[(r=i+.5*(e=o-i))-20*(e=Math.max(e,n)),(n=s+.5*n)-e],[r,n+20*e],[r+20*e,n-e]]}(r),r.push(s[0],s[1],s[2]),o=[x(r,y+0,y+1,y+2)],a=[],u=[],e=i.length;e--;u.length=0){for(f=i[e],n=o.length;n--;)0<(h=r[f][0]-o[n].x)&&h*h>o[n].r?(a.push(o[n]),o.splice(n,1)):h*h+(h=r[f][1]-o[n].y)*h-o[n].r>w||(u.push(o[n].i,o[n].j,o[n].j,o[n].k,o[n].k,o[n].i),o.splice(n,1));m=v=d=g=P=p=b=void 0;for(var p,g,d,v,m,b=u,P=b.length;P;)for(d=b[--P],g=b[--P],p=P;p;)if(m=b[--p],g===(v=b[--p])&&d===m||g===m&&d===v){b.splice(P,2),b.splice(p,2);break}for(n=u.length;n;)l=u[--n],c=u[--n],o.push(x(r,c,l,f))}for(e=o.length;e--;)a.push(o[e]);for(o.length=0,e=a.length;e--;)a[e].i<y&&a[e].j<y&&a[e].k<y&&o.push(a[e].i,a[e].j,a[e].k);return o},contains:function(t,e){var r,n,i,s,o;return e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1]||(r=t[1][0]-t[0][0],o=t[2][0]-t[0][0],n=t[1][1]-t[0][1],0==(i=r*(s=t[2][1]-t[0][1])-o*n))||(s=(s*(e[0]-t[0][0])-o*(e[1]-t[0][1]))/i,o=(r*(e[1]-t[0][1])-n*(e[0]-t[0][0]))/i,s<0)||o<0||1<s+o?null:[s,o]}}),I=Phaser.Geom.Triangle,G=Phaser.Utils.Objects.GetValue,S=Phaser.Math.Clamp,M=[1/27,3/27,9/27],g=2*Math.PI,d=function(t,e,r,n,i,s,o,a,u,h,c){for(var l=0;l<i;l++){var f=l/i*g,y=e+Math.cos(f)*n*p(s,o),f=r+Math.sin(f)*n*p(s,o),y=S(y,a,u),f=S(f,h,c);t.push([y,f])}return t},l=Phaser.Geom.Mesh.Face,f=Phaser.Math.DegToRad,C=Phaser.Math.RadToDeg,L=Phaser.Geom.Mesh.RotateFace,D=function(){e(i,l);var n=h(i);function i(t,e,r){return u(this,i),(t=n.call(this,t,e,r))._rotation=0,t}return t(i,[{key:"rotation",get:function(){return this._rotation},set:function(t){L(this,t-this._rotation),this._rotation=t}},{key:"setRotation",value:function(t){return this.rotation=t,this}},{key:"angle",get:function(){return C(this.rotation)},set:function(t){this.rotation=f(t)}},{key:"setAngle",value:function(t){return this.angle=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"tint",get:function(){var t=this.vertex1.color,e=this.vertex2.color,r=this.vertex3.color;return(((t>>0&255)+(e>>0&255)+(r>>0&255))/3<<0)+(((t>>8&255)+(e>>8&255)+(r>>8&255))/3<<8)+(((t>>16&255)+(e>>16&255)+(r>>16&255))/3<<16)},set:function(t){this.vertex1.color=t,this.vertex2.color=t,this.vertex3.color=t}},{key:"setTint",value:function(t){return this.tint=t,this}}]),i}(),U=Phaser.Math.RotateAround,_={x:0,y:0},A=Phaser.GameObjects.Mesh,N=Phaser.Utils.Objects.IsPlainObject,y=Phaser.Utils.Objects.GetValue,F=Phaser.Geom.Mesh.GenerateGridVerts,E=Phaser.Geom.Mesh.Vertex,Y=Phaser.Math.Distance.Squared,B=[1/27,3/27,9/27],v=function(){e(a,A);var o=h(a);function a(t,e,r,n,i,s){return u(this,a),N(e)&&(e=y(s=e,"x",0),r=y(s,"y",0),n=y(s,"key",null),i=y(s,"frame",null)),(t=o.call(this,t,e,r,n,i)).type="rexShatterImage",t.hideCCW=!1,t.resetImage(),t.shatterCenter={x:null,y:null},t.setRingRadiusList(y(s,"ringRadiusList",B)),t.setSamplesPerRing(y(s,"samplesPerRing",12)),t.setVariation(y(s,"variation",.25)),t}return t(a,[{key:"setRingRadiusList",value:function(t){return this.ringRadiusList=t,this}},{key:"setSamplesPerRing",value:function(t){return this.samplesPerRing=t,this}},{key:"setVariation",value:function(t){return this.variation=t,this}},{key:"resetImage",value:function(){return this.setSizeToFrame(),this.clear(),this.dirtyCache[9]=-1,F({mesh:this,texture:this.texture.key,frame:this.frame.name,width:this.frame.cutWidth/this.height,height:this.frame.cutHeight/this.height}),this.setOrtho(this.width/this.height,1),this}},{key:"shatter",value:function(t,e,r){var n,i;if(N(t)&&(r=t,e=t=void 0),N(r)&&(r.hasOwnProperty("centerX")&&(t=r.centerX),r.hasOwnProperty("centerY")&&(e=r.centerY),r.hasOwnProperty("ringRadiusList")&&this.setRingRadiusList(r.ringRadiusList),r.hasOwnProperty("samplesPerRing")&&this.setSamplesPerRing(r.samplesPerRing),r.hasOwnProperty("variation"))&&this.setVariation(r.variation),e=void 0===t?(t=this.width/2,this.height/2):(r=t,s=e,n=(p=this).width/2,i=p.height/2,_.x=r-p.x,_.y=s-p.y,_.x/=p.scaleX,_.y/=p.scaleY,U(_,0,0,-p.rotation),_.x+=n,_.y+=i,t=(r=_).x,r.y),this.shatterCenter.x=t,this.shatterCenter.y=e,this.clear(),this.dirtyCache[9]=-1,0!==this.width&&0!==this.height){for(var s=T({width:this.width,height:this.height,center:this.shatterCenter,triangleOutput:!1,ringRadiusList:this.ringRadiusList,variation:this.variation,samplesPerRing:this.samplesPerRing}),o=s.vertices,a=s.indices,u=[],h=this.width,c=this.height,l=this.frame.cutWidth/c/2,f=this.frame.cutHeight/c/2,y=this.frame.u0,p=this.frame.u1,g=this.frame.v0,d=p-y,v=this.frame.v1-g,m=0,b=o.length;m<b;m++){var P=o[m],w=P[0],P=P[1];u.push({g:Y(t,e,w,P),x:w/c-l,y:P/c-f,u:y+w/h*d,v:g+P/c*v})}for(m=0,b=a.length;m<b;m+=3){var x=u[a[m+0]],O=u[a[m+1]],j=u[a[m+2]],R=new E(x.x,-x.y,0,x.u,x.v),k=new E(O.x,-O.y,0,O.u,O.v),I=new E(j.x,-j.y,0,j.u,j.v),G=new D(R,k,I);this.vertices.push(R,k,I),this.faces.push(G),G.g=Math.min(x.g,O.g,j.g)}this.faces.sort(function(t,e){return t.g-e.g})}return this}},{key:"startUpdate",value:function(){return this.ignoreDirtyCache=!0,this}},{key:"stopUpdate",value:function(){return this.ignoreDirtyCache=!1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color}}]),a}();function W(t,e,r,n,i){t=new v(this.scene,t,e,r,n,i);return this.scene.add.existing(t),t}var m=Phaser.Utils.Objects.GetAdvancedValue,X=Phaser.GameObjects.BuildGameObject;function H(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=m(t,"key",null),r=m(t,"frame",null),e=new v(this.scene,0,0,e,r,t);return X(this.scene,e,t),e}var q=Phaser.Textures.DynamicTexture,z=Phaser.Utils.Objects.IsPlainObject,b=Phaser.Utils.Objects.GetValue,P=function(){e(a,v);var o=h(a);function a(t,e,r,n,i,s){u(this,a),z(e)&&(e=b(s=e,"x",0),r=b(s,"y",0),n=b(s,"width",32),i=b(s,"height",32)),n=n,i=i;n=new q(t.sys.textures,null,n=void 0===n?2:n,i=void 0===i?2:i),i=o.call(this,t,e,r,n,null,s);return i.type="rexShatterRenderTexture",i.rt=i.texture,i}return t(a,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(c(i(a.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null)}}]),a}();function J(t,e,r,n,i){t=new P(this.scene,t,e,r,n,i);return this.scene.add.existing(t),t}var O=Phaser.Utils.Objects.GetAdvancedValue,K=Phaser.GameObjects.BuildGameObject;function Q(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=O(t,"x",0),r=O(t,"y",0),n=O(t,"width",32),i=O(t,"height",32),e=new P(this.scene,e,r,n,i,t);return K(this.scene,e,t),e}function j(t,e,r,n){if(void 0===n&&(n="."),"object"===a(t)){if(V(e)){if(null==r)return;"object"===a(r)&&(t=r)}else{n=(e="string"==typeof e?e.split(n):e).pop();(function(t,e,r){var n=t;if(!V(e))for(var i,s=0,o=(e="string"==typeof e?e.split("."):e).length;s<o;s++)null!=n[i=e[s]]&&"object"===a(n[i])||(n[i]=s!==o-1||void 0===r?{}:r),n=n[i];return n})(t,e)[n]=r}}}var V=function(t){return null==t||""===t||0===t.length},Z=function(){e(n,Phaser.Plugins.BasePlugin);var r=h(n);function n(t){var e;return u(this,n),e=r.call(this,t),t.registerGameObject("rexShatterImage",W,H),t.registerGameObject("rexShatterRenderTexture",J,Q),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return j(window,"RexPlugins.GameObjects.ShatterImage",v),j(window,"RexPlugins.GameObjects.ShatterRenderTexture",P),Z});

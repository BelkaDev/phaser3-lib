!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexdissolvepipelineplugin=t()}(void 0,function(){function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(o.key),o)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");t=e;if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(n);return u(this,o?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function g(e,t,n){(null==(e=e)||"object"!==f(e)?null:p(e)?e:p(e.game)?e.game:x(e)?e.sys.game:x(e.scene)?e.scene.sys.game:void 0).renderer.pipelines.addPostPipeline(t,n)}var l="#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n// Scene buffer\nuniform sampler2D uMainSampler;\nuniform sampler2D uMainSampler2;\n\nuniform int resizeMode;\nuniform float progress;\nuniform float fromRatio;\nuniform float toRatio;\nvarying vec2 outFragCoord;\n// Effect parameters\nuniform float noiseX;\nuniform float noiseY;\nuniform float noiseZ;\nuniform float fromEdgeStart;\nuniform float fromEdgeWidth;\nuniform float toEdgeStart;\nuniform float toEdgeWidth;\n\n".concat("vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }\nfloat Perlin(vec3 P) {\n    vec3 i0 = mod289(floor(P)), i1 = mod289(i0 + vec3(1.0));\n    vec3 f0 = fract(P), f1 = f0 - vec3(1.0), f = fade(f0);\n    vec4 ix = vec4(i0.x, i1.x, i0.x, i1.x), iy = vec4(i0.yy, i1.yy);\n    vec4 iz0 = i0.zzzz, iz1 = i1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy), ixy0 = permute(ixy + iz0), ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0), gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    vec4 gx1 = ixy1 * (1.0 / 7.0), gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0); gx1 = fract(gx1);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0), sz0 = step(gz0, vec4(0.0));\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1), sz1 = step(gz1, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g0 = vec3(gx0.x,gy0.x,gz0.x), g1 = vec3(gx0.y,gy0.y,gz0.y),\n        g2 = vec3(gx0.z,gy0.z,gz0.z), g3 = vec3(gx0.w,gy0.w,gz0.w),\n        g4 = vec3(gx1.x,gy1.x,gz1.x), g5 = vec3(gx1.y,gy1.y,gz1.y),\n        g6 = vec3(gx1.z,gy1.z,gz1.z), g7 = vec3(gx1.w,gy1.w,gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g0,g0), dot(g2,g2), dot(g1,g1), dot(g3,g3)));\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g4,g4), dot(g6,g6), dot(g5,g5), dot(g7,g7)));\n    g0 *= norm0.x; g2 *= norm0.y; g1 *= norm0.z; g3 *= norm0.w;\n    g4 *= norm1.x; g6 *= norm1.y; g5 *= norm1.z; g7 *= norm1.w;\n    vec4 nz = mix(vec4(dot(g0, vec3(f0.x, f0.y, f0.z)), dot(g1, vec3(f1.x, f0.y, f0.z)),\n        dot(g2, vec3(f0.x, f1.y, f0.z)), dot(g3, vec3(f1.x, f1.y, f0.z))),\n        vec4(dot(g4, vec3(f0.x, f0.y, f1.z)), dot(g5, vec3(f1.x, f0.y, f1.z)),\n            dot(g6, vec3(f0.x, f1.y, f1.z)), dot(g7, vec3(f1.x, f1.y, f1.z))), f.z);\n    return 2.2 * mix(mix(nz.x,nz.z,f.y), mix(nz.y,nz.w,f.y), f.x);\n}\nfloat Perlin(vec2 P) { return Perlin(vec3(P, 0.0)); }\n","\n\nvec4 getFromColor (vec2 uv) {\n  return texture2D(uMainSampler, uv);\n}\n\nvec4 getToColor (vec2 uv) {\n  if (resizeMode == 2) {\n    //  cover\n    return texture2D(uMainSampler2, 0.5 + (vec2(uv.x, 1.0 - uv.y) - 0.5) * vec2(min(fromRatio / toRatio, 1.0), min((toRatio / fromRatio), 1.0)));\n  } else if (resizeMode == 1) {\n    //  contain\n    return texture2D(uMainSampler2, 0.5 + (vec2(uv.x, 1.0 - uv.y) - 0.5) * vec2(max(fromRatio / toRatio, 1.0), max((toRatio / fromRatio), 1.0)));\n  } else {\n    //  stretch\n    return texture2D(uMainSampler2, vec2(uv.x, 1.0 - uv.y));\n  }\n}\n\nvec4 transition (vec2 uv) {    \n  vec4 colorFront = getFromColor(uv);\n  vec4 colorTo = getToColor(uv);\n\n  float noise = (Perlin(vec3(uv.x * noiseX, uv.y * noiseY, noiseZ)) + 1.0) / 2.0\n    * (1.0 - (fromEdgeStart + fromEdgeWidth + toEdgeStart + toEdgeWidth))\n    + (fromEdgeStart + fromEdgeWidth + toEdgeStart + toEdgeWidth) * 0.5;\n  vec4 colorResult = colorFront * smoothstep(progress - (fromEdgeStart + fromEdgeWidth), progress - fromEdgeStart, noise)\n    + colorTo * smoothstep((1.0 - progress) - (toEdgeStart + toEdgeWidth), (1.0 - progress) - toEdgeStart, (1.0 - noise));\n  return colorResult;\n}\n\nvoid main () {\n  vec2 uv = outFragCoord;\n  gl_FragColor = transition(uv);\n}\n"),e=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,d=Phaser.Utils.Objects.GetValue,v=Phaser.Math.Clamp,h=function(){s(n,e);var t=c(n);function n(e){return o(this,n),(e=t.call(this,{name:"rexDissolvePostFx",game:e,renderTarget:!0,fragShader:l}))._progress=0,e.toFrame=null,e.targetTexture=null,e.resizeMode=1,e.toRatio=1,e.noiseX=0,e.noiseY=0,e.noiseZ=0,e.fromEdgeStart=.01,e.fromEdgeWidth=.05,e.toEdgeStart=.01,e.toEdgeWidth=.05,e}return i(n,[{key:"resetFromJSON",value:function(e){return this.setProgress(d(e,"progress",0)),this.setTransitionTargetTexture(d(e,"toTexture","__DEFAULT"),d(e,"toFrame",void 0),d(e,"resizeMode",1)),this.setNoise(d(e,"noiseX",void 0),d(e,"noiseY",void 0),d(e,"noiseZ",void 0)),this.setFromEdge(d(e,"fromEdgeStart",.01),d(e,"fromEdgeWidth",.05)),this.setToEdge(d(e,"toEdgeStart",.01),d(e,"toEdgeWidth",.05)),this}},{key:"onBoot",value:function(){this.setTransitionTargetTexture()}},{key:"onPreRender",value:function(){this.set1f("progress",this.progress),this.set1i("resizeMode",this.resizeMode),this.set1f("noiseX",this.noiseX),this.set1f("noiseY",this.noiseY),this.set1f("noiseZ",this.noiseZ),this.set1f("fromEdgeStart",this.fromEdgeStart),this.set1f("fromEdgeWidth",this.fromEdgeWidth),this.set1f("toEdgeStart",this.toEdgeStart),this.set1f("toEdgeWidth",this.toEdgeWidth)}},{key:"onDraw",value:function(e){this.set1f("fromRatio",e.width/e.height),this.bindTexture(this.targetTexture,1),this.bindAndDraw(e)}},{key:"progress",get:function(){return this._progress},set:function(e){this._progress=v(e,0,1)}},{key:"setProgress",value:function(e){return this.progress=e,this}},{key:"setTransitionTargetTexture",value:function(e,t,n){e=(e=this.game.textures.getFrame(e=void 0===e?"__DEFAULT":e,t))||this.game.textures.getFrame("__DEFAULT");return this.toRatio=e.width/e.height,this.toFrame=e,this.targetTexture=e.glTexture,void 0!==n&&(this.resizeMode=n),this.set1i("uMainSampler2",1),this.set1f("toRatio",this.toRatio),this}},{key:"setResizeMode",value:function(e){return"string"==typeof e&&(e=m[e]),this.resizeMode=e,this}},{key:"setNoise",value:function(e,t,n){return void 0===e&&(e=4+6*Math.random()),void 0===t&&(t=4+6*Math.random()),void 0===n&&(n=10*Math.random()),this.noiseX=e,this.noiseY=t,this.noiseZ=n,this}},{key:"setFromEdge",value:function(e,t){return this.fromEdgeStart=e,this.fromEdgeWidth=t,this}},{key:"setToEdge",value:function(e,t){return this.toEdgeStart=e,this.toEdgeWidth=t,this}}]),n}(),m={stretch:0,contain:1,cover:2},t=Phaser.Game,p=function(e){return e instanceof t},y=Phaser.Scene,x=function(e){return e instanceof y},P=Phaser.Utils.Array.SpliceOne,z=function(){s(t,Phaser.Plugins.BasePlugin);var e=c(t);function t(){return o(this,t),e.apply(this,arguments)}return i(t,[{key:"setPostPipelineClass",value:function(e,t){return this.PostFxPipelineClass=e,this.postFxPipelineName=t,this}},{key:"start",value:function(){this.game.events.once("destroy",this.destroy,this),g(this.game,this.postFxPipelineName,this.PostFxPipelineClass)}},{key:"add",value:function(e,t){var n=this.PostFxPipelineClass;return void 0===t&&(t={}),e.setPostPipeline(n),(n=e.postPipelines[e.postPipelines.length-1]).resetFromJSON(t),t.name&&(n.name=t.name),n}},{key:"remove",value:function(e,t){var n=this.PostFxPipelineClass,o=t;if(void 0===o)for(var r=(i=e.postPipelines).length-1;0<=r;r--)(s=i[r])instanceof n&&(s.destroy(),P(i,r));else for(var i,s,r=0,f=(i=e.postPipelines).length;r<f;r++)(s=i[r])instanceof n&&s.name===o&&(s.destroy(),P(i,r));return this}},{key:"get",value:function(e,t){var n=this.PostFxPipelineClass,o=t;if(void 0===o){for(var r=[],i=0,s=(f=e.postPipelines).length;i<s;i++)(a=f[i])instanceof n&&r.push(a);return r}for(var f,a,i=0,s=(f=e.postPipelines).length;i<s;i++)if((a=f[i])instanceof n&&a.name===o)return a}}]),t}(),E=function(e){return null==e||""===e||0===e.length},b=function(){s(n,z);var t=c(n);function n(e){return o(this,n),(e=t.call(this,e)).setPostPipelineClass(h,"rexDissolvePostFx"),e}return i(n)}();return function(e,t,n,o){if(void 0===o&&(o="."),"object"===f(e)){if(E(t)){if(null==n)return;"object"===f(n)&&(e=n)}else{o=(t="string"==typeof t?t.split(o):t).pop();(function(e,t,n){var o=e;if(!E(t))for(var r,i=0,s=(t="string"==typeof t?t.split("."):t).length;i<s;i++)null!=o[r=t[i]]&&"object"===f(o[r])||(o[r]=i!==s-1||void 0===n?{}:n),o=o[r];return o})(e,t)[o]=n}}}(window,"RexPlugins.Pipelines.DissolvePostFx",h),b});

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexboardplugin=e()}(void 0,function(){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,U(n.key),n)}}function u(t,e,i){return e&&B(t.prototype,e),i&&B(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function N(t,e,i){(e=U(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){return(Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=c(i),e=(t=n?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}}function L(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=L(t,e);if(n)return(n=Object.getOwnPropertyDescriptor(n,e)).get?n.get.call(arguments.length<3?t:i):n.value}).apply(this,arguments)}function I(t,e,i,n){return(I="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var s,t=L(t,e);if(t){if((s=Object.getOwnPropertyDescriptor(t,e)).set)return s.set.call(n,i),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(n,e)){if(!s.writable)return!1;s.value=i,Object.defineProperty(n,e,s)}else N(n,e,i);return!0})(t,e,i,n)}function F(t,e,i,n,s){if(!I(t,e,i,n||t)&&s)throw new TypeError("failed to set property")}function j(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var i;if(t)return"string"==typeof t?z(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?z(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function U(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);if("object"!=typeof(i=i.call(t,e||"default")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}var s=function(){function i(t){y(this,i),this.scene=t,this.displayList=t.sys.displayList,this.updateList=t.sys.updateList,t.sys.events.once("destroy",this.destroy,this)}return u(i,[{key:"destroy",value:function(){this.scene=null,this.displayList=null,this.updateList=null}}],[{key:"register",value:function(t,e){i.prototype[t]=e}}]),i}();function G(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var W,v,t={exports:{}};function V(){}function J(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function H(t,e,i,n,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");i=new J(i,n||t,s),n=v?v+e:e;return t._events[n]?t._events[n].fn?t._events[n]=[t._events[n],i]:t._events[n].push(i):(t._events[n]=i,t._eventsCount++),t}function K(t,e){0==--t._eventsCount?t._events=new V:delete t._events[e]}function e(){this._events=new V,this._eventsCount=0}ct=t,W=Object.prototype.hasOwnProperty,v="~",Object.create&&(V.prototype=Object.create(null),(new V).__proto__||(v=!1)),e.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)W.call(t,e)&&i.push(v?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},e.prototype.listeners=function(t){var t=v?v+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var i=0,n=e.length,s=new Array(n);i<n;i++)s[i]=e[i].fn;return s},e.prototype.listenerCount=function(t){t=v?v+t:t,t=this._events[t];return t?t.fn?1:t.length:0},e.prototype.emit=function(t,e,i,n,s,r){var o=v?v+t:t;if(!this._events[o])return!1;var h,a=this._events[o],u=arguments.length;if(a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),u){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,i),!0;case 4:return a.fn.call(a.context,e,i,n),!0;case 5:return a.fn.call(a.context,e,i,n,s),!0;case 6:return a.fn.call(a.context,e,i,n,s,r),!0}for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];a.fn.apply(a.context,h)}else for(var l,c=a.length,d=0;d<c;d++)switch(a[d].once&&this.removeListener(t,a[d].fn,void 0,!0),u){case 1:a[d].fn.call(a[d].context);break;case 2:a[d].fn.call(a[d].context,e);break;case 3:a[d].fn.call(a[d].context,e,i);break;case 4:a[d].fn.call(a[d].context,e,i,n);break;default:if(!h)for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];a[d].fn.apply(a[d].context,h)}return!0},e.prototype.on=function(t,e,i){return H(this,t,e,i,!1)},e.prototype.once=function(t,e,i){return H(this,t,e,i,!0)},e.prototype.removeListener=function(t,e,i,n){t=v?v+t:t;if(this._events[t])if(e){var s=this._events[t];if(s.fn)s.fn!==e||n&&!s.once||i&&s.context!==i||K(this,t);else{for(var r=0,o=[],h=s.length;r<h;r++)(s[r].fn!==e||n&&!s[r].once||i&&s[r].context!==i)&&o.push(s[r]);o.length?this._events[t]=1===o.length?o[0]:o:K(this,t)}}else K(this,t);return this},e.prototype.removeAllListeners=function(t){return t?(t=v?v+t:t,this._events[t]&&K(this,t)):(this._events=new V,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=v,ct.exports=e.EventEmitter=e;function g(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return i;for(var n=e.split("."),s=t,r=i,o=0;o<n.length;o++){if(!s.hasOwnProperty(n[o])){r=i;break}r=s[n[o]],s=s[n[o]]}return r}return i}function q(t){return t instanceof dt}function $(t){return null==t||"object"!==a(t)?null:q(t)?t:t.scene&&q(t.scene)?t.scene:t.parent&&t.parent.scene&&q(t.parent.scene)?t.parent.scene:null}function Q(t){return t instanceof ft}function tt(t){return null==t||"object"!==a(t)?null:Q(t)?t:Q(t.game)?t.game:q(t)?t.sys.game:q(t.scene)?t.scene.sys.game:void 0}function et(t){return Tt(t)?lt.get(t):(t.hasOwnProperty("rexChess")||(t.rexChess=new bt(t)),t.rexChess)}function it(t){return t=Tt(t)?t:et(t)[mt]}function nt(t,e,i){return void 0===i&&(i=","),"".concat(t).concat(i).concat(e)}function st(t,e,i,n){return Math.atan2(n-e,i-t)}function rt(t){return 0<=(t%=2*Math.PI)?t:t+2*Math.PI}function ot(t){return t*Yt}function ht(t,e,i){var n;return t&&"number"!=typeof t&&(i=e,t=(n=this.chessToTileXYZ(t)).x,e=n.y),this.grid.getGridPoints(t,e,i)}var at=G(t.exports),ut=function(){l(e,at);var t=d(e);function e(){return y(this,e),t.apply(this,arguments)}return u(e,[{key:"shutdown",value:function(){this.removeAllListeners()}},{key:"destroy",value:function(){this.removeAllListeners()}}]),e}(),lt=new(function(){function e(t){y(this,e),this.nextId=g(t,"start",1),this.uidKey=g(t,"uidKey","$uid"),this.autoRemove=g(t,"remove",!0),this.refs={},this.count=0}return u(e,[{key:"add",value:function(t,e){var i=this.refs,n=this.uidKey;if(n&&null!=(e=t[n]))return this;if(null==e)for(;e=this.nextId,this.nextId++,i.hasOwnProperty(e););return i.hasOwnProperty(e)?e=null:(i[e]=t,this.count++,n&&(t[n]=e),this.autoRemove&&t.on&&t.once("destroy",function(){this.remove(e)},this)),n?this:e}},{key:"addMultiple",value:function(t){for(var e=0,i=t.length;e<i;e++)this.add(t[e]);return this}},{key:"get",value:function(t){return this.refs[t]}},{key:"has",value:function(t){return this.refs.hasOwnProperty(t)}},{key:"remove",value:function(t){var e=this.refs;return e.hasOwnProperty(t)&&(this.uidKey&&(e[t][this.uidKey]=void 0),delete e[t],this.count--),this}},{key:"forEach",value:function(t,e){var i,n,s=this.refs;for(n in s)i=s[n],e?t.call(e,i,n):t(i,n)}},{key:"clear",value:function(){this.forEach(function(t){this.remove(t)},this)}}]),e}())({uidKey:"$uid",remove:!1}),ct={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},dt=Phaser.Scene,ft=Phaser.Game,vt=Phaser.Utils.Objects.GetValue,yt=function(){function i(t,e){y(this,i),this.setParent(t),this.isShutdown=!1,this.setEventEmitter(vt(e,"eventEmitter",!0)),this.parent&&(this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.once("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this))}return u(i,[{key:"shutdown",value:function(t){this.isShutdown||(this.parent&&(this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.off("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this)),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.game=void 0,this.isShutdown=!0)}},{key:"destroy",value:function(t){this.shutdown(t)}},{key:"onEnvDestroy",value:function(){this.destroy(!0)}},{key:"onParentDestroy",value:function(t,e){this.destroy(e)}},{key:"setParent",value:function(t){return this.parent=t,this.scene=$(t),this.game=tt(t),this}}]),i}(),pt=(Object.assign(yt.prototype,ct),{x:0,y:0}),b=function(t){if("object"!==a(t)||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},gt=lt.uidKey,bt=function(){l(n,yt);var i=d(n);function n(t,e){return y(this,n),t=i.call(this,t,{eventEmitter:!1}),lt.add(p(t),e),t.board=null,t.blocker=!1,t}return u(n,[{key:"shutdown",value:function(t){this.isShutdown||(this.board&&this.board.removeChess(this[gt]),lt.remove(this[gt]),this.board=null,f(c(n.prototype),"shutdown",this).call(this,t))}},{key:"setBoard",value:function(t){return this.board=t,this}},{key:"tileXYZ",get:function(){return null==this.board?null:this.board.chessToTileXYZ(this[gt])}},{key:"setTileZ",value:function(t){return null!=this.board&&this.board.setChessTileZ(this.parent,t),this}},{key:"setBlocker",value:function(t){return this.blocker=t=void 0===t?!0:t,this}},{key:"setBlockEdge",value:function(t,e){!1===this.blocker&&(this.blocker={});var i=this.blocker;if(b(t)){var n=t;for(t in n)i[t]=n[t]}else i[t]=e=void 0===e?!0:e;return this}},{key:"getBlockEdge",value:function(t){var e=this.blocker;return!1!==e&&!!e.hasOwnProperty(t)&&e[t]}}]),n}(),Tt=(Object.assign(bt.prototype,{getTileDirection:function(t,e){var i=this.board;return null===i?null:(pt.x=t,pt.y=e,i.getNeighborTileDirection(this.tileXYZ,pt))}}),function(t){t=a(t);return"number"===t||"string"===t}),mt=lt.uidKey,xt={},kt={},wt=2*Math.PI,Ct={x:0,y:0},Yt=180/Math.PI;function Xt(t,e,i,n){for(var s in e)if(e.hasOwnProperty(s)){r=e,o=s,r=(h=i)?r[o]:Object.getOwnPropertyDescriptor(r,o);h=!!((r=!h&&r.value&&"object"===a(r.value)?r.value:r)&&((o=r).get&&"function"==typeof o.get||o.set&&"function"==typeof o.set))&&(void 0===r.enumerable&&(r.enumerable=!0),void 0===r.configurable&&(r.configurable=!0),r);if(!1!==h){if(o=(n||t).prototype,r=s,(o=Object.getOwnPropertyDescriptor(o,r))&&!1===(o=o.value&&"object"===a(o.value)?o.value:o).configurable){if(T.ignoreFinals)continue;throw new Error("cannot override final property '"+s+"', set Class.ignoreFinals = true to skip")}Object.defineProperty(t.prototype,s,h)}else t.prototype[s]=e[s]}var r,o,h}function Mt(t,e){if(e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)Xt(t,e[i].prototype||e[i])}}function T(t){var e,i,n;if((t=t||{}).initialize){if("function"!=typeof t.initialize)throw new Error("initialize must be a function");n=t.initialize,delete t.initialize}else n=t.Extends?(i=t.Extends,function(){i.apply(this,arguments)}):function(){};t.Extends?(n.prototype=Object.create(t.Extends.prototype),n.prototype.constructor=n,e=t.Extends,delete t.Extends):n.prototype.constructor=n;var s=null;return t.Mixins&&(s=t.Mixins,delete t.Mixins),Mt(n,s),Xt(n,t,!0,e),n}T.extend=Xt,T.mixin=Mt,T.ignoreFinals=!1;function Pt(t){return 2*(t.width+t.height)}function St(t,e,i){var n;return void 0===i&&(i=new Le),e<=0||1<=e?(i.x=t.x,i.y=t.y):(n=Pt(t)*e,.5<e?(n-=t.width+t.height)<=t.width?(i.x=t.right-n,i.y=t.bottom):(i.x=t.x,i.y=t.bottom-(n-t.width)):n<=t.width?(i.x=t.x+n,i.y=t.y):(i.x=t.right,i.y=t.y+(n-t.width))),i}function Dt(t,e,i,n){void 0===n&&(n=[]),e=e||Math.sqrt((t.x2-t.x1)*(t.x2-t.x1)+(t.y2-t.y1)*(t.y2-t.y1))/i;for(var s=t.x1,r=t.y1,o=t.x2,h=t.y2,a=0;a<e;a++){var u=a/e;n.push(new Le(s+(o-s)*u,r+(h-r)*u))}return n}function Ot(t,e,i){return(e-t)*i+t}function At(t,e,i,n,s){var r=t.tileXYToWorldXY(i,n,!0);if(e.contains(r.x,r.y))return 1;switch(s){case 1:var o=t.getGridBounds(i,n,!0);return ze(e,o);case 2:o=t.getGridPoints(i,n,!0);return Ue(e,o);default:return}}function Et(t,e,i,n,s){var r,o;return this.contains(e,i)&&(void 0===s&&(s=!0),r=this.chessToTileXYZ(t),void 0===n&&(n=r?r.z:0),r&&r.x===e&&r.y===i&&r.z===n||((o=this.tileXYZToChess(e,i,n))&&this.emit("kickout",t,o,r),this.removeChess(t),o&&this.removeChess(o,e,i,n),this.boardData.addUID(this.getChessUID(t),e,i,n),this.isBoard&&this.getChessData(t).setBoard(this),s&&this.gridAlign(t,e,i))),this}function _t(t,e,i){return Math.max(e,Math.min(i,t))}function Rt(t,e,i){return e+((t-e)%(i-=e)+i)%i}function Bt(t,e,i){return void 0===i&&(i=t.length),e=(e=void 0===e?0:e)+Math.floor(Math.random()*i),void 0===t[e]?null:t[e]}function Nt(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}}function m(t){return"[object Array]"===Object.prototype.toString.call(t)}function Zt(t,e){return!1===t||!0===t?t:!0===t[e]}function Lt(t){if(t)return t.rexChess?t.rexChess.board:t.mainBoard||void 0}function It(t){for(var e in t)return;return 1}function Ft(){return this._savedOriginX=this.x,this._savedOriginY=this.y,this}function jt(){return this.x=this._savedOriginX,this.y=this._savedOriginY,this}function zt(t,e,i,n,s){var r,o;switch(void 0===s?s={}:!0===s&&(s=pi),this.mode){case 0:r=vi[i][0],o=vi[i][1];break;case 1:r=yi[i][0],o=yi[i][1]}return s.x=t+n*r,s.y=e+n*o,s}function Ut(t,e,i,n){return void 0===n?n={}:!0===n&&(n=mi),e=t.x+e,t=t.y+i,n.x=e,n.y=t,n}function Gt(t){return Rt(t,0,this.directions)}function x(t,e,i,n){switch(void 0===n?n={}:!0===n&&(n=zi),t){case Li:n.x=e-(i-(1&i))/2,n.z=i;break;case Ii:n.x=e-(i+(1&i))/2,n.z=i;break;case Fi:n.x=e,n.z=i-(e-(1&e))/2;break;case ji:n.x=e,n.z=i-(e+(1&e))/2}return n.y=-n.x-n.z,n}function k(t,e,i,n,s){switch(void 0===s?s={}:!0===s&&(s=Ui),t){case Li:s.x=e+(n-(1&n))/2,s.y=n;break;case Ii:s.x=e+(n+(1&n))/2,s.y=n;break;case Fi:s.x=e,s.y=n+(e-(1&e))/2;break;case ji:s.x=e,s.y=n+(e+(1&e))/2}return s}function Wt(t,e,i){var n;switch(t){case rn:case on:n=1&i;break;case hn:case an:n=1&e}return n}function Vt(t,e,i,n,s){if(void 0===s?s={}:!0===s&&(s=un),1===n){var r=Wt(this.mode,t,e);s.x=t+O[this.mode][r][i][0],s.y=e+O[this.mode][r][i][1]}else if(0===n)s.x=t,s.y=e;else{var o,h,a=x(this.mode,t,e,!0);switch(i){case 1:o=a.x,a.y,h=a.z+n;break;case 2:o=a.x-n,a.y,h=a.z+n;break;case 3:o=a.x-n,a.y,h=a.z;break;case 4:o=a.x,a.y,h=a.z-n;break;case 5:o=a.x+n,a.y,h=a.z-n;break;default:o=a.x+n,a.y,h=a.z}k(this.mode,o,0,h,s)}return s}function i(t){var e,i,n,s={};for(n in t)e=(i=t[n])[0],i=i[1],s.hasOwnProperty(e)||(s[e]={}),s[e][i]=parseInt(n);return s}function Jt(e){var i,t,n;this.enable&&e.isDown&&(i=this.board,null===this.pointer&&(this.pointer=e),t=(n=i.worldXYToTileXY(e.worldX,e.worldY,!0)).x,n=n.y,this.prevTilePosition.x=this.tilePosition.x,this.prevTilePosition.y=this.tilePosition.y,this.tilePosition.x=t,this.tilePosition.y=n,i.contains(t,n))&&(i.emit("tiledown",e,this.tilePosition),i.emit("tileover",e,this.tilePosition),A(function(t){i.emit("gameobjectdown",e,t),i.emit("gameobjectover",e,t)},function(t){t.emit("board.pointerdown",e),t.emit("board.pointerover",e)},i,t,n,e))}function Ht(e){var i,t,n;this.enable&&(t=(n=(i=this.board).worldXYToTileXY(e.worldX,e.worldY,!0)).x,n=n.y,this.prevTilePosition.x=this.tilePosition.x,this.prevTilePosition.y=this.tilePosition.y,this.tilePosition.x=t,this.tilePosition.y=n,i.contains(t,n))&&(i.emit("tileup",e,this.tilePosition),i.emit("tileout",e,this.prevTilePosition),A(function(t){i.emit("gameobjectup",e,t),i.emit("gameobjectout",e,t)},function(t){t.emit("board.pointerup",e),t.emit("board.pointerout",e)},i,t,n,e),this.pointer===e)&&(this.pointer=null)}function Kt(e){var i,t,n;this.enable&&(n=(i=this.board).worldXYToTileXY(e.worldX,e.worldY,!0),je(this.tilePosition,n)||(this.prevTilePosition.x=this.tilePosition.x,this.prevTilePosition.y=this.tilePosition.y,null!=this.prevTilePosition.x&&null!=this.prevTilePosition.y&&i.emit("tileout",e,this.prevTilePosition),t=n.x,n=n.y,this.tilePosition.x=t,this.tilePosition.y=n,i.contains(t,n)?(null===this.pointer&&(this.pointer=e),i.emit("tilemove",e,this.tilePosition),i.emit("tileover",e,this.tilePosition),A("gameobjectout","board.pointerout",i,this.prevTilePosition.x,this.prevTilePosition.y,e),A(function(t){i.emit("gameobjectmove",e,t),i.emit("gameobjectover",e,t)},function(t){t.emit("board.pointermove",e),t.emit("board.pointerover",e)},i,t,n,e)):(A("gameobjectout","board.pointerout",i,this.prevTilePosition.x,this.prevTilePosition.y,e),this.pointer===e&&(this.pointer=null))))}function qt(t,e,i,n,s){void 0===s&&(s=!1);var r=t._events[e];if(r)for(var o=0,h=r.length;o<h;o++){var a=r[o];if(a.fn===i&&a.context===n&&a.once===s)return 1}}function n(t,e,i,n){if(void 0===n&&(n="."),"object"===a(t)){if(Cs(e)){if(null==i)return;"object"===a(i)&&(t=i)}else{n=(e="string"==typeof e?e.split(n):e).pop();(function(t,e,i){var n=t;if(!Cs(e))for(var s,r=0,o=(e="string"==typeof e?e.split("."):e).length;r<o;r++)null!=n[s=e[r]]&&"object"===a(n[s])||(n[s]=r!==o-1||void 0===i?{}:i),n=n[s];return n})(t,e)[n]=i}}}function $t(t){return"rexMiniBoard"===t.type}function Qt(t,e,i,n){for(var s=t.chessData.board,r=n.toString();s.contains(e,i,r+="."););return r}function te(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:hi(e),i){e.length=t.length;for(var n=0,s=t.length;n<s;n++)e[n]=t[n]}else for(var r in t)e[r]=t[r];return e}function ee(t,e,i,n,s,r){t&&void 0!==e&&t.lineStyle(1,e,1).lineBetween(i,n,s,r)}function ie(t,e,i){return{x:t,y:e,direction:i}}function r(t,e){var i;if(void 0===e)t.hasOwnProperty("rexContainer")&&(i=t.rexContainer.parent);else for(i=r(t);i&&i.name!==e;)i=r(i);return i}function o(e){var t;return e.hasOwnProperty("rexContainer")||(t={parent:null,self:null,layer:null,x:0,y:0,syncPosition:!0,rotation:0,syncRotation:!0,scaleX:0,scaleY:0,syncScale:!0,alpha:0,syncAlpha:!0,visible:!0,active:!0},Object.defineProperty(t,"angle",{get:function(){return Fr(this.rotation)},set:function(t){this.rotation=Ir(t)}}),Object.defineProperty(t,"displayWidth",{get:function(){return e.width*this.scaleX},set:function(t){this.scaleX=t/e.width}}),Object.defineProperty(t,"displayHeight",{get:function(){return e.height*this.scaleY},set:function(t){this.scaleY=t/e.height}}),e.rexContainer=t),e.rexContainer}function ne(t,e){this.setParent(t);var i=o(t);return re(i,e),this.resetChildState(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),zr.call(this,t),this.addToParentContainer(t),this.addToRenderLayer(t),this}function se(t,e){this.setParent(t);var i=o(t);return re(i,e),i.x=t.x,i.y=t.y,i.rotation=t.rotation,i.scaleX=t.scaleX,i.scaleY=t.scaleY,i.alpha=t.alpha,i.visible=t.visible,i.active=t.active,this.updateChildPosition(t).updateChildAlpha(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),zr.call(this,t),this.addToRenderLayer(t),this}function re(t,e){"boolean"==typeof(e=void 0===e?!0:e)?(t.syncPosition=e,t.syncRotation=e,t.syncScale=e,t.syncAlpha=e,t.syncScrollFactor=e):(t.syncPosition=jr(e,"syncPosition",!0),t.syncRotation=jr(e,"syncRotation",!0),t.syncScale=jr(e,"syncScale",!0),t.syncAlpha=jr(e,"syncAlpha",!0),t.syncScrollFactor=jr(e,"syncScrollFactor",!0))}function oe(t,e){return t===e?1:t/e}function he(t,e){var i;return t.length<=1||(void 0===e&&(e=!1),(i=t[0].scene.sys.displayList).depthSort(),e?t.sort(function(t,e){return i.getIndex(e)-i.getIndex(t)}):t.sort(function(t,e){return i.getIndex(t)-i.getIndex(e)})),t}function ae(t,e){if(!e(t)&&t.isRexContainerLite)for(var i=t.children,n=0,s=i.length;n<s;n++)ae(i[n],e)}function ue(t,e){for(var i=[t];0<i.length;){var n=i.shift();!e(n)&&n.isRexContainerLite&&i.push.apply(i,j(n.children))}}function le(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];s.hasOwnProperty("rexContainer")&&e.push(s.rexContainer)}return e}function ce(t,e,i){if(i.parent){var n=i.parent,s=i.self;switch(e){case"x":case"y":n.updateChildPosition(s);break;case"angle":case"rotation":n.updateChildRotation(s);break;case"scaleX":case"scaleY":case"displayWidth":case"displayHeight":n.updateChildScale(s);break;case"alpha":n.updateChildAlpha(s);break;default:n.updateChildPosition(s),n.updateChildRotation(s),n.updateChildScale(s),n.updateChildAlpha(s)}}else t.remove()}function de(t,e,i){return void 0===e?e=new $r:!0===e&&(e=R=void 0===R?new $r:R),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-Hr(t)*t.originX,e.y=t.y-Kr(t)*t.originY,io(t,e,i))}function fe(t,e,i){return void 0===e?e=new $r:!0===e&&(e=R=void 0===R?new $r:R),t.getTopRight?t.getTopRight(e):(e.x=t.x-Hr(t)*t.originX+Hr(t),e.y=t.y-Kr(t)*t.originY,io(t,e,i))}function ve(t,e,i){return void 0===e?e=new $r:!0===e&&(e=R=void 0===R?new $r:R),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-Hr(t)*t.originX,e.y=t.y-Kr(t)*t.originY+Kr(t),io(t,e,i))}function ye(t,e,i){return void 0===e?e=new $r:!0===e&&(e=R=void 0===R?new $r:R),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-Hr(t)*t.originX+Hr(t),e.y=t.y-Kr(t)*t.originY+Kr(t),io(t,e,i))}function pe(t){return t instanceof ro}function ge(t){var e,i,n,s,r,o,h,a,u,l,c;if(t)return e=t.gameObjects,a=t.renderTexture,l=oo(t,"x",void 0),c=oo(t,"y",void 0),i=oo(t,"width",void 0),n=oo(t,"height",void 0),s=oo(t,"originX",0),r=oo(t,"originY",0),u=oo(t,"padding",0),h=void 0===i||void 0===n||void 0===l||void 0===c?(h=function(t,e){void 0===e?e=new no:!0===e&&(e=Ze=void 0===Ze?new no:Ze),e.setTo(0,0,0,0);for(var i,n=!0,s=0,r=t.length;s<r;s++)(i=t[s]).getBounds&&(i=to(i,!0),n?(e.setTo(i.x,i.y,i.width,i.height),n=!1):so(i,e,e));return e}(e,!0),r=s=void 0!==l&&void 0!==c?(i=2*Math.max(l-h.left,h.right-l),n=2*Math.max(c-h.top,h.bottom-c),.5):(l=h.x,c=h.y,i=h.width,n=h.height,0),o=h.x,h.y):(o=l+(0-s)*i,c+(0-r)*n),o-=u,h-=u,i+=2*u,n+=2*u,u=e[0].scene,(a=a||u.add.renderTexture(0,0,i,n)).setPosition&&a.setPosition(l,c),a.width===i&&a.height===n||a.setSize(i,n),a.setOrigin&&a.setOrigin(s,r),a.camera.setScroll(o,h),e=he(te(e)),a.draw(e),(u=t.saveTexture)&&(pe(a)?a.saveTexture(u):(c=(l=a).manager).exists(l.key)?c.renameTexture(l.key,key):(l.key=key,c.list[key]=l,c.emit("addtexture",key,l),c.emit("addtexture-".concat(key),l))),a}function be(t){this.input.enable&&t.isDown&&(null===this.input.pointer&&(this.input.pointer=t),yo.call(this,t))&&po.call(this,t)}function Te(t){this.input.enable&&(To.call(this,t),bo.call(this,t),this.input.pointer===t)&&(this.input.pointer=null)}function me(t){this.input.enable&&(xo.call(this,t),ko.call(this,t))}function xe(t,e,i){var n,s,r;for(r in void 0===t?t=1:"string"==typeof t&&(t=Co[t]),void 0===i&&(i={}),e=void 0===e?this.tileXYZMap:e)n=e[r],(s=this.board.mirror(n,t)).z=n.z,i[r]=s;return i}function ke(t){var e,i;for(i in this.removeAllChess(),t)e=t[i],i=parseInt(i),this.addChess(i,e.x,e.y,e.z,!1);return this}function we(t,e,i){var n,s,r;for(r in void 0===t&&(t=0),void 0===i&&(i={}),e=void 0===e?this.tileXYZMap:e)n=e[r],(s=this.board.rotate(n,t)).z=n.z,i[r]=s;return i}function Ce(t,e,i){if(null==t)return t;switch(a(t)){case"string":return t;case"number":return"#".concat(So(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,i);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function Ye(t,e){void 0===e&&(e={});for(var i=1/0,n=1/0,s=-1/0,r=-1/0,o=0,h=t.length;o<h;o++)var a=(u=t[o]).x,u=u.y,i=Math.min(i,a),n=Math.min(n,u),s=Math.max(s,a),r=Math.max(r,u);return e.left=i,e.top=n,e.right=s,e.bottom=r,e}function Xe(t,e,i){if(0!==i)for(var n=(e.right-e.left)/2,s=(e.bottom-e.top)/2,r=i/2,o=0,h=t.length;o<h;o++){var a=t[o];a.x=Oo(a.x,n,r),a.y=Oo(a.y,s,r)}}function Me(t,e,i){if(void 0===i&&(i=e),0!==e||0!==i)for(var n=0,s=t.length;n<s;n++){var r=t[n];r.x+=e,r.y+=i}}function Pe(t,e,i,n,s,r,o){"string"==typeof r&&(o=r,r=void 0),void 0===r&&(r=!0),void 0===o&&(o="miter"),Do(t.scene,e,t.getGridPoints(0,0,!0),i,n,s,r,o)}function Se(t){var e={cellWidth:t.tileWidth,cellHeight:t.tileHeight};switch(t.orientation){case 0:e.gridType="quadGrid",e.type="orthogonal";break;case 1:e.gridType="quadGrid",e.type="isometric";break;case 3:e.gridType="hexagonGrid",e.staggeraxis="y",e.staggerindex="odd";break;default:e.gridType="quadGrid",e.type="orthogonal"}return(t=t.layers[0])&&(e.x=t.x,e.y=t.y),e}function De(t,e){for(var i=e.name,n=e.data,s=0,r=n.length;s<r;s++)for(var o=n[s],h=0,a=o.length;h<a;h++){var u=o[h];t.addChess(u,h,s,i,!1)}}function Oe(t,e){var i=Ao(t);return Eo(i,t,e),i}var Ae,Ee,_e,Re,Be,w,Ne,Ze,C,Le=new T({initialize:function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e},setTo:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}}),h=new T({initialize:function(t,e){this.x=0,this.y=0,"object"===a(t)?(this.x=t.x||0,this.y=t.y||0):(void 0===e&&(e=t),this.x=t||0,this.y=e||0)},clone:function(){return new h(this.x,this.y)},copy:function(t){return this.x=t.x||0,this.y=t.y||0,this},setFromObject:function(t){return this.x=t.x||0,this.y=t.y||0,this},set:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this},setTo:function(t,e){return this.set(t,e)},setToPolar:function(t,e){return null==e&&(e=1),this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},equals:function(t){return this.x===t.x&&this.y===t.y},angle:function(){var t;return(t=Math.atan2(this.y,this.x))<0&&(t+=2*Math.PI),t},add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},scale:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},distance:function(t){var e=t.x-this.x,t=t.y-this.y;return Math.sqrt(e*e+t*t)},distanceSq:function(t){var e=t.x-this.x,t=t.y-this.y;return e*e+t*t},length:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},lengthSq:function(){var t=this.x,e=this.y;return t*t+e*e},normalize:function(){var t=this.x,e=this.y,i=t*t+e*e;return 0<i&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i),this},normalizeRightHand:function(){var t=this.x;return this.x=-1*this.y,this.y=t,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lerp:function(t,e){var i=this.x,n=this.y;return this.x=i+(e=void 0===e?0:e)*(t.x-i),this.y=n+e*(t.y-n),this},transformMat3:function(t){var e=this.x,i=this.y,t=t.val;return this.x=t[0]*e+t[3]*i+t[6],this.y=t[1]*e+t[4]*i+t[7],this},transformMat4:function(t){var e=this.x,i=this.y,t=t.val;return this.x=t[0]*e+t[4]*i+t[12],this.y=t[1]*e+t[5]*i+t[13],this},reset:function(){return this.x=0,this.y=0,this}}),Ie=(h.ZERO=new h,h.RIGHT=new h(1,0),h.LEFT=new h(-1,0),h.UP=new h(0,-1),h.DOWN=new h(0,1),h.ONE=new h(1,1),new T({initialize:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x1=t=void 0===t?0:t,this.y1=e,this.x2=i,this.y2=n},getPoint:function(t,e){return i=this,t=t,(e=void 0===(e=e)?new Le:e).x=i.x1+(i.x2-i.x1)*t,e.y=i.y1+(i.y2-i.y1)*t,e;var i},getPoints:function(t,e,i){return Dt(this,t,e,i)},getRandomPoint:function(t){return e=this,void 0===(t=t)&&(t=new Le),i=Math.random(),t.x=e.x1+i*(e.x2-e.x1),t.y=e.y1+i*(e.y2-e.y1),t;var e,i},setTo:function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x1=t=void 0===t?0:t,this.y1=e,this.x2=i,this.y2=n,this},getPointA:function(t){return(t=void 0===t?new h:t).set(this.x1,this.y1),t},getPointB:function(t){return(t=void 0===t?new h:t).set(this.x2,this.y2),t},left:{get:function(){return Math.min(this.x1,this.x2)},set:function(t){this.x1<=this.x2?this.x1=t:this.x2=t}},right:{get:function(){return Math.max(this.x1,this.x2)},set:function(t){this.x1>this.x2?this.x1=t:this.x2=t}},top:{get:function(){return Math.min(this.y1,this.y2)},set:function(t){this.y1<=this.y2?this.y1=t:this.y2=t}},bottom:{get:function(){return Math.max(this.y1,this.y2)},set:function(t){this.y1>this.y2?this.y1=t:this.y2=t}}})),Y=new T({initialize:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t=void 0===t?0:t,this.y=e,this.width=i,this.height=n},contains:function(t,e){return t=t,e=e,!((i=this).width<=0||i.height<=0)&&i.x<=t&&i.x+i.width>=t&&i.y<=e&&i.y+i.height>=e;var i},getPoint:function(t,e){return St(this,t,e)},getPoints:function(t,e,i){var n=this,s=t,t=e,r=i;void 0===r&&(r=[]),s=s||Pt(n)/t;for(var o=0;o<s;o++)r.push(St(n,o/s));return r},getRandomPoint:function(t){return e=this,(t=void 0===(t=t)?new Le:t).x=e.x+Math.random()*e.width,t.y=e.y+Math.random()*e.height,t;var e},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},setEmpty:function(){return this.setTo(0,0,0,0)},setPosition:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this},setSize:function(t,e){return void 0===e&&(e=t),this.width=t,this.height=e,this},isEmpty:function(){return this.width<=0||this.height<=0},getLineA:function(t){return(t=void 0===t?new Ie:t).setTo(this.x,this.y,this.right,this.y),t},getLineB:function(t){return(t=void 0===t?new Ie:t).setTo(this.right,this.y,this.right,this.bottom),t},getLineC:function(t){return(t=void 0===t?new Ie:t).setTo(this.right,this.bottom,this.x,this.bottom),t},getLineD:function(t){return(t=void 0===t?new Ie:t).setTo(this.x,this.bottom,this.x,this.y),t},left:{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}},right:{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}},top:{get:function(){return this.y},set:function(t){t>=this.bottom?this.height=0:this.height=this.bottom-t,this.y=t}},bottom:{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}},centerX:{get:function(){return this.x+this.width/2},set:function(t){this.x=t-this.width/2}},centerY:{get:function(){return this.y+this.height/2},set:function(t){this.y=t-this.height/2}}}),Fe=new Y,je=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},ze=function(t,e){var i=e.top,n=e.bottom,s=e.left,e=e.right;return!!(t.contains(s,i)||t.contains(s,n)||t.contains(e,i)||t.contains(e,n))},Ue=function(t,e){for(var i=0,n=e.length;i<n;i++){var s=e[i];if(t.contains(s.x,s.y))return!0}return!1},X={x:0,y:0},Ge={},We={},Ve={},Je={},He=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},Ke=[],qe={},$e=[],Qe=[],ti={},ei=[],ii=[],ni=[],si=[],ri=[],oi=[],hi=(N(t={getChessData:et,getChessUID:it,setBoardWidth:function(t){if(!this.infinityMode){if(!(void 0===this.width||this.width<=t))for(var e,i,n=t;n<this.width;n++)for(e=0;e<this.height;e++)for(i in this.boardData.getUID(n,e))this.RemoveChess(!1,n,e,i);this.width=t}return this},setBoardHeight:function(t){if(!this.infinityMode){if(!(void 0===this.height||this.height<=t))for(var e,i,n=t;n<this.height;n++)for(e=0;e<this.width;e++)for(i in this.boardData.getUID(e,n))this.RemoveChess(!1,e,n,i);this.height=t}return this},tileXYZToKey:function(t,e,i,n){return void 0===n&&(n=","),"".concat(t).concat(n).concat(e).concat(n).concat(i)},tileXYToKey:nt,keyToTileXYZ:function(t,e,i){void 0===e?e={}:!0===e&&(e=xt);t=t.split(i=void 0===i?",":i);return e.x=t[0],e.y=t[1],e.z=t[2],e},tileXYToWorldX:function(t,e){return this.tileXYToWorldXY(t,e,!0).x},tileXYToWorldY:function(t,e){return this.tileXYToWorldXY(t,e,!0).y},tileXYToWorldXY:function(t,e,i){return this.grid.getWorldXY(t,e,i)},tileXYArrayToWorldXYArray:function(t,e){var i;void 0===e&&(e=[]);for(var n=0,s=t.length;n<s;n++)i=t[n],e.push(this.tileXYToWorldXY(i.x,i.y));return e},worldXYToTileX:function(t,e){return this.worldXYToTileXY(t,e,!0).x},worldXYToTileY:function(t,e){return this.worldXYToTileXY(t,e,!0).y},worldXYToTileXY:function(t,e,i){return this.grid.getTileXY(t,e,i)},worldXYToChessArray:function(t,e,i){t=this.worldXYToTileXY(t,e,!0);return this.tileXYToChessArray(t.x,t.y,i)},worldXYToChess:function(t,e,i){t=this.worldXYToTileXY(t,e,!0);if(void 0!==i)return this.tileXYZToChess(t.x,t.y,i);var n=this.boardData.getUID(t.x,t.y);if(null==n)return null;for(i in n)return this.uidToChess(n[i])},worldXYSnapToGrid:function(t,e,i){return void 0===i?i={}:!0===i&&(i=kt),this.worldXYToTileXY(t,e,i),this.tileXYToWorldXY(i.x,i.y,i),i},angleBetween:function(t,e){t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e);var t=this.tileXYToWorldXY(t.x,t.y,!0),i=t.x,n=t.y,e=(t=this.tileXYToWorldXY(e.x,e.y,!0)).x,t=t.y;return st(i,n,e,t)},isAngleInCone:function(t,e,i,n){var s,t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e),t=this.angleBetween(t,e),t=rt(t),e=Math.abs(t-i),e=Math.min(e,wt-e),t=n/2;return void 0===s&&(s=1e-4),Math.abs(e-t)<s||e<t},angleToward:function(t,e){void 0===t&&(t=Ct);var i=this.wrapMode,n=this.infinityMode,e=(this.wrapMode=!1,this.infinityMode=!0,this.getNeighborTileXY(t,e,!0));return this.wrapMode=i,this.infinityMode=n,this.angleBetween(t,e)},angleSnapToDirection:function(t,e){e=ot(e);for(var i,n=this.grid.allDirections,s=1/0,r=void 0,o=0,h=n.length;o<h;o++)i=ot(this.angleToward(t,n[o])),(i=Math.abs(function(t,e){e-=t;return 0==e?0:e-360*Math.floor((e+180)/360)}(e,i)))<s&&(s=i,r=o);return r},isOverlappingPoint:function(t,e,i){return!(!this.infinityMode||void 0!==i)||(t=this.worldXYToTileXY(t,e,!0),this.contains(t.x,t.y,i))},gridAlign:function(t,e,i){var n;if(void 0===t)for(var s=this.getAllChess(),r=0,o=s.length;r<o;r++)this.gridAlign(s[r]);else Tt(t)&&(t=this.uidToChess(t)),void 0===e&&(e=(n=this.chessToTileXYZ(t)).x,i=n.y),this.tileXYToWorldXY(e,i,t);return this},getGridPoints:ht,getGridBounds:function(t,e,i){var n;return t&&"number"!=typeof t&&(i=e,t=(n=this.chessToTileXYZ(t)).x,e=n.y),this.grid.getBounds(t,e,i)},getBoardBounds:function(o){void 0===o?o=new Y:!0===o&&(o=Fe);var h=!0;return this.forEachTileXY(function(t,e){var i,n,s,r,e=e.getGridBounds(t.x,t.y,!0);h?(o.setTo(e.x,e.y,e.width,e.height),h=!1):(t=e,void 0===(i=e=o)&&(i=new Y),n=Math.min(e.x,t.x),s=Math.min(e.y,t.y),r=Math.max(e.right,t.right)-n,e=Math.max(e.bottom,t.bottom)-s,o=i.setTo(n,s,r,e))}),o},lineToTileXYArray:function(t,e,i,n,s){"number"!=typeof t&&(s=e,t=(a=t).x1,e=a.y1,i=a.x2,n=a.y2),void 0===s&&(s=[]);for(var r,o,h,a=function(t,e,i,n){t-=i,i=e-n;return Math.sqrt(t*t+i*i)}(t,e,i,n),u=Math.min(this.grid.cellWidth,this.grid.cellHeight),l=Math.ceil(a/(u/4)),c=0;c<=l;c++)h=Ot(t,i,r=c/l),r=Ot(e,n,r),h=this.worldXYToTileXY(h,r),!this.contains(h.x,h.y)||o&&je(o,h)||(s.push(h),o=h);return s},circleToTileXYArray:function(t,e,i){return this.shapeToTileXYArray(t,e,i)},ellipseToTileXYArray:function(t,e,i){return this.shapeToTileXYArray(t,e,i)},polygonToTileXYArray:function(t,e,i){Array.isArray(e)&&(i=e,e=void 0);e={testMode:e,searchRectangle:Ae=function(t,e){void 0===e&&(e=new Y);for(var i,n=1/0,s=1/0,r=-n,o=-s,h=0;h<t.points.length;h++)i=t.points[h],n=Math.min(n,i.x),s=Math.min(s,i.y),r=Math.max(r,i.x),o=Math.max(o,i.y);return e.x=n,e.y=s,e.width=r-n,e.height=o-s,e}(t,Ae)};return this.shapeToTileXYArray(t,e,i)},rectangleToTileXYArray:function(t,e,i){return this.shapeToTileXYArray(t,e,i)},triangleToTileXYArray:function(t,e,i){return this.shapeToTileXYArray(t,e,i)},shapeToTileXYArray:function(t,e,i){return"number"==typeof e&&(e={testMode:e}),Array.isArray(e)&&(i=e,e=void 0),void 0===i&&(i=[]),this.forEachTileXYInShape(t,function(t){i.push({x:t.x,y:t.y})},void 0,e),i},forEachTileXYInShape:function(i,n,t,e){var s=g(e,"testMode",0),r=g(e,"searchRectangle",i),e=(g(e,"order",0),t&&(n=n.bind(t)),Ee=this.worldXYToTileXY(r.left,r.top,Ee),_e=this.worldXYToTileXY(r.right,r.bottom,_e),Ee.x-1),t=Ee.y-1,r=_e.x+1,o=_e.y+1;return this.forEachTileXY(function(t,e){if(At(e,i,t.x,t.y,s))return n(t,e)},this,{left:e,right:r,top:t,bottom:o}),this},uidToChess:function(t){return null!=t&&this.boardData.exists(t)?lt.get(t).parent:null},addChess:Et,removeChess:function(t,e,i,n,s,r){if(void 0===s&&(s=!1),void 0===r&&(r=!1),t){var o=this.chessToTileXYZ(t);if(!o)return this;e=o.x,i=o.y,n=o.z}else if(!(t=this.tileXYZToChess(e,i,n)))return this;return r||this.boardData.removeUID(e,i,n),this.isBoard&&this.getChessData(t).setBoard(null),s&&t.destroy&&t.destroy(),this},removeAllChess:function(t,e){for(var i=this.getAllChess(),n=0,s=i.length;n<s;n++)this.removeChess(i[n],void 0,void 0,void 0,t,e);return this},swapChess:function(t,e,i){void 0===i&&(i=!0);var n=this.chessToTileXYZ(t),s=this.chessToTileXYZ(e);return null!=n&&null!=s&&(this.removeChess(t),this.removeChess(e),this.addChess(t,s.x,s.y,s.z,i),this.addChess(e,n.x,n.y,n.z,i)),this},moveChess:Et,setChessTileZ:function(t,e,i){void 0===i&&(i=!1);var n=this.chessToTileXYZ(t);return n&&this.moveChess(t,n.x,n.y,e,i),this},getAllChess:function(t){for(var e in void 0===t&&(t=[]),this.boardData.UIDToXYZ)t.push(this.uidToChess(e));return t},contains:function(t,e,i){var n=!!this.infinityMode||0<=t&&t<this.width&&0<=e&&e<this.height;return n=n&&void 0!==i?this.boardData.contains(t,e,i):n},forEachTileXY:function(t,e,i){var n=this.width-1,s=this.height-1,r=g(i="number"==typeof i?{order:i}:i,"order",0),o=g(i,"left",0),h=g(i,"right",n),a=g(i,"top",0),u=g(i,"bottom",s);switch(this.infinityMode||(o=_t(o,0,n),a=_t(a,0,s),h=_t(h,0,n),u=_t(u,0,s)),r){case 0:for(var l=a;l<=u;l++)for(var c=o;c<=h&&(X.x=c,X.y=l,!(e?t.call(e,X,this):t(X,this)));c++);break;case 1:for(l=a;l<=u;l++)for(c=h;o<=c&&(X.x=c,X.y=l,!(e?t.call(e,X,this):t(X,this)));c--);break;case 2:for(c=o;c<=h;c++)for(l=a;l<=u&&(X.x=c,X.y=l,!(e?t.call(e,X,this):t(X,this)));l++);break;case 3:for(c=o;c<=h;c++)for(l=u;a<=l&&(X.x=c,X.y=l,!(e?t.call(e,X,this):t(X,this)));l--);}return this},getWrapTileXY:function(t,e,i){return void 0===i?i={}:!0===i&&(i=Ge),this.wrapMode?t=Rt(t,0,this.width):!this.infinityMode&&(t<0||t>=this.width)&&(t=null),this.wrapMode?e=Rt(e,0,this.height):!this.infinityMode&&(e<0||e>=this.height)&&(e=null),i.x=t,i.y=e,i},tileXYZToChess:function(t,e,i){t=this.boardData.getUID(t,e,i);return this.uidToChess(t)},tileXYToChessArray:function(t,e,i){void 0===i&&(i=[]);var n=this.boardData.getUID(t,e);if(null!=n)for(var s in n)i.push(this.uidToChess(n[s]));return i},tileZToChessArray:function(t,e){void 0===e&&(e=[]);var i,n=this.boardData.UIDToXYZ;for(i in n)n[i].z===t&&e.push(this.uidToChess(i));return e},tileXYArrayToChessArray:function(t,e,i){Array.isArray(e)&&(i=e,e=void 0),void 0===i&&(i=[]);for(var n,s=null!=e,r=0,o=t.length;r<o;r++)n=t[r],s?i.push(this.tileXYZToChess(n.x,n.y,e)):this.tileXYToChessArray(n.x,n.y,i);return i},chessToTileXYZ:function(t){var e;return t?Tt(t)||!Tt(e=t)&&e&&!!e.rexChess?(e=it(t),this.boardData.getXYZ(e)):(e=t)&&(b(e)||e.isTileXYZ)?t:null:null},offset:function(t,e,i,n){return void 0===n?n={}:!0===n&&(n=We),0===e&&0===i?(n.x=t.x,n.y=t.y):this.grid.offset(t,e,i,n),n},mirror:function(t,e,i,n){return void 0===n?n={}:!0===n&&(n=Ve),void 0!==i?this.offset(t,-i.x,-i.y,n):(n.x=t.x,n.y=t.y),this.grid.mirror(n,e,n),void 0!==i&&this.offset(n,i.x,i.y,n),n},rotate:function(t,e,i,n){return void 0===n?n={}:!0===n&&(n=Je),void 0!==i?this.offset(t,-i.x,-i.y,n):(n.x=t.x,n.y=t.y),this.grid.rotate(n,e,n),void 0!==i&&this.offset(n,i.x,i.y,n),n},getOppositeDirection:function(t,e,i){var n;return t&&"number"!=typeof t&&(i=e,n=t,t=(n=this.chessToTileXYZ(n)).x,e=n.y),this.grid.getOppositeDirection(t,e,i)},getDistance:function(t,e,i){return t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e),this.grid.getDistance(t,e,i)},directionBetween:function(t,e,i){void 0===i&&(i=!0);t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e);return this.grid.directionBetween(t,e,i)},isDirectionInCone:function(t,e,i,n){var t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e),s=this.grid.directions,t=(this.grid.setDirectionMode(this.sides),this.grid.directionBetween(t,e,!1)),e=(this.grid.setDirectionMode(s),Math.abs(t-i));return Math.min(e,this.grid.directions-e)<=n/2},fit:function(t){var e,i=1/0,n=1/0;for(s in t)e=t[s],i=Math.min(i,e.x),n=Math.min(n,e.y);if(0!==i||0!==n)for(var s in t)e=t[s],this.offset(e,-i,-n,e);var r=-1/0,o=-1/0;for(s in t)e=t[s],r=Math.max(r,e.x),o=Math.max(o,e.y);return this.setBoardWidth(r+1),this.setBoardHeight(o+1),t},isEmptyTileXYZ:function(t,e,i){return this.contains(t,e)&&!this.contains(t,e,i)},getEmptyTileXYArray:function(t,e){void 0===t&&(t=0),void 0===e&&(e=[]);for(var i=0;i<this.height;i++)for(var n=0;n<this.width;n++)this.isEmptyTileXYZ(n,i,t)&&e.push({x:n,y:i});return e},getRandomEmptyTileXY:function(t,e){void 0===t&&(t=0),void 0===e?e={}:!0===e&&(e=qe);for(var i,n,s,r=!0,o=20;r&&0<o;)i=He(0,this.width-1),n=He(0,this.height-1),r=null!==this.tileXYZToChess(i,n,t),o--;return r?0===(Ke=this.getEmptyTileXYArray(t,Ke)).length?null:(s=Bt(Ke),e.x=s.x,e.y=s.y,Ke.length=0,e):(e.x=i,e.y=n,e)},getEmptyTileXYArrayInRange:function(t,e,i,n){var s;void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=[]),t=this.chessToTileXYZ(t),this.grid.ringToTileXYArray(t,e,$e);for(var r=0,o=$e.length;r<o;r++)s=$e[r],this.isEmptyTileXYZ(s.x,s.y,i)&&n.push(s);return $e.length=0,n},getRandomEmptyTileXYInRange:function(t,e,i,n){var s;void 0===e&&(e=1),void 0===i&&(i=0),void 0===n?n={}:!0===n&&(n=ti),t=this.chessToTileXYZ(t),this.grid.ringToTileXYArray(t,e,Qe),Nt(Qe);for(var r=0,o=Qe.length;r<o;r++)if(s=Qe[r],this.isEmptyTileXYZ(s.x,s.y,i))return n.x=s.x,n.y=s.y,Qe.length=0,n;return Qe.length=0,null},getTileXYAtDirection:function(t,e,i,n){var s=this.chessToTileXYZ(t);if(!s)return null;var r,t="number"==typeof(e="string"==typeof e?-1===e.indexOf(",")?parseInt(e):e.split(","):e),o="number"==typeof i;if(t&&o)n=this.grid.getTileXYAtDirection(s.x,s.y,e,i,n),this.getWrapTileXY(n.x,n.y,n),null==n.x||null==n.y?n=null:n.direction=e;else if(void 0===n&&(n=[]),null==e&&(e=this.grid.allDirections),t)if(b(i)){var h=g(i,"end",1),t=g(i,"start",0<h?1:-1),a=g(i,"step",t<=h?1:-1);if(t===h)null!==(r=this.getTileXYAtDirection(s,e,h))&&n.push(r);else if(t<h)for(var u=t;u<=h;u+=a)null!==(r=this.getTileXYAtDirection(s,e,u))&&n.push(r);else for(u=t;h<=u;u+=a)null!==(r=this.getTileXYAtDirection(s,e,u))&&n.push(r)}else for(var u=0,l=i.length;u<l;u++)null!==(r=this.getTileXYAtDirection(s,e,i[u]))&&n.push(r);else for(u=0,l=e.length;u<l;u++)o?null!==(r=this.getTileXYAtDirection(s,e[u],i))&&n.push(r):this.getTileXYAtDirection(s,e[u],i,n);return n},getNeighborTileXY:function(t,e,i){return this.getTileXYAtDirection(t,e,1,i)},getNeighborTileXYAtAngle:function(t,e,i){e=this.angleSnapToDirection(t,e);return this.getTileXYAtDirection(t,e,1,i)},getNeighborChess:function(t,e,i,n){if(null===(t=this.chessToTileXYZ(t)))return null;null==i&&(i=t.z);var s,r=a(e);if("number"===r||"string"===r&&-1===e.indexOf(","))return null===(r=this.getNeighborTileXY(t,e,!0))?null:this.tileXYZToChess(r.x,r.y,i);void 0===n&&(n=[]),this.getNeighborTileXY(t,e,ei);for(var o=0,h=ei.length;o<h;o++)null!=(s=this.tileXYZToChess(ei[o].x,ei[o].y,i))&&n.push(s);return ei.length=0,n},getNeighborTileDirection:function(t,e){if(null===t||null===e)return null;if(t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e),je(t,e))return null;var i=this.grid.getNeighborTileDirection(t,e);if(this.wrapMode&&null===i){for(var n=0,s=(ii=this.getNeighborTileXY(t,null,ii)).length;n<s;n++)if(je(e,ii[n])){i=n;break}ii.length=0}return i},getNeighborChessDirection:function(t,e){t=this.chessToTileXYZ(t),e=this.chessToTileXYZ(e);return this.getNeighborTileDirection(t,e)},areNeighbors:function(t,e){return null!==this.getNeighborChessDirection(t,e)},mapNeighbors:function(t,e,i,n){return"number"!=typeof e&&(n=i,i=e,e=1),this.getTileXYAtDirection(t,void 0,e).map(i,n)},ringToTileXYArray:function(t,e,i){var n;void 0===i&&(i=[]),t=this.chessToTileXYZ(t),this.grid.ringToTileXYArray(t,e,ni);for(var s=0,r=ni.length;s<r;s++)n=ni[s],this.contains(n.x,n.y)&&i.push(n);return ni.length=0,i},ringToChessArray:function(t,e,i,n){var s;Array.isArray(i)&&(n=i,i=void 0),void 0===n&&(n=[]),t=this.chessToTileXYZ(t),this.grid.ringToTileXYArray(t,e,si);for(var r=0,o=si.length;r<o;r++)s=si[r],(s=this.tileXYZToChess(s.x,s.y,i))&&n.push(s);return si.length=0,n},filledRingToTileXYArray:function(t,e,i,n){m(i)&&(n=i,i=void 0),void 0===i&&(i=!0),void 0===n&&(n=[]),t=this.chessToTileXYZ(t);for(var s=0;s<=e;s++)this.ringToTileXYArray(t,i?s:e-s,n);return n},filledRingToChessArray:function(t,e,i,n,s){m(n)&&(s=n,n=void 0),void 0===n&&(n=!0),void 0===s&&(s=[]),t=this.chessToTileXYZ(t);for(var r=0;r<=e;r++)this.ringToChessArray(t,n?r:e-r,i,s);return s},hasBlocker:function(t,e,i){var n,s;if(t&&"number"!=typeof t&&(t=(n=this.chessToTileXYZ(t)).x,e=n.y,i=n.z),void 0!==i)return null!==(s=this.tileXYZToChess(t,e,i))&&!0===this.getChessData(s).blocker;for(var r=0,o=(s=this.tileXYToChessArray(t,e,ri)).length;r<o;r++)if(!0===this.getChessData(s[r]).blocker)return!(ri.length=0);return ri.length=0,!1},hasEdgeBlocker:function(t,e,i,n){var s;if(void 0!==i)return null!==(s=this.tileXYZToChess(t,e,i))&&Zt(this.getChessData(s).blocker);for(var r=0,o=(s=this.tileXYToChessArray(t,e,oi)).length;r<o;r++)if(Zt(this.getChessData(s[r]).blocker))return!(oi.length=0);return oi.length=0,!1}},"getGridPoints",ht),N(t,"chessToBoard",Lt),function(t){if("object"===a(t)&&null!==t)if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];return t}),ai=function(){function t(){y(this,t),this.XYZToUID={},this.UIDToXYZ={},this.clear()}return u(t,[{key:"shutdown",value:function(t){return this.XYZToUID=void 0,this.UIDToXYZ=void 0,this}},{key:"destroy",value:function(t){return this.shutdown(t),this}},{key:"clear",value:function(){return hi(this.UIDToXYZ),hi(this.XYZToUID),this.chessCount=0,this.clearBounds(),this}},{key:"clearBounds",value:function(){return this._xMax=void 0,this._xMin=void 0,this._yMax=void 0,this._yMin=void 0,this}},{key:"addUID",value:function(t,e,i,n){this.XYZToUID.hasOwnProperty(e)||(this.XYZToUID[e]={});var s=this.XYZToUID[e];return s.hasOwnProperty(i)||(s[i]={}),s[i][n]=t,this.UIDToXYZ[t]={x:e,y:i,z:n},this.chessCount++,this.clearBounds(),this}},{key:"getUID",value:function(t,e,i){t=this.XYZToUID[t];return t=(t=t&&t[e])&&void 0!==i?t[i]:t}},{key:"removeUID",value:function(t,e,i){var n,s,r;return this.XYZToUID.hasOwnProperty(t)&&(n=this.XYZToUID[t]).hasOwnProperty(e)&&(s=n[e]).hasOwnProperty(i)&&(r=s[i],delete s[i],delete this.UIDToXYZ[r],It(s)&&delete n[e],It(n)&&delete this.XYZToUID[t],this.chessCount--,this.clearBounds()),this}},{key:"exists",value:function(t){return this.UIDToXYZ.hasOwnProperty(t)}},{key:"contains",value:function(t,e,i){return null!=this.getUID(t,e,i)}},{key:"getXYZ",value:function(t){return this.exists(t)?this.UIDToXYZ[t]:null}},{key:"xMax",get:function(){if(void 0===this._xMax){this._xMax=-1/0;var t,e,i=this.UIDToXYZ;for(e in i)t=i[e].x,this._xMax<t&&(this._xMax=t)}return this._xMax}},{key:"xMin",get:function(){if(void 0===this._xMin){this._xMin=1/0;var t,e,i=this.UIDToXYZ;for(e in i)t=i[e].x,this._xMin>t&&(this._xMin=t)}return this._xMin}},{key:"yMax",get:function(){if(void 0===this._yMax){this._yMax=-1/0;var t,e,i=this.UIDToXYZ;for(e in i)t=i[e].y,this._yMax<t&&(this._yMax=t)}return this._yMax}},{key:"yMin",get:function(){if(void 0===this._yMin){this._yMin=1/0;var t,e,i=this.UIDToXYZ;for(e in i)t=i[e].y,this._yMin>t&&(this._yMin=t)}return this._yMin}}]),t}(),ui={},li={},ci=function(){function e(t){y(this,e),this.resetFromJSON(t)}return u(e,[{key:"resetFromJSON",value:function(t){this.setType(g(t,"type",0)),this.setDirectionMode(g(t,"dir",4)),this.setOriginPosition(g(t,"x",0),g(t,"y",0)),this.setCellSize(g(t,"cellWidth",0),g(t,"cellHeight",0))}},{key:"setType",value:function(t){return"string"==typeof t&&(t=di[t]),this.mode=t,this}},{key:"setDirectionMode",value:function(t){return"string"==typeof t&&(t=fi[t]),this.directions=t,this}},{key:"setOriginPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._halfWidth=t/2}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._halfHeight=t/2}},{key:"setCellSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"cellWidth",get:function(){return this.width},set:function(t){this.width=t}},{key:"cellHeight",get:function(){return this.height},set:function(t){this.height=t}}]),e}(),di=(Object.assign(ci.prototype,{getWorldXY:function(t,e,i){var n,s;switch(void 0===i?i={}:!0===i&&(i=ui),this.mode){case 0:n=t*this.width,s=e*this.height;break;case 1:n=(t-e)*this._halfWidth,s=(t+e)*this._halfHeight}return n+=this.x,s+=this.y,i.x=n,i.y=s,i},getWorldX:function(t,e){return this.getWorldXY(t,e,!0).x},getWorldY:function(t,e){return this.getWorldXY(t,e,!0).y},getTileXY:function(t,e,i){void 0===i?i={}:!0===i&&(i=li),t-=this.x,e-=this.y;var n=t/this.width,s=e/this.height;switch(this.mode){case 0:i.x=Math.round(n),i.y=Math.round(s);break;case 1:i.x=Math.round(n+s),i.y=Math.round(s-n)}return i},getTileX:function(t,e){return this.getTileXY(t,e,!0).x},getTileY:function(t,e){return this.getTileXY(t,e,!0).y}}),{orthogonal:0,isometric:1,staggered:2}),fi={"4dir":4,"8dir":8},vi=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]],yi=vi,pi={},gi=function(t){var e,i,n,s={};for(n in t)e=(i=t[n])[0],i=i[1],s.hasOwnProperty(e)||(s[e]={}),s[e][i]=parseInt(n);return s}(vi),bi=gi,Ti={0:2,1:3,2:0,3:1,4:6,5:7,6:4,7:5},mi={},xi={},ki={},wi=function(t){for(var e=[],i=0;i<t;i++)e.push({x:0,y:0});return e},Ci={},Yi=wi(4),Xi=new Y,Mi=function(){l(i,ci);var e=d(i);function i(t){return y(this,i),(t=e.call(this,t)).sides=4,t}return u(i,[{key:"allDirections",get:function(){return 4===this.directions?Pi:Si}},{key:"halfDirections",get:function(){return 4===this.directions?Di:Oi}}]),i}(),Pi=[0,1,2,3],Si=[0,1,2,3,4,5,6,7],Di=[0,1],Oi=[0,1,4,5],Ai=(Object.assign(Mi.prototype,{saveOrigin:Ft,restoreOrigin:jt,getTileXYAtDirection:zt,getNeighborTileXY:function(t,e,i,n){return zt.call(this,t,e,i,1,n)},getNeighborTileDirection:function(t,e){var i;switch(this.mode){case 0:i=gi;break;case 1:i=bi}var n=e.x-t.x,e=e.y-t.y;if(i.hasOwnProperty(n)){t=i[n];if(t.hasOwnProperty(e))return t[e]}return null},getOppositeDirection:function(t,e,i){return Ti[i]},offset:Ut,mirror:function(t,e,i){return void 0===i?i={}:!0===i&&(i=xi),i.x=1&e?-t.x:t.x,i.y=2&e?-t.y:t.y,i},rotate:function(t,e,i){var n,s;switch(void 0===i?i={}:!0===i&&(i=ki),e=Rt(e,0,3)){case 1:n=-t.y,s=t.x;break;case 2:n=-t.x,s=-t.y;break;case 3:n=t.y,s=-t.x;break;default:n=t.x,s=t.y}return i.x=n,i.y=s,i},getDistance:function(t,e,i){var n=e.x-t.x,e=e.y-t.y,t=i?Math.abs(n)+Math.abs(e):Math.sqrt(n*n+e*e);return t},directionBetween:function(t,e,i){var n,s,r,o;switch(void 0===i&&(i=!0),this.mode){case 0:case 1:t.y===e.y?o=e.x>=t.x?0:2:t.x===e.x?o=e.y>=t.y?1:3:4===this.directions?((s=ot(st(t.x,t.y,e.x,e.y)))<0&&(s+=360),o=s/90,i&&(o=Math.round(o))):o=(n=e.x-t.x)==(r=e.y-t.y)?0<n?4:6:n==-r?0<n?7:5:((s=ot(Math.atan2(r,n)))<0&&(s+=360),r=s/45,0<=(r=i?Math.round(r):r)&&r<1?r:1<=r&&r<2?r+3:2<=r&&r<3?r-1:3<=r&&r<4?r+2:4<=r&&r<5?r-2:5<=r&&r<6?r+1:6<=r&&r<7?r-3:r)}return o=o===this.directions?0:o},directionNormalize:Gt,getGridPoints:function(t,e,i){void 0===i?i=wi(4):!0===i&&(i=Yi),void 0===t?(Ci.x=0,Ci.y=0):this.getWorldXY(t,e,Ci);var t=0===this.mode?0:1,e=Ci.x,n=Ci.y,s=this.width,r=this.height,o=i;return void 0===o&&(o=wi(4)),s/=2,r/=2,0===t?(o[0].x=e+s,o[0].y=n-r,o[1].x=e+s,o[1].y=n+r,o[2].x=e-s,o[2].y=n+r,o[3].x=e-s):(o[0].x=e+s,o[0].y=n,o[1].x=e,o[1].y=n+r,o[2].x=e-s,o[2].y=n,o[3].x=e),o[3].y=n-r,i},getBounds:function(t,e,i){void 0===i?i=new Y:!0===i&&(i=Xi);t=this.getWorldXY(t,e,!0);return i.x=t.x-.5*this.width,i.y=t.y-.5*this.height,i.width=this.width,i.height=this.height,i},ringToTileXYArray:function(t,e,i){var n,s;for(void 0===i&&(i=[]),s=-(n=e);s<=e;s++)i.push(Ut(t,n,s));for(n=(s=e)-1;-e<=n;n--)i.push(Ut(t,n,s));for(n=-e,s=e-1;-e<=s;s--)i.push(Ut(t,n,s));for(s=-e,n=1-e;n<=e-1;n++)i.push(Ut(t,n,s));return i}}),Math.sqrt(3)),Ei=Math.sqrt(3),M=0,P=1,S=2,D=3,_i=M,Ri=P,Bi=S,Ni=D,Zi={},Li=M,Ii=P,Fi=S,ji=D,zi={},Ui={},Gi=M,Wi=P,Vi=S,Ji=D,Hi={},Ki={},qi=M,$i=P,Qi=S,tn=D,en=function(){function e(t){y(this,e),this.resetFromJSON(t)}return u(e,[{key:"resetFromJSON",value:function(t){this.setType(g(t,"staggeraxis",1),g(t,"staggerindex",1)),this.setDirectionMode(),this.setOriginPosition(g(t,"x",0),g(t,"y",0));var e=g(t,"size",void 0);void 0!==e?this.setCellRadius(e):this.setCellSize(g(t,"cellWidth",0),g(t,"cellHeight",0))}},{key:"setType",value:function(t,e){return"string"==typeof t&&(t=nn[t]),"string"==typeof e&&(e=sn[e]),this.staggeraxis=t,this.staggerindex=e,this.mode=0===t?0===e?tn:Qi:0===e?$i:qi,this}},{key:"setDirectionMode",value:function(){return this.directions=6,this}},{key:"setOriginPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._halfWidth=t/2}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._halfHeight=t/2}},{key:"setCellSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"setCellRadius",value:function(t){this.size=t;var t={size:this.size,type:this.staggeraxis},e=0===(e=t).type?2*e.size:Ai*e.size,t=0===(t=t).type?Ei*t.size:2*t.size;return this.setCellSize(e,t),this}},{key:"cellWidth",get:function(){return this.width},set:function(t){this.width=t}},{key:"cellHeight",get:function(){return this.height},set:function(t){this.height=t}}]),e}(),nn=(Object.assign(en.prototype,{getWorldXY:function(t,e,i){void 0===i?i={}:!0===i&&(i=Zi);var n=t*this.width,s=e*this.height;switch(this.mode){case _i:1&e&&(n+=this._halfWidth),s*=.75;break;case Ri:1&e&&(n-=this._halfWidth),s*=.75;break;case Bi:n*=.75,1&t&&(s+=this._halfHeight);break;case Ni:n*=.75,1&t&&(s-=this._halfHeight)}return n+=this.x,s+=this.y,i.x=n,i.y=s,i},getWorldX:function(t,e){return this.getWorldXY(t,e,!0).x},getWorldY:function(t,e){return this.getWorldXY(t,e,!0).y},getTileXY:function(t,e,i){var n,s;switch(void 0===i?i={}:!0===i&&(i=Ki),t-=this.x,e-=this.y,this.mode){case Gi:case Wi:s=e*(4/3)/this.height,n=t/this.width-2/3*(e/this.height);break;case Vi:case Ji:s=e/this.height-2/3*(t/this.width),n=t*(4/3)/this.width}d=n,r=s,void 0===(u=Hi)?u={}:!0===u&&(u=zi),u.x=d,u.y=-d-r,u.z=r;var r,o,h,a,u,l,c,d=u;return"number"!=typeof(r=d)&&(r=(a=r).x,o=a.y,h=a.z),void 0===a?a={}:!0===a&&(a=zi),u=Math.round(r),l=Math.round(o),c=Math.round(h),r=Math.abs(u-r),o=Math.abs(l-o),h=Math.abs(c-h),o<r&&h<r?u=-l-c:h<o?l=-u-c:c=-u-l,a.x=u,a.y=l,a.z=c,k(this.mode,d.x,d.y,d.z,i),i},getTileX:function(t,e){return this.getTileXY(t,e,!0).x},getTileY:function(t,e){return this.getTileXY(t,e,!0).y}}),{y:0,x:1}),sn={even:0,odd:1},O=[[[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]]],[[[1,0],[1,1],[0,1],[-1,0],[0,-1],[1,-1]],[[1,0],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]]],[[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]],[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]]],[[[1,1],[0,1],[-1,1],[-1,0],[0,-1],[1,0]],[[1,0],[0,1],[-1,0],[-1,-1],[0,-1],[1,-1]]]],rn=M,on=P,hn=S,an=D,un={},ln=[[i(O[0][0]),i(O[0][1])],[i(O[1][0]),i(O[1][1])],[i(O[2][0]),i(O[2][1])],[i(O[3][0]),i(O[3][1])]],cn=M,dn=P,fn=S,vn=D,yn={},pn=M,gn=P,bn={},Tn={},mn={},xn={},kn={},wn={},Cn=Math.PI/180,Yn=function(t){return t*Cn},Xn=wi(6),Mn={},Pn={},Sn=new Y,Dn=function(){l(i,en);var e=d(i);function i(t){return y(this,i),(t=e.call(this,t)).sides=6,t}return u(i,[{key:"allDirections",get:function(){return On}},{key:"halfDirections",get:function(){return An}}]),i}(),On=[0,1,2,3,4,5],An=[0,1,2],En=(Object.assign(Dn.prototype,{saveOrigin:Ft,restoreOrigin:jt,getTileXYAtDirection:Vt,getNeighborTileXY:function(t,e,i,n){return Vt.call(this,t,e,i,1,n)},getNeighborTileDirection:function(t,e){var i=Wt(this.mode,t.x,t.y),i=ln[this.mode][i],n=e.x-t.x,e=e.y-t.y;if(i.hasOwnProperty(n)){t=i[n];if(t.hasOwnProperty(e))return t[e]}return null},getOppositeDirection:function(t,e,i){return(i+3)%6},offset:function(t,e,i,n){void 0===n?n={}:!0===n&&(n=yn);var s=t.x+e,r=t.y+i;switch(this.mode){case cn:0!=(1&i)&&0==(1&r)&&(s+=1);break;case dn:0!=(1&i)&&0==(1&r)&&--s;break;case fn:0!=(1&e)&&0==(1&s)&&(r+=1);break;case vn:0!=(1&e)&&0==(1&s)&&--r}return n.x=s,n.y=r,n},mirror:function(t,e,i){void 0===i?i={}:!0===i&&(i=bn);var n,s,r,t=x(this.mode,t.x,t.y,!0),o=this.mode===pn||this.mode===gn;return 1&e&&(r=o?(n=t.y,s=t.x,t.z):(n=-t.x,s=-t.z,-t.y),t.x=n,t.y=s,t.z=r),2&e&&(r=o?(n=-t.y,s=-t.x,-t.z):(n=t.x,s=t.z,t.y)),k(this.mode,n,0,r,i),i},rotate:function(t,e,i){void 0===i?i={}:!0===i&&(i=Tn),e=Rt(e,0,5);var n,s,r=x(this.mode,t.x,t.y,!0);switch(e){case 1:n=-r.z,r.x,s=-r.y;break;case 2:n=r.y,r.z,s=r.x;break;case 3:n=-r.x,r.y,s=-r.z;break;case 4:n=r.z,r.x,s=r.y;break;case 5:n=-r.y,r.z,s=-r.x;break;default:n=r.x,r.y,s=r.z}return k(this.mode,n,0,s,i),i},getDistance:function(t,e,i){x(this.mode,t.x,t.y,mn),x(this.mode,e.x,e.y,xn);t=xn.y-mn.y,e=xn.z-mn.z;return(Math.abs(xn.x-mn.x)+Math.abs(t)+Math.abs(e))/2},directionBetween:function(t,e,i){void 0===i&&(i=!0),x(this.mode,t.x,t.y,kn),x(this.mode,e.x,e.y,wn);var t=wn.x-kn.x,e=wn.y-kn.y,n=wn.z-kn.z,n=0==n?0<t?0:3:0==t?0<n?1:4:0==e?0<n?2:5:0<t&&e<0&&0<n?0+n/-e:t<0&&e<0&&0<n?1+-e/n:t<0&&0<e&&0<n?2+e/-t:t<0&&0<e&&n<0?3+-n/e:0<t&&0<e&&n<0?4+t/-n:5+-e/t;return n=i?Math.round(n):n},directionNormalize:Gt,getGridPoints:function(t,e,i){void 0===i?i=wi(6):!0===i&&(i=Xn),void 0===t?(Mn.x=0,Mn.y=0):this.getWorldXY(t,e,Mn),void 0!==this.size?l=this.size:((l=Pn).width=this.width,l.height=this.height);var n=Mn.x,s=Mn.y,r=l,t=this.staggeraxis,o=i;if(void 0===o&&(o=wi(6)),void 0!==r)if("number"==typeof r)for(var h,a=0===t?0:-30,u=0;u<6;u++)h=Yn(60*u+a),o[u].x=n+r*Math.cos(h),o[u].y=s+r*Math.sin(h);else{var e=r.width,l=r.height,c=e/2,e=e/4,d=l/2,l=l/4;0===t?(o[0].x=n+c,o[0].y=s,o[1].x=n+e,o[1].y=s+d,o[2].x=n-e,o[2].y=s+d,o[3].x=n-c,o[3].y=s,o[4].x=n-e,o[4].y=s-d,o[5].x=n+e):(o[0].x=n+c,o[0].y=s-l,o[1].x=n+c,o[1].y=s+l,o[2].x=n,o[2].y=s+d,o[3].x=n-c,o[3].y=s+l,o[4].x=n-c,o[4].y=s-l,o[5].x=n),o[5].y=s-d}return i},getBounds:function(t,e,i){void 0===i?i=new Y:!0===i&&(i=Sn);t=this.getWorldXY(t,e,!0);return i.x=t.x-.5*this.width,i.y=t.y-.5*this.height,i.width=this.width,i.height=this.height,i},ringToTileXYArray:function(t,e,i){void 0===i&&(i=[]);for(var n,t=x(this.mode,t.x,t.y,!0),s=t.x,r=(t.y,t.z),o=e,h=0;-e<=h;h--)n=-h-o,i.push(k(this.mode,s+h,0,r+o));for(h=-e,n=1;n<=e;n++)i.push(k(this.mode,s+h,0,r+(o=-h-n)));for(n=e,o=-1;-e<=o;o--)i.push(k(this.mode,s+(h=-n-o),0,r+o));for(o=-e,h=1;h<=e;h++)n=-h-o,i.push(k(this.mode,s+h,0,r+o));for(h=e,n=-1;-e<=n;n--)i.push(k(this.mode,s+h,0,r+(o=-h-n)));for(n=-e,o=1;o<=e-1;o++)i.push(k(this.mode,s+(h=-n-o),0,r+o));return i}}),{quadGrid:Mi,hexagonGrid:Dn}),_n=function(){l(s,ut);var n=d(s);function s(t,e){var i;return y(this,s),(i=n.call(this)).isShutdown=!1,i.scene=t,i.boardData=new ai,i.resetFromJSON(e),i.boot(),i}return u(s,[{key:"resetFromJSON",value:function(t){return this.isBoard=g(t,"isBoard",!0),this.setGrid(g(t,"grid",void 0)),this.setWrapMode(g(t,"wrap",!1)),this.setInfinityMode(g(t,"infinity",!1)),this.setBoardWidth(g(t,"width",0)),this.setBoardHeight(g(t,"height",0)),this}},{key:"boot",value:function(){this.scene&&this.isBoard&&this.scene.sys.events.once("shutdown",this.destroy,this)}},{key:"shutdown",value:function(t){if(!this.isShutdown)return this.scene&&this.isBoard&&this.scene.sys.events.off("shutdown",this.destroy,this),this.isBoard&&this.removeAllChess(!t,!0),f(c(s.prototype),"shutdown",this).call(this),this.boardData.shutdown(t),this.scene=void 0,this.boardData=void 0,this.isShutdown=!0,this}},{key:"destroy",value:function(t){this.isShutdown||(this.emit("destroy",this,t),this.shutdown(t))}},{key:"setGrid",value:function(t){var e,i;return b(t)&&(i=g(e=t,"gridType","quadGrid"),t=new En[i](e)),this.grid=t,this}},{key:"setWrapMode",value:function(t){return this.wrapMode=t=void 0===t?!0:t,this}},{key:"setInfinityMode",value:function(t){return this.infinityMode=t=void 0===t?!0:t,this}},{key:"setBoardSize",value:function(t,e){return this.setBoardWidth(t),this.setBoardHeight(e),this}},{key:"exists",value:function(t){return this.boardData.exists(this.getChessUID(t))}},{key:"chessCount",get:function(){return this.boardData.chessCount}},{key:"clear",value:function(t){return this.removeAllChess(t=void 0===t?!0:t,!0),this.boardData.clear(),this}}],[{key:"GetBoard",value:Lt}]),s}(),Rn=(Object.assign(_n.prototype,t),Phaser.GameObjects.Zone),Bn=function(){l(n,Rn);var i=d(n);function n(t){var e;return y(this,n),e=i.call(this,t,0,0,1,1),t.add.existing(p(e)),e.setScrollFactor(0),e.setInteractive({hitArea:{},hitAreaCallback:function(){return!0}}),e}return u(n)}(),Nn=Phaser.GameObjects.GameObject.RENDER_MASK,A=function(t,e,i,n,s,r){if(null!=n&&null!=s){for(var o,h="string"!=typeof t?t:void 0,a="string"!=typeof e?e:void 0,u=i.tileXYToChessArray(n,s,Zn),l=0,c=u.length;l<c;l++)!function(t){if(t.renderFlags!==Nn)return!1;var e=!0,i=t.parentContainer;if(i)do{if(i.renderFlags!==Nn){e=!1;break}}while(i=i.parentContainer);return e}(o=u[l])||(o.emit&&(a?a(o):o.emit(e,r)),h?h(o):i.emit(t,r,o));Zn.length=0}},Zn=[],Ln=Phaser.Utils.Objects.GetValue,In=function(){l(n,yt);var i=d(n);function n(t,e){return y(this,n),(t=i.call(this,t,e))._isRunning=!1,t.isPaused=!1,t.tickingState=!1,t.setTickingMode(Ln(e,"tickingMode",1)),t}return u(n,[{key:"boot",value:function(){2!==this.tickingMode||this.tickingState||this.startTicking()}},{key:"shutdown",value:function(t){this.isShutdown||(this.stop(),this.tickingState&&this.stopTicking(),f(c(n.prototype),"shutdown",this).call(this,t))}},{key:"setTickingMode",value:function(t){"string"==typeof t&&(t=Fn[t]),this.tickingMode=t}},{key:"startTicking",value:function(){this.tickingState=!0}},{key:"stopTicking",value:function(){this.tickingState=!1}},{key:"isRunning",get:function(){return this._isRunning},set:function(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode)&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking())}},{key:"start",value:function(){return this.isPaused=!1,this.isRunning=!0,this}},{key:"pause",value:function(){return this.isRunning&&(this.isPaused=!0,this.isRunning=!1),this}},{key:"resume",value:function(){return this.isPaused&&(this.isRunning=!0),this}},{key:"stop",value:function(){return this.isPaused=!1,this.isRunning=!1,this}},{key:"complete",value:function(){this.isPaused=!1,this.isRunning=!1,this.emit("complete",this.parent,this)}}]),n}(),Fn={no:0,lazy:1,always:2},jn=Phaser.Utils.Objects.GetValue,zn=function(){l(s,In);var n=d(s);function s(t,e){y(this,s);var i=$(t);return i===t&&(t=void 0),((i=n.call(this,i,e)).gameObject=t)&&t.setInteractive(jn(e,"inputConfig",void 0)),i._enable=void 0,i.resetFromJSON(e),i.boot(),i}return u(s,[{key:"resetFromJSON",value:function(t){return this.setEnable(jn(t,"enable",!0)),this.setDetectBounds(),void 0===this.gameObject?this.setDetectBounds(jn(t,"bounds",void 0)):this.setDetectBounds(),this.tracerState=Un,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}},{key:"boot",value:function(){f(c(s.prototype),"boot",this).call(this),(this.gameObject||this.scene.input).on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("gameout",this.dragCancel,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.sys.events.once("shutdown",this.destroy,this)}},{key:"shutdown",value:function(t){this.scene&&(this.gameObject||this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("gameout",this.dragCancel,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.sys.events.off("shutdown",this.destroy,this),this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,f(c(s.prototype),"shutdown",this).call(this,t))}},{key:"enable",get:function(){return this._enable},set:function(t){if(this._enable!==t)return t||this.dragCancel(),this._enable=t,this}},{key:"setEnable",value:function(t){return this.enable=t=void 0===t?!0:t,this}},{key:"setDetectBounds",value:function(t){return this.bounds=t,this}},{key:"toggleEnable",value:function(){return this.setEnable(!this.enable),this}},{key:"onPointerDown",value:function(t,e){!this.enable||void 0!==this.pointer||this.bounds&&!this.bounds.contains(t.x,t.y)||this.pointer===t||(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=Gn,void 0===this.gameObject&&(this.isTouchingAnyObject=0<e.length),this.onDragStart())}},{key:"onPointerUp",value:function(t){!this.enable||this.bounds&&!this.bounds.contains(t.x,t.y)||this.pointer!==t||(this.pointer=void 0,this.movedState=!1,this.tracerState=Un,this.onDragEnd())}},{key:"onPointerMove",value:function(t){var e,i;this.enable&&t.isDown&&(e=!this.bounds||this.bounds.contains(t.x,t.y),!(i=this.pointer===t)&&e||(i&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag())))}},{key:"dragCancel",value:function(){return this.tracerState===Gn&&this.onDragEnd(),this.pointer=void 0,this.tracerState=Un,this}},{key:"onDragStart",value:function(){this.emit("dragstart",this)}},{key:"onDragEnd",value:function(){this.emit("dragend",this)}},{key:"onDrag",value:function(){this.emit("drag",this)}},{key:"preUpdate",value:function(t,e){}},{key:"postUpdate",value:function(t,e){}},{key:"startTicking",value:function(){f(c(s.prototype),"startTicking",this).call(this),this.scene.sys.events.on("preupdate",this.preUpdate,this),this.scene.sys.events.on("postupdate",this.postUpdate,this)}},{key:"stopTicking",value:function(){f(c(s.prototype),"stopTicking",this).call(this),this.scene&&(this.scene.sys.events.off("preupdate",this.preUpdate,this),this.scene.sys.events.off("postupdate",this.postUpdate,this))}},{key:"setRecongizedStateObject",value:function(t){return this.recongizedState=t,this}},{key:"state",get:function(){return this.recongizedState.state},set:function(t){this.recongizedState.state=t}},{key:"cancel",value:function(){return this.state=Wn,this}}]),s}(),Un=0,Gn=1,Wn="IDLE",Vn=["next","exit","enter"],Jn=function(){function r(t){y(this,r);var e=g(t,"states",void 0),i=(e&&this.addStates(e),g(t,"extend",void 0));if(i)for(var n in i)this.hasOwnProperty(n)&&void 0!==this[n]||(this[n]=i[n]);var e=g(t,"eventEmitter",void 0),s=g(t,"EventEmitterClass",void 0);this.setEventEmitter(e,s),this._stateLock=!1,this.resetFromJSON(t)}return u(r,[{key:"shutdown",value:function(){this.destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"resetFromJSON",value:function(t){this.setEnable(g(t,"enable",!0)),this.start(g(t,"start",void 0));t=g(t,"init",void 0);return t&&t.call(this),this}},{key:"toJSON",value:function(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}},{key:"setEnable",value:function(t){return this.enable=t=void 0===t?!0:t,this}},{key:"toggleEnable",value:function(){return this.setEnable(!this.enable),this}},{key:"state",get:function(){return this._state},set:function(t){var e;this.enable&&!this._stateLock&&this._state!==t&&(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState&&((e=this[t="exit_"+this._prevState])&&e.call(this),this.emit(t,this)),this._stateLock=!1,null!=this._state)&&((t=this[e="enter_"+this._state])&&t.call(this),this.emit(e,this))}},{key:"prevState",get:function(){return this._prevState}},{key:"start",value:function(t){return this._start=t,this._prevState=void 0,this._state=t,this}},{key:"goto",value:function(t){return null!=t&&(this.state=t),this}},{key:"next",value:function(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}},{key:"stateProperties",get:function(){return Vn}},{key:"addState",value:function(t,e){"string"!=typeof t&&(t=(e=t).name);for(var i=this.stateProperties,n=0,s=i.length;n<s;n++){var r=i[n],o=e[r];o&&(this["".concat(r,"_").concat(t)]=o)}return this}},{key:"addStates",value:function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;e++)this.addState(t[e]);else for(var n in t)this.addState(n,t[n]);return this}},{key:"runMethod",value:function(t,e,i,n,s,r){var o=this[t+"_"+this.state];if(o){var h=arguments.length;switch(h){case 1:return o.call(this);case 2:return o.call(this,e);case 3:return o.call(this,e,i);case 4:return o.call(this,e,i,n);case 5:return o.call(this,e,i,n,s);case 6:return o.call(this,e,i,n,s,r)}for(var a=new Array(h-1),u=1;u<h;u++)a[u-1]=arguments[u];return o.apply(this,a)}}}]),r}(),Hn=(Object.assign(Jn.prototype,ct),["next","exit","enter","update","preupdate","postupdate"]),Kn=function(){l(e,Jn);var t=d(e);function e(){return y(this,e),t.apply(this,arguments)}return u(e,[{key:"shutdown",value:function(){this.stopUpdate(),this.stopPreUpdate(),this.stopPostUpdate(),this._scene=void 0,f(c(e.prototype),"shutdown",this).call(this)}},{key:"resetFromJSON",value:function(t){return f(c(e.prototype),"resetFromJSON",this).call(this,t),this._scene=g(t,"scene",void 0),this}},{key:"stateProperties",get:function(){return Hn}},{key:"update",value:function(t,e){this.runMethod("update",t,e)}},{key:"preupdate",value:function(t,e){this.runMethod("preupdate",t,e)}},{key:"postupdate",value:function(t,e){this.runMethod("postupdate",t,e)}},{key:"startUpdate",value:function(t){var e=(t=t||this._scene).sys.events;return qt(e,"update",this.update,this)||(this._scene=t,e.on("update",this.update,this)),this}},{key:"stopUpdate",value:function(){return this._scene&&this._scene.sys.events.off("update",this.update,this),this}},{key:"startPreUpdate",value:function(t){var e=(t=t||this._scene).sys.events;return qt(e,"preupdate",this.preupdate,this)||(this._scene=t,e.on("preupdate",this.preupdate,this)),this}},{key:"stopPreUpdate",value:function(){return this._scene&&this._scene.sys.events.off("preupdate",this.preupdate,this),this}},{key:"startPostUpdate",value:function(t){var e=(t=t||this._scene).sys.events;return qt(e,"postupdate",this.postupdate,this)||(this._scene=t,e.on("postupdate",this.postupdate,this)),this}},{key:"stopPostUpdate",value:function(){return this._scene&&this._scene.sys.events.off("postupdate",this.postupdate,this),this}}]),e}(),qn=Phaser.Utils.Objects.GetValue,$n=Phaser.Math.Distance.Between,Qn=function(){l(s,zn);var n=d(s);function s(t,e){y(this,s);var i=p(t=n.call(this,t,e));return t.setRecongizedStateObject(new Kn({states:{IDLE:{enter:function(){i.stop(),i.tapsCount=0,i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start(),i.tapsCount=0,i.emit("tappingstart",i,i.gameObject,i.lastPointer)}},RECOGNIZED:{enter:function(){i.start(),i.emit("tap",i,i.gameObject,i.lastPointer),i.emit("".concat(i.tapsCount,"tap"),i,i.gameObject,i.lastPointer)}}},init:function(){this.state=ts},eventEmitter:!1})),t}return u(s,[{key:"resetFromJSON",value:function(t){f(c(s.prototype),"resetFromJSON",this).call(this,t),this.setHoldTime(qn(t,"time",250)),this.setTapInterval(qn(t,"tapInterval",200)),this.setDragThreshold(qn(t,"threshold",9)),this.setTapOffset(qn(t,"tapOffset",10));var e=qn(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(qn(t,"maxTaps",void 0)),this.setMinTaps(qn(t,"minTaps",void 0))),this}},{key:"onDragStart",value:function(){switch(this.state){case ts:this.state=es;break;case es:var t=this.lastPointer;$n(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=is,this.state=es);break;case is:this.state=es}}},{key:"onDragEnd",value:function(){this.state===es&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps)&&this.tapsCount===this.maxTaps&&(this.state=is)}},{key:"onDrag",value:function(){this.state!==ts&&this.pointer.getDistance()>this.dragThreshold&&(this.state=ts)}},{key:"preUpdate",value:function(t,e){var i;this.isRunning&&this.enable&&this.state===es&&((i=this.lastPointer).isDown?t-i.downTime>this.holdTime&&(this.state=ts):t-i.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=is:this.state=ts))}},{key:"postUpdate",value:function(t,e){this.isRunning&&this.enable&&this.state===is&&(this.state=ts)}},{key:"isTapped",get:function(){return this.state===is}},{key:"setHoldTime",value:function(t){return this.holdTime=t,this}},{key:"setTapInterval",value:function(t){return this.tapInterval=t,this}},{key:"setDragThreshold",value:function(t){return this.dragThreshold=t,this}},{key:"setTapOffset",value:function(t){return this.tapOffset=t,this}},{key:"setMaxTaps",value:function(t){return this.maxTaps=t,this}},{key:"setMinTaps",value:function(t){return this.minTaps=t,this}},{key:"setTaps",value:function(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}}]),s}(),ts="IDLE",es="BEGIN",is="RECOGNIZED",ns=function(e){var i=this.board,t=i.worldXYToTileXY(e.worldX,e.worldY),n=t.x,s=t.y;i.contains(n,s)&&(i.emit("tiletap",e,t),i.emit("tile".concat(e.tapsCount,"tap"),e,t),A(function(t){i.emit("gameobjecttap",e,t),i.emit("gameobject".concat(e.tapsCount,"tap"),e,t)},function(t){t.emit("board.tap",e),t.emit("board.".concat(e.tapsCount,"tap"),e)},i,n,s,e))},ss=Phaser.Utils.Objects.GetValue,rs=function(){l(s,zn);var n=d(s);function s(t,e){y(this,s);var i=p(t=n.call(this,t,e));return t.setRecongizedStateObject(new Kn({states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start()},exit:function(){i.stop()}},RECOGNIZED:{enter:function(){i.emit("pressstart",i,i.gameObject,i.lastPointer)},exit:function(){i.emit("pressend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=os},eventEmitter:!1})),t}return u(s,[{key:"resetFromJSON",value:function(t){return f(c(s.prototype),"resetFromJSON",this).call(this,t),this.setDragThreshold(ss(t,"threshold",9)),this.setHoldTime(ss(t,"time",251)),this}},{key:"onDragStart",value:function(){this.state=hs,0===this.holdTime&&(this.state=as)}},{key:"onDragEnd",value:function(){this.state=os}},{key:"onDrag",value:function(){this.state!==os&&this.pointer.getDistance()>this.dragThreshold&&(this.state=os)}},{key:"preUpdate",value:function(t,e){this.isRunning&&this.enable&&this.state===hs&&t-this.pointer.downTime>=this.holdTime&&(this.state=as)}},{key:"isPressed",get:function(){return this.state===as}},{key:"setHoldTime",value:function(t){return this.holdTime=t,this}},{key:"setDragThreshold",value:function(t){return this.dragThreshold=t,this}}]),s}(),os="IDLE",hs="BEGIN",as="RECOGNIZED",us=function(t){var e=this.board,i=e.worldXYToTileXY(t.worldX,t.worldY),n=i.x,s=i.y;e.contains(n,s)&&(e.emit("tilepressstart",t,i),A("gameobjectpressstart","board.pressstart",e,n,s,t))},ls=function(t){var e=this.board,i=e.worldXYToTileXY(t.worldX,t.worldY),n=i.x,s=i.y;e.contains(n,s)&&(e.emit("tilepressend",t,i),A("gameobjectpressend","board.pressend",e,n,s,t))},cs=Phaser.Math.Distance.Between,ds=Phaser.Math.Angle.Between,S={getDt:function(){var t;return t=this.scene,tt(t).loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return cs(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return ds(e.x,e.y,t.x,t.y)}},fs={"up&down":0,"left&right":1,"4dir":2,"8dir":3},vs={},ys=Phaser.Utils.Objects.GetValue,ps=Phaser.Math.RadToDeg,gs=function(){l(s,zn);var n=d(s);function s(t,e){y(this,s);var i=p(t=n.call(this,t,e));return t.setRecongizedStateObject(new Kn({states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.validDrag=!1}},RECOGNIZED:{enter:function(){i.start(),i.updateDirectionStates(),i.emit("swipe",i,i.gameObject,i.lastPointer)},exit:function(){i.stop(),i.clearDirectionStates()}}},init:function(){this.state=bs},eventEmitter:!1})),t.clearDirectionStates(),t}return u(s,[{key:"resetFromJSON",value:function(t){return f(c(s.prototype),"resetFromJSON",this).call(this,t),this.setDragThreshold(ys(t,"threshold",10)),this.setVelocityThreshold(ys(t,"velocityThreshold",1e3)),this.setDirectionMode(ys(t,"dir","8dir")),this}},{key:"onDragStart",value:function(){this.state=Ts}},{key:"onDragEnd",value:function(){this.state=bs}},{key:"onDrag",value:function(){this.state===Ts&&(this.validDrag||(this.validDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.validDrag)&&this.dragVelocity>this.velocityThreshold&&(this.state=ms)}},{key:"postUpdate",value:function(t,e){this.isRunning&&this.enable&&this.state===ms&&(this.state=bs)}},{key:"isSwiped",get:function(){return this.state===ms}},{key:"dragVelocity",get:function(){var t;switch(this.dirMode){case 0:t=this.getVelocityY();break;case 1:t=this.getVelocityX();break;default:t=this.getVelocity()}return t}},{key:"setDragThreshold",value:function(t){return this.dragThreshold=t,this}},{key:"setVelocityThreshold",value:function(t){return this.velocityThreshold=t,this}},{key:"setDirectionMode",value:function(t){return this.dirMode=t="string"==typeof t?fs[t]:t,this}},{key:"updateDirectionStates",value:function(){var t=ps(this.getVelocityAngle()),e=this.dirMode,i=this;switch(void 0===i?i={}:!0===i&&(i=vs),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:90<t&&t<=270?i.left=!0:i.right=!0;break;case 2:45<t&&t<=135?i.down=!0:135<t&&t<=225?i.left=!0:225<t&&t<=315?i.up=!0:i.right=!0;break;case 3:22.5<t&&t<=67.5?(i.down=!0,i.right=!0):67.5<t&&t<=112.5?i.down=!0:112.5<t&&t<=157.5?(i.down=!0,i.left=!0):157.5<t&&t<=202.5?i.left=!0:202.5<t&&t<=247.5?(i.left=!0,i.up=!0):247.5<t&&t<=292.5?i.up=!0:(292.5<t&&t<=337.5&&(i.up=!0),i.right=!0)}return this}},{key:"clearDirectionStates",value:function(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}]),s}(),bs=(Object.assign(gs.prototype,S),"IDLE"),Ts="BEGIN",ms="RECOGNIZED",xs=function(t){var e=this.board,i=e.worldXYToTileXY(t.worldX,t.worldY),n=i.x,s=i.y;e.contains(n,s)&&(t.direction=e.angleSnapToDirection(i,t.getVelocityAngle()),e.emit("tileswipe",t,i),A("gameobjectswipe","board.swipe",e,n,s,t))},ks=function(){function s(t,e){y(this,s);var i=g(e,"enable",!0),e=g(e,"useTouchZone",!0),n=t.scene;this.board=t,this.touchZone=void 0,this._enable=!0,this.pointer=null,this.tilePosition={x:void 0,y:void 0},this.prevTilePosition={x:void 0,y:void 0},e?((e=new Bn(n)).on("pointerdown",Jt,this),e.on("pointerup",Ht,this),e.on("pointermove",Kt,this),this.touchZone=e):(n.input.on("pointerdown",Jt,this),n.input.on("pointerup",Ht,this),n.input.on("pointermove",Kt,this)),this.tap=function(){var t=this.touchZone||this.board.scene,t=new Qn(t);return t.on("tap",ns,this),t}.call(this),this.press=function(){var t=this.touchZone||this.board.scene,t=new rs(t);return t.on("pressstart",us,this).on("pressend",ls,this),t}.call(this),this.swipe=function(){var t=this.touchZone||this.board.scene,t=new gs(t);return t.on("swipe",xs,this),t}.call(this),t.once("destroy",this.onBoardDestroy,this),this.setEnable(i)}return u(s,[{key:"destroy",value:function(t){this.tap.destroy(t),this.press.destroy(t),this.swipe.destroy(t),this.touchZone?(this.touchZone.destroy(t),this.touchZone=void 0):(t=this.board.scene)&&(t.input.off("pointerdown",Jt,this),t.input.off("pointerup",Ht,this),t.input.off("pointermove",Kt,this)),this.board=void 0}},{key:"onBoardDestroy",value:function(t,e){this.destroy(e)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(t||(this.pointer=null),this._enable=t,this.touchZone&&(t?this.touchZone.setInteractive():this.touchZone.disableInteractive()),this.tap.setEnable(t),this.press.setEnable(t),this.swipe.setEnable(t))}},{key:"setEnable",value:function(t){return this.enable=t=void 0===t?!0:t,this}}]),s}(),ws=function(){l(e,_n);var t=d(e);function e(){return y(this,e),t.apply(this,arguments)}return u(e,[{key:"touchZone",get:function(){return this.input?this.input.touchZone:null}},{key:"getTouchZone",value:function(){return this.touchZone}}]),e}(),Cs=(Object.assign(ws.prototype,{setInteractive:function(t){return this.input?this.input.setEnable(!1!==t):this.input=new ks(this,t),this},forEachCullTileXY:function(t,e,i){var n=g(i=void 0===(i="number"==typeof i?{order:i}:i)?{}:i,"order",0),s=g(i,"camera",this.scene.cameras.main),r=g(i,"paddingX",1),i=g(i,"paddingY",1);return(Re=void 0===Re?new Y:Re).width=(s.width+2*r)/s.zoomX,Re.height=(s.height+2*i)/s.zoomY,Re.centerX=s.centerX+s.scrollX,Re.centerY=s.centerY+s.scrollY,this.forEachTileXYInShape(Re,t,e,{order:n,testMode:1}),this}}),function(t){return null==t||""===t||0===t.length}),Ys=(s.register("board",function(t){return new ws(this.scene,t)}),n(window,"RexPlugins.Board.Board",ws),s.register("hexagonGrid",function(t){return new Dn(t)}),s.register("quadGrid",function(t){return new Mi(t)}),Phaser.GameObjects.Polygon),Xs=function(){l(v,Ys);var f=d(v);function v(t,e,i,n,s,r,o){y(this,v);var h,a,u=$t(t),l=(t=u?(h=t).board:t).scene,c=(o=void 0===o?!0:o)?a=0:(a=e,i),d=t.getGridPoints(void 0,void 0,!0);return Ms(d),l=f.call(this,l,a,c,d,s,r),o?u?h.addChess(p(l),e,i,n):t.addChess(p(l),e,i,n,!0):et(p(l)),l}return u(v)}(),Ms=function(t){for(var e,i=1/0,n=1/0,s=0,r=t.length;s<r;s++)e=t[s],i=Math.min(i,e.x),n=Math.min(n,e.y);if(0!==i||0!==n)for(s=0,r=t.length;s<r;s++)(e=t[s]).x-=i,e.y-=n;return t},Ps=(s.register("shape",function(t,e,i,n,s,r,o){e=new Xs(t,e,i,n,s,r,o);return t.scene.add.existing(e),e}),n(window,"RexPlugins.Board.Shape",Xs),Phaser.Utils.Objects.GetValue),Ss=function(){l(s,In);var n=d(s);function s(t,e){y(this,s);var i=(t=n.call(this,t,e)).scene?"update":"step";return t.tickEventName=Ps(e,"tickEventName",i),t.isSceneTicker=!Ds(t.tickEventName),t}return u(s,[{key:"startTicking",value:function(){f(c(s.prototype),"startTicking",this).call(this),(this.isSceneTicker?this.scene.sys:this.game).events.on(this.tickEventName,this.update,this)}},{key:"stopTicking",value:function(){f(c(s.prototype),"stopTicking",this).call(this),this.isSceneTicker&&this.scene?this.scene.sys.events.off(this.tickEventName,this.update,this):this.game&&this.game.events.off(this.tickEventName,this.update,this)}}]),s}(),Ds=function(t){return"step"===t||"poststep"===t},Os={x:0,y:0,z:0},As={},Es={},_s=[],Rs={x:0,y:0},Bs=[],D={canMoveTo:function(t,e,i){var n=this.chessData.board;if(null==n)return!1;var s=this.chessData.tileXYZ,r=s.x,o=s.y,h=s.z;if(t!==r||e!==o){if(!n.contains(t,e))return!1;if(this.blockerTest&&n.hasBlocker(t,e))return!1;if(this.edgeBlockerTest,this.moveableTestCallback)if(void 0===i&&(i=this.chessData.getTileDirection(t,e)),Os.x=t,Os.y=e,Os.z=h,!(this.moveableTestScope?this.moveableTestCallback.call(this.moveableTestScope,s,Os,i,n):this.moveableTestCallback(s,Os,i,n)))return!1;if(this.occupiedTest&&!this.sneakMode){r=n.tileXYZToChess(t,e,h);if(r&&(this.emit("occupy",r,this.parent,this),n.contains(t,e,h)))return!1}}return!0},moveTo:function(t,e,i){var n,s,r,o,h,a,u=this.chessData.board;return null===u?this.lastMoveResult=!1:(n=(null!=t&&"number"!=typeof t&&(t=g(n=t,"x",void 0),e=g(n,"y",void 0),i=g(n,"direction",void 0)),this.chessData.tileXYZ),(void 0!==i&&null==t||null==e)&&(e=null!==(a=u.getNeighborTileXY(n,i,!0))?(t=a.x,a.y):t=null),null!=t&&null!=e&&(void 0===i&&(As.x=t,As.y=e,i=u.getNeighborTileDirection(n,As)),this.canMoveTo(t,e,i))?(this.destinationTileX=t,this.destinationTileY=e,this.destinationDirection=i,!u.wrapMode||null===i||(u.grid.getNeighborTileXY(n.x,n.y,i,Es),Es.x===t&&Es.y===e)?(h=u.tileXYToWorldXY(t,e,!0),this.moveAlongLine(void 0,void 0,h.x,h.y)):(a=(h=u.tileXYToWorldXY(Es.x,Es.y,!0)).x,s=h.y,r=(h=u.tileXYToWorldXY(n.x,n.y,!0)).x,o=h.y,this.moveAlongLine(void 0,void 0,(r+a)/2,(o+s)/2),i=u.getOppositeDirection(t,e,i),u.grid.getNeighborTileXY(t,e,i,Es),a=(h=u.tileXYToWorldXY(Es.x,Es.y,!0)).x,s=h.y,i=(h=u.tileXYToWorldXY(t,e,!0)).x,h=h.y,this.addMoveLine(r=(a+i)/2,o=(s+h)/2,i,h)),a=n.z,this.sneakMode&&(void 0===this.tileZSave?u.contains(t,e,a)&&(this.tileZSave=a,a=Qt(this,t,e,this.tileZSave)):u.contains(t,e,this.tileZSave)?a=Qt(this,t,e,this.tileZSave):(a=this.tileZSave,this.tileZSave=void 0)),u.moveChess(this.parent,t,e,a,!1),this.isRunning=!0,this.lastMoveResult=!0):this.lastMoveResult=!1),this},moveToward:function(t){return this.moveTo(void 0,void 0,t),this},moveToRandomNeighbor:function(){var t=this.chessData.board;if(null===t)this.lastMoveResult=!1;else{t=t.grid.allDirections;_s.length!==t.length&&te(t,_s),Nt(_s);for(var e=0,i=_s.length;e<i;e++)if(this.moveToward(_s[e]),this.lastMoveResult)return this}return this},moveAway:function(t,e,s){var i=this.chessData.board;if(null===i)this.lastMoveResult=!1;else{"number"!=typeof t&&(t=(r=t).x,e=r.y),Rs.x=t,Rs.y=e,void 0===s&&(s=!0);for(var n=this.chessData.tileXYZ,r=i.grid.allDirections,o=0,h=r.length+1;o<h;o++){var a=Bs[o];a||Bs.push(a={}),o<h-1?null===i.getNeighborTileXY(n,o,a)?(a.x=void 0,a.y=void 0,a.distance=void 0):a.distance=i.getDistance(a,Rs,!0):(a.direction=void 0,a.x=n.x,a.y=n.y,a.distance=i.getDistance(a,Rs,!0))}Bs.length=r.length+1;var u=this.destinationDirection;Bs.sort(function(t,e){var i=t.distance,n=e.distance;return void 0===i?1:void 0===n?-1:n<i?s?-1:1:i<n?s?1:-1:(i=t.direction,n=e.direction,i===u?1:n===u?-1:void 0===i?1:void 0===n?-1:0)});for(o=0,h=Bs.length;o<h;o++){if(null===(a=Bs[o]).distance)return this;if(this.moveTo(a),this.lastMoveResult)return this}}return this},moveCloser:function(t,e){return this.moveAway(t,e,!1),this}},Ns=Phaser.Utils.Objects.GetValue,Zs=Phaser.Math.Distance.Between,Ls=Phaser.Math.Linear,Is=Phaser.Math.Angle.Between,Fs=function(){l(n,Ss);var i=d(n);function n(t,e){return y(this,n),(t=i.call(this,t,e)).resetFromJSON(e),t.boot(),t}return u(n,[{key:"resetFromJSON",value:function(t){return this.isRunning=Ns(t,"isRunning",!1),this.setEnable(Ns(t,"enable",!0)),this.timeScale=Ns(t,"timeScale",1),this.setSpeed(Ns(t,"speed",400)),this.setRotateToTarget(Ns(t,"rotateToTarget",!1)),this.targetX=Ns(t,"targetX",0),this.targetY=Ns(t,"targetY",0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,enable:this.enable,timeScale:this.timeScale,speed:this.speed,rotateToTarget:this.rotateToTarget,targetX:this.targetX,targetY:this.targetY,tickingMode:this.tickingMode}}},{key:"setEnable",value:function(t){return this.enable=t=null==t?!0:t,this}},{key:"setSpeed",value:function(t){return this.speed=t,this}},{key:"setRotateToTarget",value:function(t){return this.rotateToTarget=t,this}},{key:"moveTo",value:function(t,e){var i;return"number"!=typeof t&&(t=(i=t).x,e=i.y),this.targetX=t,this.targetY=e,f(c(n.prototype),"start",this).call(this),this.emit("start",this.parent,this),this}},{key:"moveFrom",value:function(t,e){"number"!=typeof t&&(t=(i=t).x,e=i.y);var i=this.parent,n=i.x,s=i.y;return i.setPosition(t,e),this.moveTo(n,s),this}},{key:"moveToward",value:function(t,e){var i=this.parent,n=i.x+Math.cos(t)*e,i=i.y+Math.sin(t)*e;return this.moveTo(n,i),this}},{key:"update",value:function(t,e){var i,n,s,r,o,h,a;return this.isRunning&&this.enable&&(i=this.parent).active&&(n=i.x,s=i.y,r=this.targetX,o=this.targetY,n===r&&s===o?this.complete():0!==this.speed&&0!==e&&0!==this.timeScale&&(e=e*this.timeScale/1e3,a=(e=this.speed*e)<(a=Zs(n,s,r,o))?(h=Ls(n,r,e=e/a),Ls(s,o,e)):(h=r,o),i.setPosition(h,a),this.rotateToTarget)&&(i.rotation=Is(n,s,h,a))),this}}]),n}(),js=function(){l(s,Ss);var n=d(s);function s(t,e){var i;return y(this,s),(i=n.call(this,t,e)).chessData=et(t),i.scene=t.scene,i.moveToTask=new Fs(t,{tickingMode:0}),i.resetFromJSON(e),i.boot(),i}return u(s,[{key:"resetFromJSON",value:function(t){return this.isRunning=g(t,"isRunning",!1),this.setEnable(g(t,"enable",!0)),this.timeScale=g(t,"timeScale",1),this.setSpeed(g(t,"speed",400)),this.setRotateToTarget(g(t,"rotateToTarget",!1)),this.setOccupiedTest(g(t,"occupiedTest",!1)),this.setBlockerTest(g(t,"blockerTest",!1)),this.setEdgeBlockerTest(g(t,"edgeBlockerTest",!1)),this.setMoveableTestCallback(g(t,"moveableTest",void 0),g(t,"moveableTestScope",void 0)),this.setSneakEnable(g(t,"sneak",!1)),this.destinationTileX=g(t,"destinationTileX",null),this.destinationTileY=g(t,"destinationTileY",null),this.destinationDirection=g(t,"destinationDirection",null),this.lastMoveResult=g(t,"lastMoveResult",void 0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,enable:this.enable,timeScale:this.timeScale,speed:this.speed,occupiedTest:this.occupiedTest,blockerTest:this.blockerTest,edgeBlockerTest:this.edgeBlockerTest,moveableTest:this.moveableTestCallback,moveableTestScope:this.moveableTestScope,rotateToTarget:this.rotateToTarget,destinationTileX:this.destinationTileX,destinationTileY:this.destinationTileY,destinationDirection:this.destinationDirection,lastMoveResult:this.lastMoveResult,tickingMode:this.tickingMode}}},{key:"shutdown",value:function(t){this.moveToTask.shutdown(t),f(c(s.prototype),"shutdown",this).call(this,t)}},{key:"enable",get:function(){return this.moveToTask.enable},set:function(t){this.moveToTask.setEnable(t)}},{key:"setEnable",value:function(t){return this.enable=t=null==t?!0:t,this}},{key:"timeScale",get:function(){return this.moveToTask.timeScale},set:function(t){this.moveToTask.timeScale=t}},{key:"speed",get:function(){return this.moveToTask.speed},set:function(t){this.moveToTask.setSpeed(t)}},{key:"setSpeed",value:function(t){return this.speed=t,this}},{key:"rotateToTarget",get:function(){return this.moveToTask.rotateToTarget},set:function(t){this.moveToTask.setRotateToTarget(t)}},{key:"setRotateToTarget",value:function(t){return this.rotateToTarget=t=void 0===t?!0:t,this}},{key:"setOccupiedTest",value:function(t){return this.occupiedTest=t=void 0===t?!0:t,this}},{key:"setBlockerTest",value:function(t){return this.blockerTest=t=void 0===t?!0:t,this}},{key:"setEdgeBlockerTest",value:function(t){return this.edgeBlockerTest=t=void 0===t?!0:t,this}},{key:"setMoveableTestCallback",value:function(t,e){return this.moveableTestCallback=t,this.moveableTestScope=e,this}},{key:"setSneakEnable",value:function(t){return this.sneakMode=t=void 0===t?!0:t,this.tileZSave=void 0,this}},{key:"moveAlongLine",value:function(t,e,i,n){return void 0!==t&&(this.parent.x=t),void 0!==e&&(this.parent.y=e),this.moveToTask.moveTo(i,n),this}},{key:"addMoveLine",value:function(t,e,i,n){return this.moveToTask.hasOwnProperty("nextlines")||(this.moveToTask.nextlines=[]),this.moveToTask.nextlines.push([t,e,i,n]),this}},{key:"moveNextLine",value:function(){var t=this.moveToTask.nextlines;return!(!t||0===t.length||(this.moveAlongLine.apply(this,t[0]),t.length=0))}},{key:"update",value:function(t,e){var i;return this.isRunning&&this.enable&&((i=this.moveToTask).update(t,e),i.isRunning||this.moveNextLine()||this.complete()),this}}]),s}(),zs=(Object.assign(js.prototype,D),{x:0,y:0,z:0}),E={x:0,y:0,z:0},Us={},Gs={},Ws=[],Vs=function(){l(s,Ss);var n=d(s);function s(t,e){var i;return y(this,s),(i=n.call(this,t,e)).moveToTask=new Fs(t,{tickingMode:0}),i.resetFromJSON(e),i.boot(),i}return u(s,[{key:"resetFromJSON",value:function(t){return this.isRunning=g(t,"isRunning",!1),this.setEnable(g(t,"enable",!0)),this.timeScale=g(t,"timeScale",1),this.setSpeed(g(t,"speed",400)),this.destinationTileX=g(t,"destinationTileX",null),this.destinationTileY=g(t,"destinationTileY",null),this.destinationDirection=g(t,"destinationDirection",null),this.lastMoveResult=g(t,"lastMoveResult",void 0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,enable:this.enable,timeScale:this.timeScale,speed:this.speed,moveableTest:this.moveableTestCallback,moveableTestScope:this.moveableTestScope,destinationTileX:this.destinationTileX,destinationTileY:this.destinationTileY,destinationDirection:this.destinationDirection,lastMoveResult:this.lastMoveResult,tickingMode:this.tickingMode}}},{key:"shutdown",value:function(t){this.isShutdown||(this.moveToTask.shutdown(t),f(c(s.prototype),"shutdown",this).call(this,t))}},{key:"enable",get:function(){return this.moveToTask.enable},set:function(t){this.moveToTask.setEnable(t)}},{key:"setEnable",value:function(t){return this.enable=t=null==t?!0:t,this}},{key:"timeScale",get:function(){return this.moveToTask.timeScale},set:function(t){this.moveToTask.timeScale=t}},{key:"speed",get:function(){return this.moveToTask.speed},set:function(t){this.moveToTask.setSpeed(t)}},{key:"setSpeed",value:function(t){return this.speed=t,this}},{key:"moveAlongLine",value:function(t,e,i,n){return void 0!==t&&(this.parent.x=t),void 0!==e&&(this.parent.y=e),this.moveToTask.moveTo(i,n),this}},{key:"update",value:function(t,e){var i;return this.isRunning&&this.enable&&((i=this.moveToTask).update(t,e),i.isRunning||this.complete()),this}}]),s}(),Js=(Object.assign(Vs.prototype,{canMoveTo:function(t,e,i){var n=this.parent,s=n.mainBoard;if(null==s)return!1;if(zs.x=n.tileX,zs.y=n.tileY,E.x=t,E.y=e,E.x!==zs.x||E.y!==zs.y){if(n.pullOutFromMainBoard(),!n.canPutOnMainBoard(s,E.x,E.y))return n.putBack(),!1;if(this.moveableTestCallback)if(void 0===i&&(i=s.getNeighborTileDirection(zs,E)),!(this.moveableTestScope?this.moveableTestCallback.call(this.moveableTestScope,zs,E,i,s):this.moveableTestCallback(zs,E,i,s)))return n.putBack(),!1;n.putBack()}return!0},moveTo:function(t,e,i){var n,s,r=this.parent,o=r.mainBoard;return null==o?this.lastMoveResult=!1:(null!=t&&"number"!=typeof t&&(t=g(n=t,"x",void 0),e=g(n,"y",void 0),i=g(n,"direction",void 0)),Us.x=r.tileX,Us.y=r.tileY,(void 0!==i&&null==t||null==e)&&(e=null!==(s=o.getNeighborTileXY(Us,i,!0))?(t=s.x,s.y):t=null),null!=t&&null!=e&&(void 0===i&&(Gs.x=t,Gs.y=e,i=board.getNeighborTileDirection(Us,Gs)),this.canMoveTo(t,e,i))?(this.destinationTileX=t,this.destinationTileY=e,this.destinationDirection=i,s=o.tileXYToWorldXY(t,e,!0),this.moveToTask.moveTo(s.x,s.y),r.putOnMainBoard(o,t,e,!1),this.isRunning=!0,this.lastMoveResult=!0):this.lastMoveResult=!1),this},moveToward:function(t){return this.moveTo(void 0,void 0,t),this},moveToRandomNeighbor:function(){var t=this.parent.mainBoard;if(null==t)this.lastMoveResult=!1;else{t=t.grid.allDirections;Ws.length!==t.length&&te(t,Ws),Nt(Ws);for(var e=0,i=Ws.length;e<i;e++)if(this.moveToward(Ws[e]),this.lastMoveResult)return this}return this}}),s.register("moveTo",function(t,e){return new($t(t)?Vs:js)(t,e)}),n(window,"RexPlugins.Board.MoveTo",js),n(window,"RexPlugins.Board.MiniBoardMoveTo",Vs),{tileXY:[],direction:void 0,pattern:void 0}),Hs=function(){function t(){y(this,t),this.data=[],this.visited={}}return u(t,[{key:"push",value:function(t,e){if(m(t))for(var i=t,n=0,s=i.length;n<s;n++)this.push(i[n]);else{b(t)&&(t=(r=t).x,e=r.y);var r="".concat(t,",").concat(e);this.visited.hasOwnProperty(r)||(this.data.push({x:t,y:e}),this.visited[r]=!0)}return this}},{key:"pop",value:function(){return this.data.pop()}},{key:"length",get:function(){return this.data.length}},{key:"clear",value:function(){return hi(this.data),hi(this.visited),this}}]),t}(),M={match:function(t,e,i,n){for(var s,r,o,h=this.board,a=h.grid.halfDirections,u=this.dirMask,l=h.width,c=h.height,d=0,f=a.length;d<f;d++)if(!1!==u[s=a[d]])for(var v=0;v<c;v++){for(var y=0;y<l;y++)if(!1!==(r=this.matchAtDir(t,y,v,s))){if(e&&(o=i?e.call(i,r,h):e(r,h)),n)return r;if(o)break}if(o)break}return this},matchAtDir:function(t,e,i,n){var s,r="number"==typeof t;r?(s=t,t=null):s=t.length;for(var o,h,a=this.wildcard,u=this.board,l=Js.tileXY,c=l.length=0;c<s;c++){if(void 0===h)h={x:e,y:i};else if(null===(h=u.getNeighborTileXY(h,n,h)))return!1;if(null==(o=this.getSymbol(h.x,h.y)))return!1;if(o!==a)if(r){if(null===t)t=o;else if(t!==o)return!1}else if(t[c]!==o)return!1;l.push({x:h.x,y:h.y})}return Js.direction=n,Js.pattern=t,Js},group:function(t,e,i){void 0===i&&(i=[]);var n,s,r=this.board,o=this.wildcard,h=this.getSymbol(t,e);if(null!=h&&h!==o){for((Be=void 0===Be?new Hs:Be).push(t,e);Be.length;)n=Be.pop(),(s=this.getSymbol(n.x,n.y))!==h&&s!==o||(i.push(n),Be.push(r.getNeighborTileXY(n)));Be.clear()}return i}},Ks=function(){function e(t){y(this,e),this.symbols=[],this.dirMask={},this.resetFromJSON(t),this.boot()}return u(e,[{key:"resetFromJSON",value:function(t){this.setBoard(g(t,"board",void 0)),this.setWildcard(g(t,"wildcard",void 0));t=g(t,"dirMask",void 0);return void 0!==t&&this.setDirMask(t),this}},{key:"boot",value:function(){}},{key:"shutdown",value:function(){return this.board=void 0,this.symbols=void 0,this.dirMask=void 0,this}},{key:"destroy",value:function(){return this.shutdown(),this}},{key:"setBoard",value:function(t){return(this.board=t)&&this.clearSymbols(),this}},{key:"setDirMask",value:function(t,e){if(b(t)){var i=t;for(t in i)this.dirMask[t]=i[t]}else this.dirMask[t]=e;return this}},{key:"setDirectionMode",value:function(t){return this.board.grid.setDirectionMode(t),this}},{key:"clearSymbols",value:function(){return this.refreshSymbols(null),this}},{key:"setSymbol",value:function(t,e,i){return this.board.contains(t,e)&&(this.symbols[this.tileXYToKey(t,e)]=i),this}},{key:"getSymbol",value:function(t,e){return this.symbols[this.tileXYToKey(t,e)]}},{key:"forEach",value:function(t,e){for(var i,n,s=this.board,r=0,o=this.symbols.length;r<o&&(n=this.symbols[r],i=this.keyToTileXY(r),!(e?t.call(e,i,n,s):t(i,n,s)));r++);return this}},{key:"refreshSymbols",value:function(t,e){var i,n=this.board,s=n.width,r=n.height;if(this.symbols.length=s*r,(s=t)&&"function"==typeof s)for(var o=0,h=this.symbols.length;o<h;o++)i=this.keyToTileXY(o,!0),a=e?t.call(e,i,n):t(i,n),this.symbols[o]=a;else for(var a=t,o=0,h=this.symbols.length;o<h;o++)this.symbols[o]=a;return this}},{key:"setWildcard",value:function(t){return this.wildcard=t,this}},{key:"tileXYToKey",value:function(t,e){return t+e*this.board.width}},{key:"keyToTileXY",value:function(t,e){void 0===e?e={}:!0===e&&(e=qs);var i=this.board.width;return e.x=t%i,e.y=Math.floor(t/i),e}},{key:"anyMatch",value:function(t){return this.match(t,null,null,!0)}}]),e}(),qs={x:0,y:0},P=(Object.assign(Ks.prototype,M),s.register("match",function(t){return new Ks(t)}),n(window,"RexPlugins.Board.Match",Ks),function(){function t(){y(this,t),this.items=[]}return u(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}()),$s=function(){function t(){y(this,t),this.preNodes=[],this.manager=void 0}return u(t,[{key:"reset",value:function(t){this.manager=t,this.sn=void 0,this.key=void 0,this.x=void 0,this.y=void 0,this.isTileXYZ=!0,this._px=void 0,this._py=void 0,this.cost=void 0,this.f=0,this.g=0,this.h=0,this.closerH=0,this.visited=!1,this.closed=!1,this.preNodes.length=0}},{key:"destroy",value:function(){this.preNodes.length=0,this.manager=void 0}},{key:"heuristic",value:function(t,e,i){var n;return null===e?0:(n=this.board.getDistance(t,this,!0)*this.pathFinder.weight,1===e&&void 0!==i?(t=t.angleTo(i)-this.angleTo(i),n+Math.abs(t)):2===e?n+Math.random():n)}},{key:"getNeighborNodes",value:function(){var t=this.board.getNeighborTileXY(this);this.pathFinder.shuffleNeighbors&&Nt(t);for(var e,i=[],n=0,s=t.length;n<s;n++)e=this.manager.getNode(t[n],!0),i.push(e);return i}},{key:"getCost",value:function(t){return this.pathFinder.cacheCost&&void 0!==this.cost||(this.cost=this.pathFinder.getCost(this,t)),this.cost}},{key:"angleTo",value:function(t){return st(this.worldX,this.wroldY,t.worldX,t.wroldY)}},{key:"pathFinder",get:function(){return this.manager.pathFinder}},{key:"board",get:function(){return this.manager.pathFinder.board}},{key:"worldX",get:function(){return void 0===this._px&&(this._px=this.board.tileXYToWroldX(this.x,this.y)),this._px}},{key:"wroldY",get:function(){return void 0===this._py&&(this._py=this.board.tileXYToWroldY(this.x,this.y)),this._py}},{key:"pathCost",get:function(){return this.g}}]),t}(),Qs=new P,tr=function(){function e(t){y(this,e),this.sn=0,this.pool=Qs,this.nodes={},this.pathFinder=t,this.closestNode=null}return u(e,[{key:"destroy",value:function(){return this.freeAllNodes(),this.pathFinder=null,this.pool=void 0,this}},{key:"getNode",value:function(t,e,i){var n;switch(a(t)){case"number":n=nt(t,e);break;case"string":n=t,i=e;break;default:var s=t;i=e,t=s.x,e=s.y,n=nt(t,e)}if(void 0===i&&(i=!1),this.sn++,!this.nodes.hasOwnProperty(n)){if(!i)return null;var r=this.pool.pop();(r=null===r?new $s:r).reset(this),r.sn=this.sn,r.key=n,r.x=t,r.y=e,this.nodes[n]=r}return this.nodes[n]}},{key:"freeAllNodes",value:function(){this.closestNode=null;var t,e,i=this.nodes,n=this.pool;for(e in i)(t=i[e]).destroy(),n.push(t),delete i[e];return this.sn=0,this}},{key:"getAllNodes",value:function(){return this.nodes}}]),e}(),t=function(){function e(t){y(this,e),this.content=[],this.scoreFunction=t}return u(e,[{key:"clear",value:function(){this.content.length=0}},{key:"push",value:function(t){this.content.push(t),this.sinkDown(this.content.length-1)}},{key:"pop",value:function(){var t=this.content[0],e=this.content.pop();return 0<this.content.length&&(this.content[0]=e,this.bubbleUp(0)),t}},{key:"remove",value:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}},{key:"size",value:function(){return this.content.length}},{key:"rescoreElement",value:function(t){this.sinkDown(this.content.indexOf(t))}},{key:"sinkDown",value:function(t){for(var e=this.content[t];0<t;){var i=(t+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}}},{key:"bubbleUp",value:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var s,r=t+1<<1,o=r-1,h=null;if(o<e&&(s=this.content[o],(s=this.scoreFunction(s))<n)&&(h=o),null===(h=r<e&&(o=this.content[r],this.scoreFunction(o)<(null===h?n:s))?r:h))break;this.content[t]=this.content[h],this.content[h]=i,t=h}}}]),e}(),_={AREA_MODE:16,PATH_MODE:0,random:0,diagonal:1,straight:2,line:3,"A*":10,"A*-random":11,"A*-line":12,BLOCKER:null,INFINITY:void 0},er=_.PATH_MODE,ir=_["A*"],nr=_["A*-line"],sr=_["A*-random"],rr=_.BLOCKER,or=_.INFINITY,hr=new t(function(t){return t.f}),ar=_.BLOCKER,ur=_.AREA_MODE,lr=_.INFINITY,cr=_.random,dr=_.diagonal,fr=_.straight,vr=_.line,yr=_["A*"],pr=_["A*-line"],gr=_["A*-random"],br=_.PATH_MODE,Tr=_.INFINITY,ct={aStarSearch:function(t,e,i,n){void 0===this.nodeManager&&(this.nodeManager=new tr(this));var s,r=this.nodeManager,o=(r.freeAllNodes(),n===er),n=this.pathMode===ir||this.pathMode===nr||this.pathMode===sr,h=o&&!n,a=o&&n?this.pathMode==ir?0:this.pathMode==nr?1:this.pathMode==sr?2:null:null,u=null!==e?r.getNode(e.x,e.y,!0):null,l=r.getNode(t.x,t.y,!0);for(l.h=l.heuristic(u,a),o&&((s=l).closerH=s.h||s.heuristic(u,0)),hr.push(l);0<hr.size();){var c=hr.pop();if(o&&c===u){s=u;break}c.closed=!0;for(var d,f=c.getNeighborNodes(),v=0,y=f.length;v<y;++v){var p,g=(d=f[v]).getCost(c);d.closed||g===rr||(g=c.g+g,p=d.visited,i!=or&&i<g)||(!p||g<d.g?(d.visited=!0,d.preNodes.length=0,d.preNodes.push(c),d.h=d.h||d.heuristic(u,a,l),d.g=g,d.f=d.g+d.h,o&&(d.closerH=d.h||d.heuristic(u,0),d.closerH<s.closerH||d.closerH===s.closerH&&d.g<s.g)&&(s=d),p?hr.rescoreElement(d):hr.push(d)):h&&g==d.g&&d.preNodes.push(c))}}return r.closestNode=o?s:null,hr.clear(),this},getCost:function(t,e){return this.occupiedTest&&this.board.contains(t.x,t.y,this.chessData.tileXYZ.z)||this.blockerTest&&this.board.hasBlocker(t.x,t.y)?ar:(this.edgeBlockerTest,"number"==typeof this.costCallback?this.costCallback:void 0===(t=this.costCallbackScope?this.costCallback.call(this.costCallbackScope,t,e,this):this.costCallback(t,e,this))?ar:t)},findArea:function(t,e){if(void 0===e&&(e=[]),null!==this.board&&!(t!==lr&&t<=0)){var i,n,s=this.chessData.tileXYZ,r=s.x,o=s.y,h=(this.aStarSearch(s,null,t,ur),this.nodeManager.getAllNodes()),a=[];for(n in h)(i=h[n]).x===r&&i.y===o||i.closed&&a.push(i);a.sort(function(t,e){t=t.sn,e=e.sn;return e<t?1:t<e?-1:0});for(var u=0,l=a.length;u<l;u++)e.push({x:(i=a[u]).x,y:i.y,cost:i.g})}return e},getPath:function(t,e){if(void 0===e&&(e=[]),void 0!==this.board){var i=this.nodeManager;if(void 0!==i){var n=i.getNode(this.chessData.tileXYZ,!1),i=i.getNode(t,!1);if(null!==n&&null!==i)for(var s,r=function(t,e,i){for(var n,s,r,o,h=t.board,a=e,u=[];0<a.preNodes.length;)switch(u.push(a),o=a.preNodes.length,i){case yr:case pr:case gr:a=d=a.preNodes[0];break;case cr:a=d=1===o?a.preNodes[0]:a.preNodes[He(0,o-1)];break;case dr:for(var l=0;l<o;l++)if(d=a.preNodes[l],(s=h.getNeighborTileDirection(a,d))!==n){n=s;break}a=d;break;case fr:for(l=0;l<o&&(d=a.preNodes[l],(s=h.getNeighborTileDirection(a,d))!==n);l++);n=s,a=d;break;case vr:if(void 0===r&&(r=e.angleTo(t)),1===o)a=d=a.preNodes[0],r=e.angleTo(a);else{for(var c,d=a.preNodes[0],f=Math.abs(e.angleTo(d)-r),l=1;l<o;l++)c=a.preNodes[l],Math.abs(e.angleTo(c)-r)<f&&(d=c);a=d}}return u.reverse()}(n,i,this.pathMode),o=0,h=r.length;o<h;o++)s=r[o],e.push({x:s.x,y:s.y,cost:s.g})}}return e},findPath:function(t,e,i,n){var s;return void 0===i&&(i=!0),void 0===n&&(n=[]),null===this.board||e!==Tr&&e<=0||(s=this.chessData.tileXYZ,this.aStarSearch(s,t,e,br),s=this.nodeManager,null===(e=i?s.closestNode:s.getNode(t)))?n:this.getPath(e,n)},tileXYToCost:function(t,e,i){return void 0===this.nodeManager||null===(t=this.nodeManager.getNode(t,e))?null:(i=void 0===i?!0:i)?t.g:t.cost}},mr=_.BLOCKER,xr=_.INFINITY,kr=function(){l(s,yt);var n=d(s);function s(t,e){var i;return y(this,s),b(t)&&(e=t,t=void 0),(i=n.call(this,t,{eventEmitter:!1})).setChess(t),i.nodeManager=void 0,i.resetFromJSON(e),i}return u(s,[{key:"resetFromJSON",value:function(t){var e=g(t,"costCallback",void 0),i=g(t,"costCallbackScope",void 0);return void 0===e&&(e=g(t,"cost",1)),this.setOccupiedTest(g(t,"occupiedTest",!1)),this.setBlockerTest(g(t,"blockerTest",!1)),this.setEdgeBlockerTest(g(t,"edgeBlockerTest",!1)),this.setCostFunction(e,i),this.setPathMode(g(t,"pathMode",0)),this.setCacheCostMode(g(t,"cacheCost",!0)),this.setWeight(g(t,"weight",10)),this.setShuffleNeighborsMode(g(t,"shuffleNeighbors",!1)),this}},{key:"shutdown",value:function(t){this.isShutdown||(void 0!==this.nodeManager&&this.nodeManager.destroy(),this.chessData=void 0,f(c(s.prototype),"shutdown",this).call(this,t))}},{key:"gameObject",get:function(){return this.parent}},{key:"setChess",value:function(t){return t?(this.chessData=et(t),this.parent!==t&&(this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.setParent(t),this.parent)&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)):(this.setParent(),this.chessData=void 0),this}},{key:"setCostFunction",value:function(t,e){return this.costCallback=t,this.costCallbackScope=e,this}},{key:"setPathMode",value:function(t){return this.pathMode=t="string"==typeof t?_[t]:t,this}},{key:"setCacheCostMode",value:function(t){return this.cacheCost=t=void 0===t?!0:t,this}},{key:"setOccupiedTest",value:function(t){return this.occupiedTest=t=void 0===t?!0:t,this}},{key:"setBlockerTest",value:function(t){return this.blockerTest=t=void 0===t?!0:t,this}},{key:"setEdgeBlockerTest",value:function(t){return this.edgeBlockerTest=t=void 0===t?!0:t,this}},{key:"setWeight",value:function(t){return this.weight=t,this}},{key:"setShuffleNeighborsMode",value:function(t){return this.shuffleNeighbors=t=void 0===t?!0:t,this}},{key:"BLOCKER",get:function(){return mr}},{key:"INFINITY",get:function(){return xr}},{key:"board",get:function(){return this.chessData.board}}]),s}(),S=(Object.assign(kr.prototype,ct),s.register("pathFinder",function(t,e){return new kr(t,e)}),n(window,"RexPlugins.Board.PathFinder",kr),{BLOCKER:null,INFINITY:void 0}),wr=S.BLOCKER,Cr=S.INFINITY,Yr=S.INFINITY,Xr=[],D={preTest:function(t,e){if(this.occupiedTest||this.blockerTest||this.edgeBlockerTest)for(var i,n=this.chessData.tileXYZ.z,s=1,r=t.length;s<r;s++){if(i=t[s],this.occupiedTest&&this.board.contains(i.x,i.y,n))return!1;if(this.blockerTest&&this.board.hasBlocker(i.x,i.y))return!1;this.edgeBlockerTest}return!this.preTestCallback||(this.preTestCallbackScope?this.preTestCallback.call(this.preTestCallbackScope,t,e,this):this.preTestCallback(t,e,this))},getCost:function(t,e){return"number"==typeof this.costCallback?this.costCallback:this.costCallbackScope?this.costCallback.call(this.costCallbackScope,t,this,e):this.costCallback(t,this,e)},isInCone:function(t){var e,i;return void 0===this.cone||(e=this.board,i=this.chessData.tileXYZ,0===this.coneMode?e.isDirectionInCone(i,t,this.face,this.cone):e.isAngleInCone(i,t,this.faceAngle,this.coneRad))},isPathVisible:function(t,e){if(!1===this.preTest(t,e))return!1;if(void 0!==this.costCallback)for(var i,n=this.chessData.tileXYZ,s=!1,r=1,o=t.length;r<o;r++)if(i=t[r],!je(n,i)){if(s)return!1;if((i=this.getCost(i,t))===wr)s=!0;else if(e!==Cr&&(e-=i)<0)return!1}return!0},isInLOS:function(t,e,i){if(e!==Yr&&e<=0)return!1;var n=this.board,t=n.chessToTileXYZ(t);if(!this.isInCone(t))return!1;void 0===i&&(i=this.chessData.tileXYZ),this.debugLog&&console.log("Visible test from ("+i.x+","+i.y+") to ("+t.x+","+t.y+")"),w||(w=[],Ne=[]);var s,i=n.tileXYToWorldXY(i.x,i.y,!0),r=i.x,o=i.y,t=(i=n.tileXYToWorldXY(t.x,t.y,!0)).x,i=i.y,h=st(r,o,t,i);if(h+=Math.PI/2,a=.001*Math.cos(h),u=.001*Math.sin(h),n.lineToTileXYArray(r+a,o+u,t+a,i+u,w),this.debugLog&&console.log("Line 0: "+JSON.stringify(w)),s=this.isPathVisible(w,e))return w.length=0,ee(this.debugGraphics,this.debugVisibleLineColor,r,o,t,i),!0;h+=Math.PI;var a=.001*Math.cos(h),u=.001*Math.sin(h);return n.lineToTileXYArray(r+a,o+u,t+a,i+u,Ne),this.debugLog&&console.log("Line 1: "+JSON.stringify(Ne)),function(t,e){if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(!je(t[i],e[i]))return!1;return!0}(w,Ne)||(s=this.isPathVisible(Ne,e)),w.length=0,Ne.length=0,ee(this.debugGraphics,s?this.debugVisibleLineColor:this.debugInvisibleLineColor,r,o,t,i),s},LOS:function(t,e,i,n){var s;if(m(t)){b(e)?(n=i,i=e,e=void 0):m(e)&&(n=e,i=e=void 0),m(i)&&(n=i,i=void 0),void 0===n&&(n=[]);for(var r=0,o=t.length;r<o;r++)s=t[r],this.isInLOS(s,e,i)&&n.push(s);return n}return this.isInLOS(s=t,e,i)},findFOV:function(t,e,i){b(t)?(i=e,e=t,t=void 0):m(t)&&(i=t,t=e=void 0),m(e)&&(i=e,e=void 0),void 0===i&&(i=[]);for(var n,s,r,o=this.board,h=this.chessData.tileXYZ,a=1;;){r=s=!1,o.ringToTileXYArray(h,a,Xr);for(var u=0,l=Xr.length;u<l;u++)n=Xr[u],o.contains(n.x,n.y)&&(r=!0,this.isInLOS(n,t,e))&&(s=!0,i.push(n));if(a++,Xr.length=0,this.perspectiveEnable||s){if(!r)break}else if(!s)break}return i}},Mr=S.BLOCKER,Pr=S.INFINITY,Sr=function(){l(s,yt);var n=d(s);function s(t,e){var i;return y(this,s),b(t)&&(e=t,t=void 0),(i=n.call(this,t,{eventEmitter:!1})).setChess(t),i.resetFromJSON(e),i}return u(s,[{key:"resetFromJSON",value:function(t){var e=g(t,"occupiedTest",!1),i=g(t,"blockerTest",!1),n=g(t,"edgeBlockerTest",!1),s=g(t,"preTestCallback",void 0),r=g(t,"preTestCallbackScope",void 0),o=g(t,"costCallback",void 0),h=g(t,"costCallbackScope",void 0);return void 0===o&&(o=g(t,"cost",void 0)),this.setFace(g(t,"face",0)),this.setConeMode(g(t,"coneMode",0)),this.setCone(g(t,"cone",void 0)),this.setOccupiedTest(e),this.setBlockerTest(i),this.setEdgeBlockerTest(n),this.setPreTestFunction(s,r),this.setCostFunction(o,h),this.setPerspectiveEnable(g(t,"perspective",!1)),this.setDebugGraphics(g(t,"debug.graphics",void 0)),this.setDebugLineColor(g(t,"debug.visibleLineColor",65280),g(t,"debug.invisibleLineColor",16711680)),this.setDebugLog(g(t,"debug.log",!1)),this}},{key:"shutdown",value:function(t){this.isShutdown||(this.debugGraphics=void 0,this.chessData=void 0,f(c(s.prototype),"shutdown",this).call(this,t))}},{key:"setChess",value:function(t){return t?(this.chessData=et(t),this.parent!==t&&(this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.setParent(t),this.parent)&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)):(this.setParent(),this.chessData=void 0),this}},{key:"face",get:function(){return this._face},set:function(t){this.chessData?(t=this.board.grid.directionNormalize(t),this._face=t,0!==this.coneMode&&(t=this.board.angleToward(this.chessData.tileXYZ,t),this.faceAngle=rt(t))):void 0===this._face&&(this._face=0)}},{key:"setFace",value:function(t){return this.face=t,this}},{key:"cone",get:function(){return this._cone},set:function(t){void 0!==(this._cone=t)&&0!==this.coneMode&&(this.coneRad=Yn(t))}},{key:"setConeMode",value:function(t){return"string"==typeof t&&(t=Dr[t]),this.coneMode=t,this}},{key:"setCone",value:function(t){return this.cone=t,this}},{key:"setOccupiedTest",value:function(t){return this.occupiedTest=t=void 0===t?!0:t,this}},{key:"setBlockerTest",value:function(t){return this.blockerTest=t=void 0===t?!0:t,this}},{key:"setEdgeBlockerTest",value:function(t){return this.edgeBlockerTest=t=void 0===t?!0:t,this}},{key:"setCostFunction",value:function(t,e){return this.costCallback=t,this.costCallbackScope=e,this}},{key:"setPreTestFunction",value:function(t,e){return this.preTestCallback=t,this.preTestCallbackScope=e,this}},{key:"setPerspectiveEnable",value:function(t){return this.perspectiveEnable=t=void 0===t?!0:t,this}},{key:"setDebugGraphics",value:function(t){return this.debugGraphics=t,this}},{key:"setDebugLineColor",value:function(t,e){return this.debugVisibleLineColor=t,this.debugInvisibleLineColor=e,this}},{key:"setDebugLog",value:function(t){return this.debugLog=t=void 0===t?!0:t,this}},{key:"clearDebugGraphics",value:function(){return this.debugGraphics&&this.debugGraphics.clear(),this}},{key:"BLOCKER",get:function(){return Mr}},{key:"INFINITY",get:function(){return Pr}},{key:"board",get:function(){return this.chessData.board}}]),s}(),Dr={direction:0,angle:1},M=(Object.assign(Sr.prototype,D),s.register("fieldOfView",function(t,e){return new Sr(t,e)}),n(window,"RexPlugins.Board.FieldOfView",Sr),-1),Or=M,P={getPath:function(t,e){if(void 0===e&&(e=[]),null!==this.board){for(var i,n,s=this.chessData.tileXYZ,r=ie(s.x,s.y,this.face);0<t&&null!==(i=this.getNextTile(r,this.preTileXY));)(n=this.getCost(i,r))===Or&&(n=t),(i.cost=n)<=t&&e.push(i),t-=n,this.preTileXY=r,r=i;for(var o=e.length-1;0<=o&&0===e[o].cost;o--)e.length=o}return e},getNextTile:function(t,e){for(var i,n,s=this.board,r=s.grid.allDirections,o=null,h=null,a=[],u=0,l=r.length;u<l;u++)null!==(i=s.getNeighborTileXY(t,r[u],!0))&&s.contains(i.x,i.y,this.pathTileZ)&&(n=ie(i.x,i.y,r[u]),r[u]===t.direction&&(o=n),void 0!==e&&je(i,e)?h=n:a.push(n));return null===h&&0===a.length?null:null===h&&1===a.length?a[0]:null!==h&&0===a.length?h:1===this.pickMode?(null!==h&&a.push(h),Bt(a)):null!==o?o:Bt(a)},getCost:function(t,e){return"number"==typeof this.costCallback?this.costCallback:this.costCallbackScope?this.costCallback.call(this.costCallbackScope,t,e,this):this.costCallback(t,e,this)}},Ar=null,Er=M,_r=function(){l(s,yt);var n=d(s);function s(t,e){var i;return y(this,s),(i=n.call(this,t,{eventEmitter:!1})).chessData=et(t),i.resetFromJSON(e),i}return u(s,[{key:"resetFromJSON",value:function(t){this.preTileXY=g(t,"preTileXY",void 0);var e=g(t,"costCallback",void 0),i=g(t,"costCallbackScope",void 0);return void 0===e&&(e=g(t,"cost",1)),this.setFace(g(t,"face",0)),this.setPathMode(g(t,"pathMode",0)),this.setPathTileZ(g(t,"pathTileZ",0)),this.setCostFunction(e,i),this}},{key:"shutdown",value:function(t){this.isShutdown||(this.chessData=void 0,f(c(s.prototype),"shutdown",this).call(this,t))}},{key:"setFace",value:function(t){return t=this.board.grid.directionNormalize(t),this.face=t,this}},{key:"setPathMode",value:function(t){return"string"==typeof t&&(t=Rr[t]),this.pathMode=t,this}},{key:"setCostFunction",value:function(t,e){return this.costCallback=t,this.costCallbackScope=e,this}},{key:"setPathTileZ",value:function(t){return this.pathTileZ=t=void 0===t?!0:t,this}},{key:"BLOCKER",get:function(){return Ar}},{key:"STOP",get:function(){return Er}},{key:"board",get:function(){return this.chessData.board}}]),s}(),Rr=(Object.assign(_r.prototype,P),{forward:0,random:1}),Br=(s.register("monopoly",function(t,e){return new _r(t,e)}),n(window,"RexPlugins.Board.Monopoly",_r),Phaser.GameObjects.Zone),Nr=Phaser.Utils.Array.Add,Zr=Phaser.Utils.Array.Remove,Lr=function(){l(o,Br);var r=d(o);function o(t,e,i,n,s){return y(this,o),(t=r.call(this,t,e=void 0===e?0:e,i=void 0===i?0:i,n=void 0===n?1:n,s=void 0===s?1:s)).children=[],t}return u(o,[{key:"destroy",value:function(t){if(this.scene&&!this.ignoreDestroy){if(t)for(var e,i=this.children.length-1;0<=i;i--)(e=this.children[i]).parentContainer||e.displayList||e.destroy(t);this.clear(!t),f(c(o.prototype),"destroy",this).call(this,t)}}},{key:"contains",value:function(t){return-1!==this.children.indexOf(t)}},{key:"add",value:function(t){var e=this;return Nr(this.children,t,0,function(t){t.once("destroy",e.onChildDestroy,e)},this),this}},{key:"remove",value:function(t,e){var i=this;return Zr(this.children,t,function(t){t.off("destroy",i.onChildDestroy,i),e&&t.destroy()}),this}},{key:"onChildDestroy",value:function(t,e){this.remove(t,!1)}},{key:"clear",value:function(t){for(var e,i=0,n=this.children.length;i<n;i++)(e=this.children[i]).off("destroy",this.onChildDestroy,this),t&&e.destroy();return this.children.length=0,this}}]),o}(),t=Phaser.GameObjects.Components,Ir=(Phaser.Class.mixin(Lr,[t.Alpha,t.Flip]),Phaser.Math.DegToRad),Fr=Phaser.Math.RadToDeg,jr=Phaser.Utils.Objects.GetValue,zr=Lr.prototype.add,Ur=Lr.prototype.remove,Gr=Lr.prototype.clear,Wr=Phaser.Math.RotateAround,Vr=Phaser.Math.DegToRad,Jr=Phaser.Utils.Array,Hr=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},Kr=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height},qr=Phaser.Geom.Rectangle,$r=Phaser.Math.Vector2,Qr=Phaser.Math.RotateAround,to=function(t,e){var i,n,s,r,o,h,a;return void 0===e?e=new qr:!0===e&&(e=eo=void 0===eo?new qr:eo),t.getBounds?t.getBounds(e):(a=(t.parentContainer?(a=t.parentContainer.getBoundsTransformMatrix(),de(t,e),a.transformPoint(e.x,e.y,e),i=e.x,n=e.y,fe(t,e),a.transformPoint(e.x,e.y,e),s=e.x,r=e.y,ve(t,e),a.transformPoint(e.x,e.y,e),o=e.x,h=e.y,ye(t,e),a.transformPoint(e.x,e.y,e)):(de(t,e),i=e.x,n=e.y,fe(t,e),s=e.x,r=e.y,ve(t,e),o=e.x,h=e.y,ye(t,e)),e.x),t=e.y,e.x=Math.min(i,s,o,a),e.y=Math.min(n,r,h,t),e.width=Math.max(i,s,o,a)-e.x,e.height=Math.max(n,r,h,t)-e.y,e)},eo=void 0,R=void 0,io=function(t,e,i){return void 0===i&&(i=!1),0!==t.rotation&&Qr(e,t.x,t.y,t.rotation),i&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e),e},no=Phaser.Geom.Rectangle,so=Phaser.Geom.Rectangle.Union,ro=Phaser.GameObjects.GameObject,oo=Phaser.Utils.Objects.GetValue,ho=(Phaser.Textures.DynamicTexture,Phaser.Utils.String.UUID,Phaser.Utils.Objects.GetValue),ao=function(t,e,i,n,s,r,o){var h;(t.getBounds||void 0!==t.width&&void 0!==t.height)&&(void 0===i&&(i=16777215),void 0===n&&(n=1),void 0===s&&(s=null),void 0===r&&(r=1),void 0===o&&(o=0),(h=de(t,uo[0])).x-=o,h.y-=o,(h=fe(t,uo[1])).x+=o,h.y-=o,(h=ye(t,uo[2])).x+=o,h.y+=o,(h=ve(t,uo[3])).x-=o,h.y+=o,null!==s&&e.fillStyle(s,r).fillPoints(uo,!0,!0),null!==i)&&e.lineStyle(n,i).strokePoints(uo,!0,!0)},uo=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],lo=Phaser.Utils.Objects.GetValue,co=Phaser.Math.RotateAround,ct={changeOrigin:function(t,e){this.syncChildrenEnable=!1,e=e,n={x:((t=t)-(i=this).originX)*i.displayWidth,y:((e=void 0===e?t:e)-i.originY)*i.displayHeight},co(n,0,0,i.rotation),i.originX=t,i.originY=e,i.x=i.x+n.x,i.y=i.y+n.y,this.syncChildrenEnable=!0;for(var i,n,s=this.getAllChildren(),r=0,o=s.length;r<o;r++)this.resetChildPositionState(s[r]);return this},drawBounds:function(t,e){var i,n,s,r,o,h=lo(e,"drawContainer",!0),a=lo(e,"children"),u=(void 0===a&&(a=this.getAllVisibleChildren([this])),a=h?a:a.filter(function(t){return!t.isRexContainerLite})),l=t,h=e;if("number"==typeof h?i=h:(i=ho(h,"color"),n=ho(h,"lineWidth"),s=ho(h,"fillColor"),r=ho(h,"fillAlpha",1),o=ho(h,"padding",0)),Array.isArray(u))for(var c=0,d=u.length;c<d;c++)ao(u[c],l,i,n,s,r,o);else ao(u,l,i,n,s,r,o);return this}},fo=(Object.assign(ct,{setParent:function(t,e){void 0===e&&(e=this);var i=o(t);return e?(i.parent=e,i.self=t):(i.parent=null,i.self=null),this},getParent:function(t,e){return"string"==typeof t&&(e=t,t=void 0),r(t=void 0===t?this:t,e)},getTopmostParent:function(t){for(var e=t=void 0===t?this:t,i=r(e);i;)i=r(e=i);return e}},{add:function(t){return Array.isArray(t)?this.addMultiple(t):ne.call(this,t),this},pin:function(t,e){return Array.isArray(t)?this.addMultiple(t,e):ne.call(this,t,e),this},addMultiple:function(t){for(var e=0,i=t.length;e<i;e++)ne.call(this,t[e]);return this},addLocal:function(t){return Array.isArray(t)?this.addMultiple(t):se.call(this,t),this},pinLocal:function(t,e){return Array.isArray(t)?this.addMultiple(t,e):se.call(this,t,e),this},addLocalMultiple:function(t){for(var e=0,i=t.length;e<i;e++)se.call(this,t[e]);return this}},{remove:function(t,e){return r(t)===this&&(this.setParent(t,null),e||this.removeFromRenderLayer(t),Ur.call(this,t,e)),this},unpin:function(t,e){return r(t)===this&&(this.setParent(t,null),e||this.removeFromRenderLayer(t),Ur.call(this,t,e)),this},clear:function(t){for(var e=this.children,i=0,n=e.length;i<n;i++){var s=e[i];this.setParent(s,null),t||this.removeFromRenderLayer(s)}return Gr.call(this,t),this}},{getLocalState:o,resetChildState:function(t){return this.resetChildPositionState(t).resetChildVisibleState(t).resetChildAlphaState(t).resetChildActiveState(t),this},resetChildrenState:function(t){for(var e=0,i=t.length;e<i;e++)this.resetChildState(t[e]);return this},syncProperties:function(){return this.syncPosition().syncVisible().syncAlpha().syncActive().syncScrollFactor().syncMask(),this}},{worldToLocal:function(t){return t.x-=this.x,t.y-=this.y,Wr(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t},localToWorld:function(t){return t.x*=this.scaleX,t.y*=this.scaleY,Wr(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}},{updateChildPosition:function(t){t.isRexContainerLite&&(t.syncChildrenEnable=!1);var e=o(t),i=e.parent;return e.syncPosition&&(t.x=e.x,t.y=e.y,i.localToWorld(t)),e.syncRotation&&(t.rotation=e.rotation+i.rotation),e.syncScale&&(t.scaleX=e.scaleX*i.scaleX,t.scaleY=e.scaleY*i.scaleY),t.isRexContainerLite&&(t.syncChildrenEnable=!0,t.syncPosition()),this},syncPosition:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildPosition,this),this},resetChildPositionState:function(t){var e=o(t),i=e.parent;return e.x=t.x,e.y=t.y,i.worldToLocal(e),e.scaleX=oe(t.scaleX,i.scaleX),e.scaleY=oe(t.scaleY,i.scaleY),e.rotation=t.rotation-i.rotation,this},setChildPosition:function(t,e,i){return t.x=e,t.y=i,this.resetChildPositionState(t),this},setChildLocalPosition:function(t,e,i){var n=o(t);return n.x=e,n.y=i,this.updateChildPosition(t),this},resetLocalPositionState:function(){var t=o(this).parent;return t&&t.resetChildPositionState(this),this}},{updateChildRotation:function(t){var e=o(t),i=e.parent;return e.syncRotation&&(t.rotation=i.rotation+e.rotation),this},syncRotation:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildRotation,this),this},resetChildRotationState:function(t){var e=o(t),i=e.parent;return e.rotation=t.rotation-i.rotation,this},setChildRotation:function(t,e){return t.rotation=e,this.resetChildRotationState(t),this},setChildAngle:function(t,e){return t.angle=e,this.resetChildRotationState(t),this},setChildLocalRotation:function(t,e){return o(t).rotation=e,this.updateChildRotation(t),this},setChildLocalAngle:function(t,e){return o(t).rotation=Vr(e),this.updateChildRotation(t),this},resetLocalRotationState:function(){var t=o(this).parent;return t&&t.resetChildRotationState(this),this}},{updateChildScale:function(t){var e=o(t),i=e.parent;return e.syncScale&&(t.scaleX=i.scaleX*e.scaleX,t.scaleY=i.scaleY*e.scaleY),this},syncScale:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildScale,this),this},resetChildScaleState:function(t){var e=o(t),i=e.parent;return e.scaleX=oe(t.scaleX,i.scaleX),e.scaleY=oe(t.scaleY,i.scaleY),this},setChildScale:function(t,e,i){return void 0===i&&(i=e),t.scaleX=e,t.scaleY=i,this.resetChildScaleState(t),this},setChildLocalScale:function(t,e,i){void 0===i&&(i=e);var n=o(t);return n.scaleX=e,n.scaleY=i,this.updateChildScale(t),this},setChildDisplaySize:function(t,e,i){return t.setDisplaySize(e,i),this.resetChildScaleState(t),this},resetLocalScaleState:function(){var t=o(this).parent;return t&&t.resetChildScaleState(this),this}},{updateChildVisible:function(t){var e=o(t),i=e.parent,n=!e.hasOwnProperty("maskVisible")||e.maskVisible;return t.visible=i.visible&&e.visible&&n,this},syncVisible:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildVisible,this),this},resetChildVisibleState:function(t){var e=o(t);return e.hasOwnProperty("maskVisible")&&delete e.maskVisible,e.visible=t.visible,this},setChildVisible:function(t,e){return this.setChildLocalVisible(t,e),this},setChildLocalVisible:function(t,e){return void 0===e&&(e=!0),o(t).visible=e,this.updateChildVisible(t),this},setChildMaskVisible:function(t,e){return void 0===e&&(e=!0),o(t).maskVisible=e,this.updateChildVisible(t),this},resetLocalVisibleState:function(){var t=o(this).parent;return t&&t.resetChildVisibleState(this),this}},{updateChildAlpha:function(t){var e=o(t),i=e.parent;return e.syncAlpha&&(t.alpha=i.alpha*e.alpha),this},syncAlpha:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildAlpha,this),this},resetChildAlphaState:function(t){var e=o(t),i=e.parent;return e.alpha=oe(t.alpha,i.alpha),this},setChildAlpha:function(t,e){return t.alpha=e,this.resetChildAlphaState(t),this},setChildLocalAlpha:function(t,e){return o(t).alpha=e,this.updateChildAlpha(t),this},resetLocalAlphaState:function(){var t=o(this).parent;return t&&t.resetChildAlphaState(this),this}},{updateChildActive:function(t){var e=o(t),i=e.parent;return t.active=i.active&&e.active,this},syncActive:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildActive,this),this},resetChildActiveState:function(t){return o(t).active=t.active,this},setChildActive:function(t,e){return t.active=e,this.resetChildActiveState(t),this},setChildLocalActive:function(t,e){return void 0===e&&(e=!0),o(t).active=e,this.updateChildActive(t),this},resetLocalActiveState:function(){var t=o(this).parent;return t&&t.resetChildActiveState(this),this}},{updateChildScrollFactor:function(t){var e=o(t),i=e.parent;return e.syncScrollFactor&&t.setScrollFactor(i.scrollFactorX,i.scrollFactorY),this},syncScrollFactor:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildScrollFactor,this),this}},{updateChildMask:function(t){return null!=this.mask&&(this.mask.hasOwnProperty("geometryMask")?this.mask.geometryMask:this.mask.bitmapMask)!==t&&(t.mask=this.mask),this},syncMask:function(){return this.syncChildrenEnable&&this.children.forEach(this.updateChildMask,this),this},setMask:function(t){return this.mask=t,this},clearMask:function(t){return void 0===t&&(t=!1),this._mask=null,this.children.forEach(function(t){t.clearMask(!1)}),t&&this.mask&&this.mask.destroy(),this}},{setDepth:function(t,e){if(this.depth=t,!e&&this.children)for(var i=this.getAllChildren(),n=0,s=i.length;n<s;n++)i[n].depth=t;return this},swapDepth:function(t){var e=this.depth,i=t.depth;return this.setDepth(i),t.setDepth(e),this},incDepth:function(t){if(this.depth+=t,this.children)for(var e=this.getAllChildren(),i=0,n=e.length;i<n;i++)e[i].depth+=t;return this},bringToTop:function(){var t=this.displayList,e=this.getAllChildren([this]);he(e,!1);for(var i=0,n=e.length;i<n;i++){var s=e[i];t.exists(s)&&t.bringToTop(s)}return this},moveDepthBelow:function(t){var e=this.displayList;if(t.displayList===e){var i=this.getAllChildren([this]);he(i,!1);for(var n=0,s=i.length;n<s;n++){var r=i[n];if(e.exists(r)){e.moveBelow(t,r);break}}}return this},moveDepthAbove:function(t){var e=this.displayList;if(t.displayList===e){var i=this.getAllChildren([this]);he(i,!0);for(var n=0,s=i.length;n<s;n++){var r=i[n];if(e.exists(r)){e.moveAbove(t,r);break}}}return this}},{getChildren:function(t){if(t)for(var e=0,i=this.children.length;e<i;e++)t.push(this.children[e]);else t=this.children;return t},getAllChildren:function(e){void 0===e&&(e=[]);var i=this;return ue(i,function(t){t!==i&&e.push(t)}),e},getAllVisibleChildren:function(e){void 0===e&&(e=[]);var i=this;return ue(i,function(t){if(t!==i)return!t.visible||void e.push(t)}),e},bfs:function(t,e){return ue(e=void 0===e?this:e,t),this},dfs:function(t,e){return ae(e=void 0===e?this:e,t),this},contains:function(t){t=r(t);return!!t&&(t===this||this.contains(t))},getByName:function(t,e){if(e){for(var i,n=[this];n.length;)for(var s,r=0,o=(s=n.shift()).children.length;r<o;r++){if((i=s.children[r]).name===t)return i;i.isRexContainerLite&&n.push(i)}return null}return Jr.GetFirst(this.children,"name",t)},getRandom:function(t,e){return Jr.GetRandom(this.children,t,e)},getFirst:function(t,e,i,n){return Jr.GetFirstElement(this.children,t,e,i,n)},getAll:function(t,e,i,n){return Jr.GetAll(this.children,t,e,i,n)},count:function(t,e,i,n){return Jr.CountAllMatching(this.children,t,e,i,n)},swap:function(t,e){return Jr.Swap(this.children,t,e),this},setAll:function(t,e,i,n){return Jr.SetAll(this.children,t,e,i,n),this}},{tweenChild:function(t){var e=t.targets,i=(Array.isArray(e)||(e=[e]),this.scene||function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e].scene;if(n)return n}return null}(e));if(i)return t.targets=le(e),(e=i.tweens.add(t)).on("update",ce),e},tweenSelf:function(t){return t.targets=[this],this.tweenChild(t)},createTweenChildConfig:function(t){var e=t.targets,i=(e&&(Array.isArray(e)||(e=[e]),t.targets=le(e)),t.onUpdate);return t.onUpdate=function(t,e){i&&i(t,e),ce(t,void 0,e)},t},tween:function(t){var e=this.scene;return t.targets||(t.targets=this),e.tweens.add(t)}},{addToContainer:function(t){this._setParentContainerFlag=!0;var e=this.getAllChildren([this]);return he(e),t.add(e),this._setParentContainerFlag=!1,this},addToLayer:function(t){return this.addToContainer(t),this},removeFromContainer:function(){var t;return this.parentContainer&&0!==(t=this.getAllChildren([this]).filter(function(t){return!!t.scene})).length&&(this._setParentContainerFlag=!0,1<t.length&&(he(t),t.reverse()),this.parentContainer.remove(t),this._setParentContainerFlag=!1),this},getParentContainer:function(){if(this.parentContainer)return this.parentContainer;for(var t=this.getParent();t;){var e=t.parentContainer;if(e)return e;t=t.getParent()}return null},addToParentContainer:function(t){var e;return t.displayList&&(e=this.getParentContainer())&&(t.isRexContainerLite?t.addToContainer(e):e.add(t)),this}},{enableLayer:function(){var t;return this.privateRenderLayer||(t=this.scene.add.layer(),this.moveDepthBelow(t),this.addToLayer(t),this.privateRenderLayer=t),this},getLayer:function(){return this.privateRenderLayer||this.enableLayer(),this.privateRenderLayer},getRenderLayer:function(){if(this.privateRenderLayer)return this.privateRenderLayer;for(var t=this.getParent();t;){var e=t.privateRenderLayer;if(e)return e;t=t.getParent()}return null},addToRenderLayer:function(t){var e;return t.displayList&&(e=this.getRenderLayer())&&(t.isRexContainerLite?t.addToLayer(e):e.add(t),o(t).layer=e),this},removeFromRenderLayer:function(t){var e=o(t),i=e.layer;return i&&(i.remove(t),e.layer=null),this}},{snapshot:function(t){var e=this.scaleX,i=this.scaleY,n=1===e&&1===i,t=(n||this.setScale(1),(t=void 0===t?{}:t).gameObjects=this.getAllVisibleChildren(),t.x=this.x,t.y=this.y,t.originX=this.originX,t.originY=this.originY,ge(t)),s=!!t.scene;return n||(this.setScale(e,i),s&&t.setScale(e,i)),s?t:this}}),function(){l(h,Lr);var o=d(h);function h(t,e,i,n,s,r){return y(this,h),Array.isArray(n)&&(r=n,s=n=void 0),(t=o.call(this,t,e,i,n,s)).type="rexContainerLite",t.isRexContainerLite=!0,t.syncChildrenEnable=!0,t._active=!0,t._mask=null,t._scrollFactorX=1,t._scrollFactorY=1,t.privateRenderLayer=void 0,r&&t.add(r),t}return u(h,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(this.syncChildrenEnable=!1,f(c(h.prototype),"destroy",this).call(this,t),this.privateRenderLayer)&&(this.privateRenderLayer.list.length=0,this.privateRenderLayer.destroy())}},{key:"resize",value:function(t,e){return this.setSize(t,e),this}},{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.syncPosition())}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.syncPosition())}},{key:"rotation",get:function(){return f(c(h.prototype),"rotation",this)},set:function(t){this.rotation!==t&&(F(c(h.prototype),"rotation",t,this,!0),this.syncPosition())}},{key:"scaleX",get:function(){return f(c(h.prototype),"scaleX",this)},set:function(t){this.scaleX!==t&&(F(c(h.prototype),"scaleX",t,this,!0),this.syncPosition())}},{key:"scaleY",get:function(){return f(c(h.prototype),"scaleY",this)},set:function(t){this.scaleY!==t&&(F(c(h.prototype),"scaleY",t,this,!0),this.syncPosition())}},{key:"scale",get:function(){return f(c(h.prototype),"scale",this)},set:function(t){this.scale!==t&&(F(c(h.prototype),"scale",t,this,!0),this.syncPosition())}},{key:"visible",get:function(){return f(c(h.prototype),"visible",this)},set:function(t){f(c(h.prototype),"visible",this)!==t&&(F(c(h.prototype),"visible",t,this,!0),this.syncVisible())}},{key:"alpha",get:function(){return f(c(h.prototype),"alpha",this)},set:function(t){f(c(h.prototype),"alpha",this)!==t&&(F(c(h.prototype),"alpha",t,this,!0),this.syncAlpha())}},{key:"active",get:function(){return this._active},set:function(t){this._active!==t&&(this._active=t,this.syncActive())}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask!==t&&(this._mask=t,this.syncMask())}},{key:"scrollFactorX",get:function(){return this._scrollFactorX},set:function(t){this._scrollFactorX!==t&&(this._scrollFactorX=t,this.syncScrollFactor())}},{key:"scrollFactorY",get:function(){return this._scrollFactorY},set:function(t){this._scrollFactorY!==t&&(this._scrollFactorY=t,this.syncScrollFactor())}},{key:"list",get:function(){return this.children}},{key:"parentContainer",get:function(){return this._parentContainer},set:function(t){!this._parentContainer&&!t||this.setParentContainerFlag?this._parentContainer=t:this._parentContainer&&!t?(this.removeFromContainer(),this._parentContainer=t):t?(this._parentContainer=t,this.addToContainer(t)):this._parentContainer=t}},{key:"setParentContainerFlag",get:function(){var t;return!!this._setParentContainerFlag||!!(t=r(this))&&t.setParentContainerFlag}}],[{key:"GetParent",value:function(t){return r(t)}}]),h}()),vo=(Object.assign(fo.prototype,ct),{x:0,y:0,z:0}),yo=function(t){var e=this.grid,i=(e.saveOrigin(),e.setOriginPosition(this.x,this.y),this.board.worldXYToTileXY(t.x,t.y,!0)),n=i.x,i=i.y,s=(e.restoreOrigin(),this.input.tilePosition.x=n,this.input.tilePosition.y=i,this.board.tileXYToChessArray(n,i,go)),e=0<s.length;if(e){for(var r,o=0,h=s.length;o<h;o++)(r=s[o]).emit&&r.emit("miniboard.pointerdown",t),this.emit("gameobjectdown",t,r);this.emit("pointerdown",t,this)}return go.length=0,e},po=function(t){var e,i=this.input.drag;1!==i.state&&((e=i.position).x=t.x-this.x,e.y=t.y-this.y,i.state=1,this.emit("dragstart",t,e.x,e.y))},go=[],bo=function(t){var e,i,n=this.input.drag;if(0!==n.state)return void 0===t&&(t=this.input.pointer),i=n.position,e=t.x-i.x,i=t.y-i.y,n.state=0,this.emit("dragend",t,e,i),this},To=function(t){var e=this.grid,i=(e.saveOrigin(),e.setOriginPosition(this.x,this.y),this.board.worldXYToTileXY(t.x,t.y,!0)),n=i.x,i=i.y,s=(e.restoreOrigin(),this.input.tilePosition.x=n,this.input.tilePosition.y=i,this.board.tileXYToChessArray(n,i,mo)),e=0<s.length;if(e){for(var r,o=0,h=s.length;o<h;o++)(r=s[o]).emit&&r.emit("miniboard.pointerup",t),this.emit("gameobjectup",t,r);this.emit("pointerup",t,this)}return mo.length=0,e},mo=[],xo=function(t){var e=this.grid,i=(e.saveOrigin(),e.setOriginPosition(this.x,this.y),this.board.worldXYToTileXY(t.x,t.y,!0)),n=i.x,i=i.y;if(e.restoreOrigin(),this.input.tilePosition.x!==n||this.input.tilePosition.y!==i){this.input.tilePosition.x=n,this.input.tilePosition.y=i;var s=this.board.tileXYToChessArray(n,i,wo),e=0<s.length;if(e){for(var r,o=0,h=s.length;o<h;o++)(r=s[o]).emit&&r.emit("miniboard.pointermove",t),this.emit("gameobjectmove",t,r);this.emit("pointermove",t,this)}else this.input.pointer===t&&(this.input.pointer=null);(wo.length=0)===this.input.drag.state&&(this.input.pointer===t?e||(this.input.pointer=null):null===this.input.pointer&&(this.input.pointer=t))}},ko=function(t){var e,i=this.input.drag;0!==i.state&&(i=i.position,e=t.x-i.x,i=t.y-i.y,this.emit("drag",t,e,i))},wo=[],Co={x:1,y:2,"x&y":3},Yo={},S={addChess:function(t,e,i,n){var s=this.grid;return s.saveOrigin(),s.setOriginPosition(this.x,this.y),this.board.addChess(t,e,i,n,!0),Tt(t)&&(t=this.board.uidToChess(t)),this.add(t),s.restoreOrigin(),this},removeChess:function(t,e,i,n,s){return this.board.removeChess(t,e,i,n,s),this},removeAllChess:function(t){return this.board.removeAllChess(t),this},pullOutFromMainBoard:function(){var t,e=this.mainBoard;if(null!==e){for(t in this.tileXYZMap)e.removeChess(parseInt(t));this.setMainBoard(null)}return this},canPutOnMainBoard:function(t,e,i,n){if(!t)return!1;var s,r,o,h;for(o in n=void 0===n?this.tileXYZMap:n){if(s=n[o],r=t.offset(s,e,i,!0),!t.contains(r.x,r.y))return!1;if(this.putTestCallback?(vo.x=r.x,vo.y=r.x,vo.z=s.z,h=this.board.uidToChess(o),this.putTestCallbackScpe?this.putTestCallback.call(this.putTestCallbackScpe,vo,t,h):this.putTestCallback(vo,t,h)):t.contains(r.x,r.y,s.z))return!1}return!0},putOnMainBoard:function(t,e,i,n){var s;if(t&&(void 0===e&&(e=(s=t.worldXYToTileXY(this.x,this.y,!0)).x,i=s.y),void 0===n&&(n=!0),this.pullOutFromMainBoard(),this.canPutOnMainBoard(t,e,i))){this.setMainBoard(t,e,i);var r,o,h,a=this.tileXYZMap;for(h in a)r=a[h],h=parseInt(h),o=t.offset(r,e,i,!0),t.addChess(h,o.x,o.y,r.z,!1);n&&this.alignToMainBoard(t,e,i)}return this},putBack:function(){var t=this.lastMainBoardRef.mainBoard,e=this.lastMainBoardRef.tileX,i=this.lastMainBoardRef.tileY;return this.putOnMainBoard(t,e,i,!1),this},isOverlapping:function(t,e){var i,n;if(t)for(n in this.tileXYZMap)if(i=this.board.uidToChess(n),t.isOverlappingPoint(i.x,i.y,e))return!0;return!1},alignToMainBoard:function(t,e,i){var n;return t&&(void 0===e&&(e=(n=t.worldXYToTileXY(this.x,this.y,!0)).x,i=n.y),t.gridAlign(this,e,i)),this},setInteractive:function(t){return void 0===t&&(t=!0),this.input||(this.input={enable:!0,tilePosition:{x:void 0,y:void 0},pointer:void 0,drag:{enable:!1,state:0,position:{x:void 0,y:void 0}}},this.scene.input.on("pointerdown",be,this),this.scene.input.on("pointerup",Te,this),this.scene.input.on("pointermove",me,this),this.once("destroy",function(){this.scene&&(this.scene.input.off("pointerdown",be,this),this.scene.input.off("pointerup",Te,this),this.scene.input.off("pointermove",me,this))},this)),(this.input.enable=t)||(this.input.pointer=null),this},setDraggable:function(t){return void 0===t&&(t=!0),this.setInteractive(),(this.input.drag.enable=t)||(this.input.drag.state=0),this},dragEnd:bo,setMainBoard:function(t,e,i){return this.mainBoardRef.set(t,e,i),t&&this.lastMainBoardRef.set(t,e,i),this},canMirror:function(t){return null===this.mainBoard||(t=xe.call(this,t),this.canPutOnMainBoard(this.mainBoard,tileX,tileY,t))},mirror:function(t){var e,i,n=null!=this.mainBoard,t=(n&&this.pullOutFromMainBoard(),xe.call(this,t));return n?(n=this.lastMainBoardRef.mainBoard,e=this.lastMainBoardRef.tileX,i=this.lastMainBoardRef.tileY,this.lastTransferResult=this.canPutOnMainBoard(n,e,i,t),this.lastTransferResult&&ke.call(this,t),this.putBack()):(this.lastTransferResult=!0,ke.call(this,t)),this},canRotate:function(t){return null===this.mainBoard||(t=we.call(this,t),this.canPutOnMainBoard(this.mainBoard,tileX,tileY,t))},rotate:function(t){var e,i,n,s;return 0!==t&&((i=null!=this.mainBoard)&&this.pullOutFromMainBoard(),e=we.call(this,t),i?(i=this.lastMainBoardRef.mainBoard,n=this.lastMainBoardRef.tileX,s=this.lastMainBoardRef.tileY,this.lastTransferResult=this.canPutOnMainBoard(i,n,s,e),this.lastTransferResult&&ke.call(this,e),this.putBack()):(this.lastTransferResult=!0,ke.call(this,e)),this.lastTransferResult)&&this.setFace(this.face+t),this},canRotateTo:function(t){return t-=this.face,this.canRotate(t)},rotateTo:function(t){return t-=this.face,this.rotate(t),this},setOrigin:function(t,e){switch(t){case"center":e=t=.5;break;case"top-left":case"left-top":e=t=0}void 0===t&&(t=.5),void 0===e&&(e=t);var i,n=function(t,e){void 0===t&&(t=this.tileXYZMap),void 0===e?e={}:!0===e&&(e=Yo);var i,n,s=1/0,r=-1/0,o=1/0,h=-1/0;for(n in this.tileXYZMap)(i=this.tileXYZMap[n]).x<s&&(s=i.x),i.x>r&&(r=i.x),i.y<o&&(o=i.y),i.y>h&&(h=i.y);return e.minX=s,e.minY=o,e.maxX=r,e.maxY=h,e}.call(this,void 0,!0),s=-Math.floor(Ot(n.minX,n.maxX,t)),n=-Math.floor(Ot(n.minY,n.maxY,e));return 0==s&&0==n||(i=function(t,e,i,n){var s,r,o;for(o in void 0===n&&(n={}),i=void 0===i?this.tileXYZMap:i)s=i[o],(r=this.board.offset(s,t,e)).z=s.z,n[o]=r;return n}.call(this,s,n),ke.call(this,i),i=this.board.tileXYToWorldXY(s,n),s=this.board.tileXYToWorldXY(0,0),this.setPosition(this.x+(s.x-i.x),this.y+(s.y-i.y))),this}},Xo=function(){function e(t){y(this,e),this.miniBoard=t,this.set(null)}return u(e,[{key:"set",value:function(t,e,i){t||(i=e=t=null),this.mainBoard=t,this.tileX=e,this.tileY=i}}]),e}(),Mo=function(){l(r,fo);var s=d(r);function r(t,e,i,n){y(this,r);i={isBoard:!((e=s.call(this,t,e,i,0,0)).type="rexMiniBoard"),grid:g(n,"grid",void 0),infinity:!0,wrap:!1};return e.board=new _n(t,i),e.mainBoardRef=new Xo,e.lastMainBoardRef=new Xo,e.resetFromJSON(n),e}return u(r,[{key:"resetFromJSON",value:function(t){this.setFace(g(t,"face",0));var e=g(t,"draggable",void 0);return void 0!==e&&this.setDraggable(e),this.setPutTestCallback(g(t,"putTestCallback",void 0),g(t,"putTestCallbackScpe",void 0)),this.lastTransferResult=g(t,"lastTransferResult",void 0),this}},{key:"destroy",value:function(t){this.scene&&(this.clear(!t),this.board.shutdown(t),this.board=void 0,this.setPutTestCallback(void 0,void 0),f(c(r.prototype),"destroy",this).call(this,t))}},{key:"setFace",value:function(t){return this.face=this.board.grid.directionNormalize(t),this}},{key:"mainBoard",get:function(){return this.mainBoardRef.mainBoard}},{key:"tileX",get:function(){return this.mainBoardRef.tileX}},{key:"tileY",get:function(){return this.mainBoardRef.tileY}},{key:"grid",get:function(){return this.board.grid}},{key:"tileXYZMap",get:function(){return this.board.boardData.UIDToXYZ}},{key:"setPutTestCallback",value:function(t,e){return this.putTestCallback=t,this.putTestCallbackScpe=e,this}}]),r}(),Po=(Object.assign(Mo.prototype,S),s.register("miniBoard",function(t,e,i){t=new Mo(this.scene,t,e,i);return this.scene.add.existing(t),t}),n(window,"RexPlugins.Board.MiniBoard",Mo),{hexagon:function(t,e,i){void 0===i&&(i=[]);for(var n=t.grid.mode,s=-e;s<=e;s++)for(var r=Math.max(-e,-s-e),o=Math.min(e,-s+e),h=r;h<=o;h++)i.push(k(n,s,0,-s-h));return i},triangle:function(t,e,i,n){void 0===n&&(n=[]);for(var s,r=t.grid.mode,o=0;o<=i;o++)for(var h=1===e?(s=i-o,i):(s=0,i-o),a=s;a<=h;a++)n.push(k(r,o,0,-o-a));return n},parallelogram:function(t,e,i,n,s){void 0===s&&(s=[]);var r=t.grid.mode;switch(e){case 1:for(var o=0;o<=i;o++)for(var h=0;h<=n;h++)s.push(k(r,h,0,o));break;case 2:for(var a=0;a<=i;a++)for(o=0;o<=n;o++)s.push(k(r,-a-o,0,o));break;default:for(h=0;h<=i;h++)for(a=0;a<=n;a++)s.push(k(r,h,0,-h-a))}return s}}),So=Phaser.Utils.String.Pad,Do=function(t,e,i,n,s,r,o,h){void 0===n&&void 0===s&&(n=16777215),void 0===s?r=0:void 0===r&&(r=2),void 0===h&&(h="round"),void 0===o&&(o=!1),C=Ye(i,C),Me(i,-C.left,-C.top);var a=C.right-C.left,u=C.bottom-C.top,o=(o?(a+=r,u+=r,Me(i,r/2)):Xe(i,C,r),t.sys.textures.createCanvas(e,Math.ceil(a),Math.ceil(u))),t=o.getCanvas(),e=o.getContext(),a=e,u=i,i=Ce(n,t,e),n=Ce(s,t,e),s=r,t=h,l=(void 0===t&&(t="round"),a),c=u,d=(l.save(),l.beginPath(),c[0]);l.moveTo(d.x,d.y);for(var f=1,v=c.length;f<v;f++)d=c[f],l.lineTo(d.x,d.y);l.closePath(),l.restore(),a.lineJoin=t,null!=i&&(a.fillStyle=i,a.fill()),null!=n&&(a.strokeStyle=n,a.lineWidth=s,a.stroke()),o.refresh()},Oo=function(t,e,i){return t<e?t+i:e<t?t-i:t},Ao=function(t){return new ws(t.scene,{grid:Se(t),width:t.width,height:t.height})},Eo=function(t,e,i){void 0===i?i=e.layers:Array.isArray(i)||(i=[i]);for(var n=0,s=i.length;n<s;n++){var r=i[n];"string"==typeof r&&(r=e.getLayer(r)),pe(r)&&(r=r.layer),De(t,r)}};return function(){l(n,Phaser.Plugins.ScenePlugin);var i=d(n);function n(t,e){return y(this,n),(e=i.call(this,t,e)).add=new s(t),e.hexagonMap=Po,e.createTileTexture=Pe,e.createBoardFromTilemap=Oe,e}return u(n,[{key:"start",value:function(){this.scene.sys.events.on("destroy",this.destroy,this)}}]),n}()});

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e()}(void 0,function(){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(n.key),n)}}function u(t,e,i){e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1})}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=c(i),e=(t=n?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n)return(n=Object.getOwnPropertyDescriptor(n,e)).get?n.get.call(arguments.length<3?t:i):n.value}).apply(this,arguments)}function t(t,e,i){var n=t.width/2,r=t.height/2;return s.x=e-n,s.y=i-r,o(s,0,0,t.rotation),s.x*=t.scaleX,s.y*=t.scaleY,s.x+=t.x,s.y+=t.y,s}var o=Phaser.Math.RotateAround,s={x:0,y:0},C=function(){function i(t,e){b(this,i),this.parent=t,this.vertex=e,this._localX=void 0,this._localY=void 0}return u(i,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0}},{key:"updateVertexPosition",value:function(t,e){var i=this.parent,n=i.height,r=i.frame.cutWidth/n/2,e=e/n-i.frame.cutHeight/n/2,o=this.vertex;return o.x=t/n-r,o.y=-e,i.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t)}},{key:"localXOrigin",get:function(){return this._localXOrigin}},{key:"localYOrigin",get:function(){return this._localYOrigin}},{key:"resetLocalXY",value:function(t,e){return this._localXOrigin=t,this._localYOrigin=e,this._localX=t,this._localY=e,this}},{key:"setLocalXY",value:function(t,e,i){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,i)||this.updateVertexPosition(t,e),this}},{key:"setWorldXY",value:function(t,e){var i,n,r;return this._worldX===t&&this._worldY===e||(i=this.parent,e=e,n=i.width/2,r=i.height/2,s.x=t-i.x,s.y=e-i.y,s.x/=i.scaleX,s.y/=i.scaleY,o(s,0,0,-i.rotation),s.x+=n,s.y+=r,this.setLocalXY(s.x,s.y)),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return t(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return t(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y)}},{key:"y",get:function(){return t(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t)}}]),i}(),D=Phaser.Geom.Mesh.Vertex,B=Phaser.Geom.Mesh.Face,L=[0,2,3,0,3,1],I=[1,3,2,1,2,0],W=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],A=Phaser.GameObjects.Mesh,z=Phaser.Utils.Objects.IsPlainObject,k=Phaser.Utils.Objects.GetValue,d=function(){h(w,A);var x=l(w);function w(t,e,i,n,r,o){b(this,w),z(e)&&(e=k(o=e,"x",0),i=k(o,"y",0),n=k(o,"key",null),r=k(o,"frame",null)),(t=x.call(this,t,e,i,n,r)).type="rexQuadImage",t.isNinePointMode=k(o,"ninePointMode",!1),t.fourPointsModeRTL=k(o,"rtl",!1),t.controlPoints=[];for(var s=m(t),e=s.isNinePointMode,a=e?9:4,u=s.vertices,h=s.faces,c=s.controlPoints,l=0;l<a;l++){var f=new D;u.push(f),c.push(new C(s,f))}for(var d,l=0,y=(d=e?W:s.fourPointsModeRTL?I:L).length;l<y;l+=3){var g=u[d[l+0]],v=u[d[l+1]],p=u[d[l+2]];h.push(new B(g,v,p))}return e?(s.topLeft=c[0],s.topCenter=c[1],s.topRight=c[2],s.centerLeft=c[3],s.center=c[4],s.centerRight=c[5],s.bottomLeft=c[6],s.bottomCenter=c[7],s.bottomRight=c[8]):(s.topLeft=c[0],s.topRight=c[1],s.bottomLeft=c[2],s.bottomRight=c[3]),t.hideCCW=!1,t.syncSize(),t}return u(w,[{key:"destroy",value:function(t){if(this.scene&&!this.ignoreDestroy){f(c(w.prototype),"destroy",this).call(this,t);for(var e=0,i=this.controlPoints.length;e<i;e++)this.controlPoints[e].destroy();this.controlPoints=void 0}}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;e=(t=this).height,i=t.width;for(var t,e,i,n=t.isNinePointMode?[0,0,t=(0+i)/2,0,i,0,0,h=(0+e)/2,t,h,i,h,0,e,t,e,i,e]:[0,0,i,0,0,e,i,e],r=this.width,o=this.height,s=this.frame.cutWidth/o/2,a=this.frame.cutHeight/o/2,u=this.frame.u0,h=this.frame.u1,c=this.frame.v0,l=h-u,f=this.frame.v1-c,d=this.controlPoints,y=0,g=n.length;y<g;y+=2){var v=n[y+0],p=n[y+1],x=y/2,w=u+v/r*l,b=c+p/o*f;this.vertices[x].set(v/o-s,-(p/o-a),0).setUVs(w,b),d[x].resetLocalXY(v,p)}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color}}]),w}();function H(t,e,i,n,r){t=new d(this.scene,t,e,i,n,r);return this.scene.add.existing(t),t}var r=Phaser.Utils.Objects.GetAdvancedValue,Q=Phaser.GameObjects.BuildGameObject;function E(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=r(t,"key",null),i=r(t,"frame",null),e=new d(this.scene,0,0,e,i,t);return Q(this.scene,e,t),e}function y(t,e,i){return new q(t.sys.textures,null,e=void 0===e?2:e,i=void 0===i?2:i)}function g(t,e,i){void 0===e?e=new P:!0===e&&(e=j=void 0===j?new P:j),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-x(t)*t.originX,e.y=t.y-w(t)*t.originY,X(t,e,i))}function v(t,e,i){void 0===e?e=new P:!0===e&&(e=j=void 0===j?new P:j),t.getTopRight?t.getTopRight(e):(e.x=t.x-x(t)*t.originX+x(t),e.y=t.y-w(t)*t.originY,X(t,e,i))}function N(t,e,i){void 0===e?e=new P:!0===e&&(e=j=void 0===j?new P:j),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-x(t)*t.originX,e.y=t.y-w(t)*t.originY+w(t),X(t,e,i))}function F(t,e,i){void 0===e?e=new P:!0===e&&(e=j=void 0===j?new P:j),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-x(t)*t.originX+x(t),e.y=t.y-w(t)*t.originY+w(t),X(t,e,i))}var p,q=Phaser.Textures.DynamicTexture,x=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},w=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height},J=Phaser.Geom.Rectangle,P=Phaser.Math.Vector2,K=Phaser.Math.RotateAround,Z=function(t,e){var i,n,r,o,s,a,u;return void 0===e?e=new J:!0===e&&(e=O=void 0===O?new J:O),t.getBounds?t.getBounds(e):(u=(t.parentContainer?(u=t.parentContainer.getBoundsTransformMatrix(),g(t,e),u.transformPoint(e.x,e.y,e),i=e.x,n=e.y,v(t,e),u.transformPoint(e.x,e.y,e),r=e.x,o=e.y,N(t,e),u.transformPoint(e.x,e.y,e),s=e.x,a=e.y,F(t,e),u.transformPoint(e.x,e.y,e)):(g(t,e),i=e.x,n=e.y,v(t,e),r=e.x,o=e.y,N(t,e),s=e.x,a=e.y,F(t,e)),e.x),t=e.y,e.x=Math.min(i,r,s,u),e.y=Math.min(n,o,a,t),e.width=Math.max(i,r,s,u)-e.x,e.height=Math.max(n,o,a,t)-e.y,e)},O=void 0,j=void 0,X=function(t,e,i){return void 0===i&&(i=!1),0!==t.rotation&&K(e,t.x,t.y,t.rotation),i&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e),e},$=Phaser.Geom.Rectangle,tt=Phaser.Geom.Rectangle.Union,et=function(t){if("object"===a(t)&&null!==t)if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];return t},it=Phaser.GameObjects.GameObject,Y=Phaser.Utils.Objects.GetValue,nt=(Phaser.Textures.DynamicTexture,Phaser.Utils.String.UUID,function(t){var e,i,n,r,o,s,a,u,h,c,l,f,d;if(t)return e=t.gameObjects,c=t.renderTexture,l=Y(t,"x",void 0),f=Y(t,"y",void 0),d=Y(t,"width",void 0),i=Y(t,"height",void 0),n=Y(t,"originX",0),r=Y(t,"originY",0),a=Y(t,"padding",0),s=void 0===d||void 0===i||void 0===l||void 0===f?(s=function(t,e){void 0===e?e=new $:!0===e&&(e=p=void 0===p?new $:p),e.setTo(0,0,0,0);for(var i,n=!0,r=0,o=t.length;r<o;r++)(i=t[r]).getBounds&&(i=Z(i,!0),n?(e.setTo(i.x,i.y,i.width,i.height),n=!1):tt(i,e,e));return e}(e,!0),r=n=void 0!==l&&void 0!==f?(d=2*Math.max(l-s.left,s.right-l),i=2*Math.max(f-s.top,s.bottom-f),.5):(l=s.x,f=s.y,d=s.width,i=s.height,0),o=s.x,s.y):(o=l+(0-n)*d,f+(0-r)*i),o-=a,s-=a,d+=2*a,i+=2*a,a=e[0].scene,(c=c||a.add.renderTexture(0,0,d,i)).setPosition&&c.setPosition(l,f),c.width===d&&c.height===i||c.setSize(d,i),c.setOrigin&&c.setOrigin(n,r),c.camera.setScroll(o,s),(a=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:et(e),i){e.length=t.length;for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}else for(var o in t)e[o]=t[o];return e}(e)).length<=1||(void 0===u&&(u=!1),(h=a[0].scene.sys.displayList).depthSort(),u?a.sort(function(t,e){return h.getIndex(e)-h.getIndex(t)}):a.sort(function(t,e){return h.getIndex(t)-h.getIndex(e)})),e=a,c.draw(e),(l=t.saveTexture)&&(c instanceof it?c.saveTexture(l):(d=(f=c).manager).exists(f.key)?d.renameTexture(f.key,key):(f.key=key,d.list[key]=f,d.emit("addtexture",key,f),d.emit("addtexture-".concat(key),f))),c}),rt=Phaser.Utils.Objects.IsPlainObject,_=Phaser.Utils.Objects.GetValue,R=function(){h(a,d);var s=l(a);function a(t,e,i,n,r,o){b(this,a),rt(e)&&(e=_(o=e,"x",0),i=_(o,"y",0),n=_(o,"width",32),r=_(o,"height",32));n=y(t,n,r),r=s.call(this,t,e,i,n,null,o);return r.type="rexQuadRenderTexture",r.rt=r.texture,r}return u(a,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(f(c(a.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null)}},{key:"snapshot",value:function(t,e){return(e=void 0===e?{}:e).gameObjects=t,e.renderTexture=this.rt,nt(e),this.width===this.frame.realWidth&&this.height===this.frame.realHeight||this.syncSize(),this}}]),a}();function ot(t,e,i,n,r){t=new R(this.scene,t,e,i,n,r);return this.scene.add.existing(t),t}var S=Phaser.Utils.Objects.GetAdvancedValue,st=Phaser.GameObjects.BuildGameObject;function at(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=S(t,"x",0),i=S(t,"y",0),n=S(t,"width",32),r=S(t,"height",32),e=new R(this.scene,e,i,n,r,t);return st(this.scene,e,t),e}function ut(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var n=.5*t.width,r=.5*t.height,o=Math.tan(e)*r,s=Math.tan(i)*n,a=t.controlPoints,u=0,h=a.length;u<h;u++){var c=a[u],l=c.localXOrigin,f=c.localYOrigin;c.localX=l+(r<f?o:-o),c.localY=f+(n<l?s:-s)}}var ht=Phaser.Utils.Objects.IsPlainObject,T=Phaser.Utils.Objects.GetValue,ct=Phaser.Math.DegToRad,lt=Phaser.Math.RadToDeg,G=function(){h(a,d);var s=l(a);function a(t,e,i,n,r){var o;return b(this,a),ht(e)&&(e=T(o=e,"x",0),i=T(o,"y",0),n=T(o,"key",null),r=T(o,"frame",null)),(o=s.call(this,t,e,i,n,r)).type="rexSkewmage",o._skewX=0,o._skewY=0,o}return u(a,[{key:"skewX",get:function(){return this._skewX},set:function(t){this._skewX=t,ut(this,this._skewX,this._skewY)}},{key:"skewXDeg",get:function(){return lt(this._skewX)},set:function(t){this.skewX=ct(t)}},{key:"skewY",get:function(){return this._skewY},set:function(t){this._skewY=t,ut(this,this._skewX,this._skewY)}},{key:"skewYDeg",get:function(){return lt(this._skewY)},set:function(t){this.skewY=ct(t)}},{key:"setSkewX",value:function(t){return this.skewX=t,this}},{key:"setSkewY",value:function(t){return this.skewY=t,this}},{key:"setSkew",value:function(t,e){return void 0===e&&(e=t),this.skewX=t,this.skewY=e,this}},{key:"setSkewXDeg",value:function(t){return this.skewXDeg=t,this}},{key:"setSkewYDeg",value:function(t){return this.skewYDeg=t,this}},{key:"setSkewDeg",value:function(t,e){return void 0===e&&(e=t),this.skewXDeg=t,this.skewYDeg=e,this}}]),a}();function ft(t,e,i,n){t=new G(this.scene,t,e,i,n);return this.scene.add.existing(t),t}var dt=Phaser.Utils.Objects.GetAdvancedValue,yt=Phaser.GameObjects.BuildGameObject;function gt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=dt(t,"key",null),i=dt(t,"frame",null),e=new G(this.scene,0,0,e,i);return yt(this.scene,e,t),e}var vt=Phaser.Utils.Objects.IsPlainObject,M=Phaser.Utils.Objects.GetValue,V=function(){h(a,G);var s=l(a);function a(t,e,i,n,r){b(this,a),vt(e)&&(e=M(o=e,"x",0),i=M(o,"y",0),n=M(o,"width",32),r=M(o,"height",32));var o=y(t,n,r),n=s.call(this,t,e,i,o,null);return n.type="rexSkewRenderTexture",n.rt=n.texture,n}return u(a,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(f(c(a.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null)}}]),a}();function pt(t,e,i,n){t=new V(this.scene,t,e,i,n);return this.scene.add.existing(t),t}var U=Phaser.Utils.Objects.GetAdvancedValue,xt=Phaser.GameObjects.BuildGameObject;function wt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var e=U(t,"x",0),i=U(t,"y",0),n=U(t,"width",32),r=U(t,"height",32),e=new V(this.scene,e,i,n,r);return xt(this.scene,e,t),e}function bt(t){return function(){h(o,t);var r=l(o);function o(t,e){b(this,o);var i=t.scene,n=r.call(this,i,0,0,1,1,e);return i.add.existing(m(n)),i=t,t=m(n),e=e,t.visibleSibling=[],t.isRunning=!1,t.useParentBounds=mt(e,"useParentBounds",!1),t.setPosition(i.x,i.y).setVisible(!1),i.pin(t),n}return u(o,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(this.exit(),f(c(o.prototype),"destroy",this).call(this,t))}},{key:"enter",value:function(){return function(t,e){if(!t)return!1;kt(t,e);for(var i=e.useParentBounds,n=(nt({gameObjects:t.getAllVisibleChildren(),renderTexture:e.rt,x:e.x,y:e.y,width:i?t.displayWidth:void 0,height:i?t.displayHeighth:void 0,originX:i?t.originX:void 0,originY:i?t.originY:void 0}),t.setChildVisible(e,!0),e.visibleSibling),r=t.children,o=0,s=r.length;o<s;o++){var a=r[o];a.visible&&a!==e&&(t.setChildVisible(a,!1),n.push(a))}return e.isRunning=!0}(this.rexContainer.parent,this)&&this.syncSize(),this}},{key:"exit",value:function(){return kt(this.rexContainer.parent,this),this}}]),o}()}function e(t,e,i,n){if(void 0===n&&(n="."),"object"===a(t)){if(Ot(e)){if(null==i)return;"object"===a(i)&&(t=i)}else{n=(e="string"==typeof e?e.split(n):e).pop();(function(t,e,i){var n=t;if(!Ot(e))for(var r,o=0,s=(e="string"==typeof e?e.split("."):e).length;o<s;o++)null!=n[r=e[o]]&&"object"===a(n[r])||(n[r]=o!==s-1||void 0===i?{}:i),n=n[r];return n})(t,e)[n]=i}}}var mt=Phaser.Utils.Objects.GetValue,kt=function(t,e){if(!t)return!1;for(var i=e.visibleSibling,n=0,r=i.length;n<r;n++)t.setChildVisible(i[n],!0);return i.length=0,t.setChildVisible(e,!1),!(e.isRunning=!1)},Pt=function(){h(e,bt(V));var t=l(e);function e(){return b(this,e),t.apply(this,arguments)}return u(e,[{key:"skewState",get:function(){return this.isRunning}}]),e}(),Ot=function(t){return null==t||""===t||0===t.length},jt=function(){h(n,Phaser.Plugins.BasePlugin);var i=l(n);function n(t){var e;return b(this,n),e=i.call(this,t),t.registerGameObject("rexQuadImage",H,E),t.registerGameObject("rexQuadRenderTexture",ot,at),t.registerGameObject("rexSkewImage",ft,gt),t.registerGameObject("rexSkewRenderTexture",pt,wt),e}return u(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"addContainerSkew",value:function(t,e){return new Pt(t,e)}}]),n}();return e(window,"RexPlugins.GameObjects.QuadImage",d),e(window,"RexPlugins.GameObjects.QuadRenderTexture",R),e(window,"RexPlugins.GameObjects.SkewImage",G),e(window,"RexPlugins.GameObjects.SkewRenderTexture",V),e(window,"RexPlugins.GameObjects.ContainerSkew",Pt),jt});

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexninepatchplugin=e()}(void 0,function(){function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(i.key),i)}}function n(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");e=t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r);return c(this,i?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i)return(i=Object.getOwnPropertyDescriptor(i,e)).get?i.get.call(arguments.length<3?t:r):i.value}).apply(this,arguments)}function e(t,e,r){return("__BASE"===r?"":"".concat(r,"_")).concat(t,",").concat(e)}function j(t){var e,r,i;if(null==t||"object"!==O(t))return t;if(e=Array.isArray(t)?[]:{},y(t))for(i in t)r=t[i],e[i]=j(r);else e=t;return e}function h(t){return t="string"==typeof t?g[t]:t}function t(){}function l(t,p){var e=function(){o(d,t);var f=a(d);function d(t,e,r,i,n,o,s,c,a,u){m(this,d),P(e)?(e=x(u=e,"x",0),r=x(u,"y",0),i=x(u,"width",1),n=x(u,"height",1),o=x(u,"key",void 0),s=x(u,"baseFrame",void 0),c=x(u,"columns",void 0),a=x(u,"rows",void 0)):P(i)?(i=x(u=i,"width",1),n=x(u,"height",1),o=x(u,"key",void 0),s=x(u,"baseFrame",void 0),c=x(u,"columns",void 0),a=x(u,"rows",void 0)):P(o)?(o=x(u=o,"key",void 0),s=x(u,"baseFrame",void 0),c=x(u,"columns",void 0),a=x(u,"rows",void 0)):P(s)?(s=x(u=s,"baseFrame",void 0),c=x(u,"columns",void 0),a=x(u,"rows",void 0)):Array.isArray(s)?(u=a,a=c,c=s,s=x(u,"baseFrame",void 0)):P(c)&&(c=x(u=c,"columns",void 0),a=x(u,"rows",void 0)),void 0===c&&(h=x(u,"leftWidth",void 0),l=x(u,"rightWidth",void 0),void 0!==h)&&void 0!==l&&(c=[h,void 0,l]),void 0===a&&(h=x(u,"topHeight",void 0),l=x(u,"bottomHeight",void 0),void 0!==h)&&void 0!==l&&(a=[h,void 0,l]),(h=f.call(this,t)).type=p,h.setPosition(e,r).setSize(i,n).setOrigin(.5,.5),h.columns={},h.rows={},h.stretchMode={},h._tileSprite=void 0,h._image=void 0,h.setGetFrameNameCallback(x(u,"getFrameNameCallback",void 0)),h.setStretchMode(x(u,"stretchMode",0)),h.setPreserveRatio(x(u,"preserveRatio",!0));var h,l=x(u,"maxFixedPartScale",1),t=x(u,"maxFixedPartScaleX",l),e=x(u,"maxFixedPartScaleY",void 0);return h.setMaxFixedPartScale(t,e),h.setBaseTexture(o,s,c,a),h}return n(d,[{key:"minWidth",get:function(){return this.columns.minWidth}},{key:"minHeight",get:function(){return this.rows.minHeight}},{key:"fixedPartScaleX",get:function(){return this.columns.scale}},{key:"fixedPartScaleY",get:function(){return this.rows.scale}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||((u(s(d.prototype),"resize",this)?u(s(d.prototype),"resize",this):u(s(d.prototype),"setSize",this)).call(this,t,e),this.updateTexture()),this}}]),d}();return Object.assign(e.prototype,w),e}function f(t){return t instanceof S}function d(t){return t instanceof _}function p(t,e){var r;return k||(k={},F(t).events.once("destroy",function(){for(var t in k)k[t].destroy();k=void 0})),k.hasOwnProperty(e)||(r=F(t).scene.systemScene,(t=new T[e](r)).setOrigin(0),k[e]=t),k[e]}var y=function(t){if("object"!==O(t)||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},v=Phaser.Utils.Objects.IsPlainObject,b=Phaser.Utils.Objects.GetValue,g={scale:0,repeat:1},w={_beginDraw:t,_drawImage:t,_drawTileSprite:t,_endDraw:t,setGetFrameNameCallback:function(t){return this.getFrameNameCallback=t=void 0===t?e:t,this},setBaseTexture:function(t,e,r,i){Array.isArray(e)&&(i=r,r=e,e=void 0),null==e&&(e="__BASE"),i="number"==typeof r&&6<=arguments.length?(r=[arguments[2],void 0,arguments[3]],[arguments[4],void 0,arguments[5]]):(r=j(r),j(i)),this.textureKey=t,this.baseFrameName=e,this.columns.data=r,this.columns.count=r?r.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.columns.scale=1,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0,this.rows.scale=1;var n=this.scene.sys.textures.get(t);if(n)if(r&&i){for(var o=n.get(e),s=o.width,c=0,a=0,u=r.length;a<u;a++)void 0===r[a]?c++:"number"==typeof r[a]?s-=r[a]:s-=r[a].width;for(var h=s/c,l=o.height,f=0,a=0,u=i.length;a<u;a++)void 0===i[a]?f++:"number"==typeof i[a]?l-=i[a]:l-=i[a].width;for(var d,p,m,y=l/f,v=0,b=0,g=0,w=i.length;g<w;g++){void 0===i[g]&&(i[g]=y),"number"==typeof i[g]&&(i[g]={height:i[g],stretch:g%2}),p=(d=i[g]).height,this.rows.stretch+=0|d.stretch,this.rows.minHeight+=0<d.stretch?0:p;for(var P,x,v=0,a=0,S=r.length;a<S;a++)void 0===r[a]&&(r[a]=h),"number"==typeof r[a]&&(r[a]={width:r[a],stretch:a%2}),m=(P=r[a]).width,0===g&&(this.columns.stretch+=0|P.stretch,this.columns.minWidth+=0<P.stretch?0:m),1<=m&&1<=p&&("string"!==(x=O(P=this.getFrameNameCallback(a,g,e)))&&"number"!==x||n.add(P,0,v+o.cutX,b+o.cutY,m,p)),v+=m;b+=p}this.updateTexture()}else this.clear();else this.clear();return this},updateTexture:function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.sys.textures.get(this.textureKey);if(!t)return this;var e,r,i,n,o,s,c=this.columns.minWidth*this.maxFixedPartScaleX,a=this.rows.minHeight*this.maxFixedPartScaleY,u=this.width-c,h=this.height-a,l=0<=u?this.maxFixedPartScaleX:this.width/c,f=0<=h?this.maxFixedPartScaleY:this.height/a,d=(this.preserveRatio&&((e=Math.min(l,f))<l&&(c=(l-e)*c,0<=u?u+=c:u=c,l=e),e<f)&&(c=(f-e)*a,0<=h?h+=c:h=c,f=e),this.columns.scale=l,this.rows.scale=f,r=0<u&&0<this.columns.stretch?u/this.columns.stretch:0,i=0<h&&0<this.rows.stretch?h/this.rows.stretch:0,0),p=0;this._beginDraw();for(var m=0,y=this.rows.count;m<y;m++){for(var v,b=0===(v=this.rows.data[m]).stretch?v.height*f:i*v.stretch,d=0,g=0,w=this.columns.count;g<w;g++)s=0===(o=this.columns.data[g]).stretch?o.width*l:r*o.stretch,n=this.getFrameNameCallback(g,m,this.baseFrameName),t.has(n)&&0<s&&0<b&&(0===(0===v.stretch&&0===o.stretch||0===this.getStretchMode(g,m)?0:1)?this._drawImage(this.textureKey,n,d,p,s,b):this._drawTileSprite(this.textureKey,n,d,p,s,b)),d+=s;p+=b}this._endDraw()},setStretchMode:function(t){return v(t)?(this.stretchMode.edge=h(b(t,"edge",0)),this.stretchMode.internal=h(b(t,"internal",0))):(t=h(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1}.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal},setPreserveRatio:function(t){return this.preserveRatio=t=null==t?!0:t,this},setMaxFixedPartScale:function(t,e){return void 0===e&&(e=t),this.maxFixedPartScaleX=t,this.maxFixedPartScaleY=e,this}},P=Phaser.Utils.Objects.IsPlainObject,x=Phaser.Utils.Objects.GetValue,S=Phaser.Game,_=Phaser.Scene,F=function(t){return null==t||"object"!==O(t)?null:f(t)?t:f(t.game)?t.game:d(t)?t.sys.game:d(t.scene)?t.scene.sys.game:void 0},T=Phaser.GameObjects,k=void 0,R=Phaser.GameObjects.RenderTexture,M=function(){o(e,l(R,"rexNinePatch"));var t=a(e);function e(){return m(this,e),t.apply(this,arguments)}return n(e)}(),D={_beginDraw:R.prototype.beginDraw,_endDraw:R.prototype.endDraw,_drawImage:function(t,e,r,i,n,o){t=p(this,"Image").setTexture(t,e).setDisplaySize(n,o);this.batchDraw(t,r,i)},_drawTileSprite:function(t,e,r,i,n,o){t=p(this,"TileSprite").setTexture(t,e).setSize(n,o);this.batchDraw(t,r,i)}};function N(t,e,r,i,n,o,s,c,a){t=new M(this.scene,t,e,r,i,n,o,s,c,a);return this.scene.add.existing(t),t}Object.assign(M.prototype,D);var G=Phaser.GameObjects.BuildGameObject;function B(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);e=new M(this.scene,t);return G(this.scene,e,t),e}var A=function(t){return null==t||""===t||0===t.length},D=function(){o(i,Phaser.Plugins.BasePlugin);var r=a(i);function i(t){var e;return m(this,i),e=r.call(this,t),t.registerGameObject("rexNinePatch",N,B),e}return n(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),i}();return function(t,e,r,i){if(void 0===i&&(i="."),"object"===O(t)){if(A(e)){if(null==r)return;"object"===O(r)&&(t=r)}else{i=(e="string"==typeof e?e.split(i):e).pop();(function(t,e,r){var i=t;if(!A(e))for(var n,o=0,s=(e="string"==typeof e?e.split("."):e).length;o<s;o++)null!=i[n=e[o]]&&"object"===O(i[n])||(i[n]=o!==s-1||void 0===r?{}:r),i=i[n];return i})(t,e)[i]=r}}}(window,"RexPlugins.GameObjects.NinePatch",M),D});
